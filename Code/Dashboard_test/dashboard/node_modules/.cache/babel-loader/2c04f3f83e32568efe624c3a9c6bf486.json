{"remainingRequest":"/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/node_modules/babel-loader/lib/index.js!/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/node_modules/eslint-loader/index.js??ref--13-0!/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/src/paho-mqtt.js","dependencies":[{"path":"/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/src/paho-mqtt.js","mtime":1500972622000},{"path":"/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmxvYXQzMi1hcnJheSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZsb2F0NjQtYXJyYXkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbnQ4LWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW50MTYtYXJyYXkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbnQzMi1hcnJheSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnVpbnQ4LWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDE2LWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDMyLWFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuY29weS13aXRoaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5ldmVyeSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbGwiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWx0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1pbmRleCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5jbHVkZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lml0ZXJhdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lmxhc3QtaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5tYXAiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UtcmlnaHQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZXZlcnNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb21lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29ydCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnN1YmFycmF5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tbG9jYWxlLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXN0cmluZyIpOwoKdmFyIF90eXBlb2YgPSByZXF1aXJlKCIvaG9tZS9waGlsaXBwaW5lL0RvY3VtZW50cy9URC9Db2RlL0Rhc2hib2FyZF90ZXN0L2Rhc2hib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YiKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAqIENvcHlyaWdodCAoYykgMjAxMyBJQk0gQ29ycC4KICoKICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9ncmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscwogKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjAKICogYW5kIEVjbGlwc2UgRGlzdHJpYnV0aW9uIExpY2Vuc2UgdjEuMCB3aGljaCBhY2NvbXBhbnkgdGhpcyBkaXN0cmlidXRpb24uCiAqCiAqIFRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIGlzIGF2YWlsYWJsZSBhdAogKiAgICBodHRwOi8vd3d3LmVjbGlwc2Uub3JnL2xlZ2FsL2VwbC12MTAuaHRtbAogKiBhbmQgdGhlIEVjbGlwc2UgRGlzdHJpYnV0aW9uIExpY2Vuc2UgaXMgYXZhaWxhYmxlIGF0CiAqICAgaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9vcmcvZG9jdW1lbnRzL2VkbC12MTAucGhwLgogKgogKiBDb250cmlidXRvcnM6CiAqICAgIEFuZHJldyBCYW5rcyAtIGluaXRpYWwgQVBJIGFuZCBpbXBsZW1lbnRhdGlvbiBhbmQgaW5pdGlhbCBkb2N1bWVudGF0aW9uCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovLyBPbmx5IGV4cG9zZSBhIHNpbmdsZSBvYmplY3QgbmFtZSBpbiB0aGUgZ2xvYmFsIG5hbWVzcGFjZS4KLy8gRXZlcnl0aGluZyBtdXN0IGdvIHRocm91Z2ggdGhpcyBtb2R1bGUuIEdsb2JhbCBQYWhvLk1RVFQgbW9kdWxlCi8vIG9ubHkgaGFzIGEgc2luZ2xlIHB1YmxpYyBmdW5jdGlvbiwgY2xpZW50LCB3aGljaCByZXR1cm5zCi8vIGEgUGFoby5NUVRUIGNsaWVudCBvYmplY3QgZ2l2ZW4gY29ubmVjdGlvbiBkZXRhaWxzLgoKLyoqCiAqIFNlbmQgYW5kIHJlY2VpdmUgbWVzc2FnZXMgdXNpbmcgd2ViIGJyb3dzZXJzLgogKiA8cD4KICogVGhpcyBwcm9ncmFtbWluZyBpbnRlcmZhY2UgbGV0cyBhIEphdmFTY3JpcHQgY2xpZW50IGFwcGxpY2F0aW9uIHVzZSB0aGUgTVFUVCBWMy4xIG9yCiAqIFYzLjEuMSBwcm90b2NvbCB0byBjb25uZWN0IHRvIGFuIE1RVFQtc3VwcG9ydGluZyBtZXNzYWdpbmcgc2VydmVyLgogKgogKiBUaGUgZnVuY3Rpb24gc3VwcG9ydGVkIGluY2x1ZGVzOgogKiA8b2w+CiAqIDxsaT5Db25uZWN0aW5nIHRvIGFuZCBkaXNjb25uZWN0aW5nIGZyb20gYSBzZXJ2ZXIuIFRoZSBzZXJ2ZXIgaXMgaWRlbnRpZmllZCBieSBpdHMgaG9zdCBuYW1lIGFuZCBwb3J0IG51bWJlci4KICogPGxpPlNwZWNpZnlpbmcgb3B0aW9ucyB0aGF0IHJlbGF0ZSB0byB0aGUgY29tbXVuaWNhdGlvbnMgbGluayB3aXRoIHRoZSBzZXJ2ZXIsCiAqIGZvciBleGFtcGxlIHRoZSBmcmVxdWVuY3kgb2Yga2VlcC1hbGl2ZSBoZWFydGJlYXRzLCBhbmQgd2hldGhlciBTU0wvVExTIGlzIHJlcXVpcmVkLgogKiA8bGk+U3Vic2NyaWJpbmcgdG8gYW5kIHJlY2VpdmluZyBtZXNzYWdlcyBmcm9tIE1RVFQgVG9waWNzLgogKiA8bGk+UHVibGlzaGluZyBtZXNzYWdlcyB0byBNUVRUIFRvcGljcy4KICogPC9vbD4KICogPHA+CiAqIFRoZSBBUEkgY29uc2lzdHMgb2YgdHdvIG1haW4gb2JqZWN0czoKICogPGRsPgogKiA8ZHQ+PGI+e0BsaW5rIFBhaG8uTVFUVC5DbGllbnR9PC9iPjwvZHQ+CiAqIDxkZD5UaGlzIGNvbnRhaW5zIG1ldGhvZHMgdGhhdCBwcm92aWRlIHRoZSBmdW5jdGlvbmFsaXR5IG9mIHRoZSBBUEksCiAqIGluY2x1ZGluZyBwcm92aXNpb24gb2YgY2FsbGJhY2tzIHRoYXQgbm90aWZ5IHRoZSBhcHBsaWNhdGlvbiB3aGVuIGEgbWVzc2FnZQogKiBhcnJpdmVzIGZyb20gb3IgaXMgZGVsaXZlcmVkIHRvIHRoZSBtZXNzYWdpbmcgc2VydmVyLAogKiBvciB3aGVuIHRoZSBzdGF0dXMgb2YgaXRzIGNvbm5lY3Rpb24gdG8gdGhlIG1lc3NhZ2luZyBzZXJ2ZXIgY2hhbmdlcy48L2RkPgogKiA8ZHQ+PGI+e0BsaW5rIFBhaG8uTVFUVC5NZXNzYWdlfTwvYj48L2R0PgogKiA8ZGQ+VGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBheWxvYWQgb2YgdGhlIG1lc3NhZ2UgYWxvbmcgd2l0aCB2YXJpb3VzIGF0dHJpYnV0ZXMKICogYXNzb2NpYXRlZCB3aXRoIGl0cyBkZWxpdmVyeSwgaW4gcGFydGljdWxhciB0aGUgZGVzdGluYXRpb24gdG8gd2hpY2ggaXQgaGFzCiAqIGJlZW4gKG9yIGlzIGFib3V0IHRvIGJlKSBzZW50LjwvZGQ+CiAqIDwvZGw+CiAqIDxwPgogKiBUaGUgcHJvZ3JhbW1pbmcgaW50ZXJmYWNlIHZhbGlkYXRlcyBwYXJhbWV0ZXJzIHBhc3NlZCB0byBpdCwgYW5kIHdpbGwgdGhyb3cKICogYW4gRXJyb3IgY29udGFpbmluZyBhbiBlcnJvciBtZXNzYWdlIGludGVuZGVkIGZvciBkZXZlbG9wZXIgdXNlLCBpZiBpdCBkZXRlY3RzCiAqIGFuIGVycm9yIHdpdGggYW55IHBhcmFtZXRlci4KICogPHA+CiAqIEV4YW1wbGU6CiAqCiAqIDxjb2RlPjxwcmU+CmNsaWVudCA9IG5ldyBQYWhvLk1RVFQuQ2xpZW50KGxvY2F0aW9uLmhvc3RuYW1lLCBOdW1iZXIobG9jYXRpb24ucG9ydCksICJjbGllbnRJZCIpOwpjbGllbnQub25Db25uZWN0aW9uTG9zdCA9IG9uQ29ubmVjdGlvbkxvc3Q7CmNsaWVudC5vbk1lc3NhZ2VBcnJpdmVkID0gb25NZXNzYWdlQXJyaXZlZDsKY2xpZW50LmNvbm5lY3Qoe29uU3VjY2VzczpvbkNvbm5lY3R9KTsKCmZ1bmN0aW9uIG9uQ29ubmVjdCgpIHsKICAvLyBPbmNlIGEgY29ubmVjdGlvbiBoYXMgYmVlbiBtYWRlLCBtYWtlIGEgc3Vic2NyaXB0aW9uIGFuZCBzZW5kIGEgbWVzc2FnZS4KICBjb25zb2xlLmxvZygib25Db25uZWN0Iik7CiAgY2xpZW50LnN1YnNjcmliZSgiL1dvcmxkIik7CiAgbWVzc2FnZSA9IG5ldyBQYWhvLk1RVFQuTWVzc2FnZSgiSGVsbG8iKTsKICBtZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9ICIvV29ybGQiOwogIGNsaWVudC5zZW5kKG1lc3NhZ2UpOwp9OwpmdW5jdGlvbiBvbkNvbm5lY3Rpb25Mb3N0KHJlc3BvbnNlT2JqZWN0KSB7CiAgaWYgKHJlc3BvbnNlT2JqZWN0LmVycm9yQ29kZSAhPT0gMCkKCWNvbnNvbGUubG9nKCJvbkNvbm5lY3Rpb25Mb3N0OiIrcmVzcG9uc2VPYmplY3QuZXJyb3JNZXNzYWdlKTsKfTsKZnVuY3Rpb24gb25NZXNzYWdlQXJyaXZlZChtZXNzYWdlKSB7CiAgY29uc29sZS5sb2coIm9uTWVzc2FnZUFycml2ZWQ6IittZXNzYWdlLnBheWxvYWRTdHJpbmcpOwogIGNsaWVudC5kaXNjb25uZWN0KCk7Cn07CiAqIDwvcHJlPjwvY29kZT4KICogQG5hbWVzcGFjZSBQYWhvLk1RVFQKICovCgovKiBqc2hpbnQgc2hhZG93OnRydWUgKi8KKGZ1bmN0aW9uIEV4cG9ydExpYnJhcnkocm9vdCwgZmFjdG9yeSkgewogIGlmICgodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSA9PT0gJ29iamVjdCcgJiYgKHR5cGVvZiBtb2R1bGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG1vZHVsZSkpID09PSAnb2JqZWN0JykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIGRlZmluZShmYWN0b3J5KTsKICB9IGVsc2UgaWYgKCh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0JykgewogICAgZXhwb3J0cyA9IGZhY3RvcnkoKTsKICB9IGVsc2UgewogICAgaWYgKHR5cGVvZiByb290LlBhaG8gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHJvb3QuUGFobyA9IHt9OwogICAgfQoKICAgIHJvb3QuUGFoby5NUVRUID0gZmFjdG9yeSgpOwogIH0KfSkodGhpcywgZnVuY3Rpb24gTGlicmFyeUZhY3RvcnkoKSB7CiAgdmFyIFBhaG9NUVRUID0gZnVuY3Rpb24gKGdsb2JhbCkgewogICAgLy8gUHJpdmF0ZSB2YXJpYWJsZXMgYmVsb3csIHRoZXNlIGFyZSBvbmx5IHZpc2libGUgaW5zaWRlIHRoZSBmdW5jdGlvbiBjbG9zdXJlCiAgICAvLyB3aGljaCBpcyB1c2VkIHRvIGRlZmluZSB0aGUgbW9kdWxlLgogICAgdmFyIHZlcnNpb24gPSAiQFZFUlNJT05AIjsKICAgIHZhciBidWlsZExldmVsID0gIkBCVUlMRExFVkVMQCI7CiAgICAvKioKICAgICAqIFVuaXF1ZSBtZXNzYWdlIHR5cGUgaWRlbnRpZmllcnMsIHdpdGggYXNzb2NpYXRlZAogICAgICogYXNzb2NpYXRlZCBpbnRlZ2VyIHZhbHVlcy4KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgICB2YXIgTUVTU0FHRV9UWVBFID0gewogICAgICBDT05ORUNUOiAxLAogICAgICBDT05OQUNLOiAyLAogICAgICBQVUJMSVNIOiAzLAogICAgICBQVUJBQ0s6IDQsCiAgICAgIFBVQlJFQzogNSwKICAgICAgUFVCUkVMOiA2LAogICAgICBQVUJDT01QOiA3LAogICAgICBTVUJTQ1JJQkU6IDgsCiAgICAgIFNVQkFDSzogOSwKICAgICAgVU5TVUJTQ1JJQkU6IDEwLAogICAgICBVTlNVQkFDSzogMTEsCiAgICAgIFBJTkdSRVE6IDEyLAogICAgICBQSU5HUkVTUDogMTMsCiAgICAgIERJU0NPTk5FQ1Q6IDE0CiAgICB9OyAvLyBDb2xsZWN0aW9uIG9mIHV0aWxpdHkgbWV0aG9kcyB1c2VkIHRvIHNpbXBsaWZ5IG1vZHVsZSBjb2RlCiAgICAvLyBhbmQgcHJvbW90ZSB0aGUgRFJZIHBhdHRlcm4uCgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBhbiBvYmplY3QncyBwYXJhbWV0ZXIgbmFtZXMgdG8gZW5zdXJlIHRoZXkKICAgICAqIG1hdGNoIGEgbGlzdCBvZiBleHBlY3RlZCB2YXJpYWJsZXMgbmFtZSBmb3IgdGhpcyBvcHRpb24KICAgICAqIHR5cGUuIFVzZWQgdG8gZW5zdXJlIG9wdGlvbiBvYmplY3QgcGFzc2VkIGludG8gdGhlIEFQSSBkb24ndAogICAgICogY29udGFpbiBlcnJvbmVvdXMgcGFyYW1ldGVycy4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogLSBVc2VyIG9wdGlvbnMgb2JqZWN0CiAgICAgKiBAcGFyYW0ge09iamVjdH0ga2V5cyAtIHZhbGlkIGtleXMgYW5kIHR5cGVzIHRoYXQgbWF5IGV4aXN0IGluIG9iai4KICAgICAqIEB0aHJvd3Mge0Vycm9yfSBJbnZhbGlkIG9wdGlvbiBwYXJhbWV0ZXIgZm91bmQuCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gdmFsaWRhdGUob2JqLCBrZXlzKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgIGlmIChrZXlzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgaWYgKF90eXBlb2Yob2JqW2tleV0pICE9PSBrZXlzW2tleV0pIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbX3R5cGVvZihvYmpba2V5XSksIGtleV0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBlcnJvclN0ciA9ICJVbmtub3duIHByb3BlcnR5LCAiICsga2V5ICsgIi4gVmFsaWQgcHJvcGVydGllcyBhcmU6IjsKCiAgICAgICAgICAgIGZvciAodmFyIHZhbGlkS2V5IGluIGtleXMpIHsKICAgICAgICAgICAgICBpZiAoa2V5cy5oYXNPd25Qcm9wZXJ0eSh2YWxpZEtleSkpIGVycm9yU3RyID0gZXJyb3JTdHIgKyAiICIgKyB2YWxpZEtleTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yU3RyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBmdW5jdGlvbiB3aGljaCBydW5zIHRoZSB1c2VyIGZ1bmN0aW9uIGJvdW5kCiAgICAgKiB0byBhIGZpeGVkIHNjb3BlLgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gVXNlciBmdW5jdGlvbgogICAgICogQHBhcmFtIHtvYmplY3R9IEZ1bmN0aW9uIHNjb3BlCiAgICAgKiBAcmV0dXJuIHtmdW5jdGlvbn0gVXNlciBmdW5jdGlvbiBib3VuZCB0byBhbm90aGVyIHNjb3BlCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgoKICAgIHZhciBzY29wZSA9IGZ1bmN0aW9uIHNjb3BlKGYsIF9zY29wZSkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBmLmFwcGx5KF9zY29wZSwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH07CiAgICAvKioKICAgICAqIFVuaXF1ZSBtZXNzYWdlIHR5cGUgaWRlbnRpZmllcnMsIHdpdGggYXNzb2NpYXRlZAogICAgICogYXNzb2NpYXRlZCBpbnRlZ2VyIHZhbHVlcy4KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCgogICAgdmFyIEVSUk9SID0gewogICAgICBPSzogewogICAgICAgIGNvZGU6IDAsCiAgICAgICAgdGV4dDogIkFNUUpTQzAwMDBJIE9LLiIKICAgICAgfSwKICAgICAgQ09OTkVDVF9USU1FT1VUOiB7CiAgICAgICAgY29kZTogMSwKICAgICAgICB0ZXh0OiAiQU1RSlNDMDAwMUUgQ29ubmVjdCB0aW1lZCBvdXQuIgogICAgICB9LAogICAgICBTVUJTQ1JJQkVfVElNRU9VVDogewogICAgICAgIGNvZGU6IDIsCiAgICAgICAgdGV4dDogIkFNUUpTMDAwMkUgU3Vic2NyaWJlIHRpbWVkIG91dC4iCiAgICAgIH0sCiAgICAgIFVOU1VCU0NSSUJFX1RJTUVPVVQ6IHsKICAgICAgICBjb2RlOiAzLAogICAgICAgIHRleHQ6ICJBTVFKUzAwMDNFIFVuc3Vic2NyaWJlIHRpbWVkIG91dC4iCiAgICAgIH0sCiAgICAgIFBJTkdfVElNRU9VVDogewogICAgICAgIGNvZGU6IDQsCiAgICAgICAgdGV4dDogIkFNUUpTMDAwNEUgUGluZyB0aW1lZCBvdXQuIgogICAgICB9LAogICAgICBJTlRFUk5BTF9FUlJPUjogewogICAgICAgIGNvZGU6IDUsCiAgICAgICAgdGV4dDogIkFNUUpTMDAwNUUgSW50ZXJuYWwgZXJyb3IuIEVycm9yIE1lc3NhZ2U6IHswfSwgU3RhY2sgdHJhY2U6IHsxfSIKICAgICAgfSwKICAgICAgQ09OTkFDS19SRVRVUk5DT0RFOiB7CiAgICAgICAgY29kZTogNiwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDA2RSBCYWQgQ29ubmFjayByZXR1cm4gY29kZTp7MH0gezF9LiIKICAgICAgfSwKICAgICAgU09DS0VUX0VSUk9SOiB7CiAgICAgICAgY29kZTogNywKICAgICAgICB0ZXh0OiAiQU1RSlMwMDA3RSBTb2NrZXQgZXJyb3I6ezB9LiIKICAgICAgfSwKICAgICAgU09DS0VUX0NMT1NFOiB7CiAgICAgICAgY29kZTogOCwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDA4SSBTb2NrZXQgY2xvc2VkLiIKICAgICAgfSwKICAgICAgTUFMRk9STUVEX1VURjogewogICAgICAgIGNvZGU6IDksCiAgICAgICAgdGV4dDogIkFNUUpTMDAwOUUgTWFsZm9ybWVkIFVURiBkYXRhOnswfSB7MX0gezJ9LiIKICAgICAgfSwKICAgICAgVU5TVVBQT1JURUQ6IHsKICAgICAgICBjb2RlOiAxMCwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDEwRSB7MH0gaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXIuIgogICAgICB9LAogICAgICBJTlZBTElEX1NUQVRFOiB7CiAgICAgICAgY29kZTogMTEsCiAgICAgICAgdGV4dDogIkFNUUpTMDAxMUUgSW52YWxpZCBzdGF0ZSB7MH0uIgogICAgICB9LAogICAgICBJTlZBTElEX1RZUEU6IHsKICAgICAgICBjb2RlOiAxMiwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDEyRSBJbnZhbGlkIHR5cGUgezB9IGZvciB7MX0uIgogICAgICB9LAogICAgICBJTlZBTElEX0FSR1VNRU5UOiB7CiAgICAgICAgY29kZTogMTMsCiAgICAgICAgdGV4dDogIkFNUUpTMDAxM0UgSW52YWxpZCBhcmd1bWVudCB7MH0gZm9yIHsxfS4iCiAgICAgIH0sCiAgICAgIFVOU1VQUE9SVEVEX09QRVJBVElPTjogewogICAgICAgIGNvZGU6IDE0LAogICAgICAgIHRleHQ6ICJBTVFKUzAwMTRFIFVuc3VwcG9ydGVkIG9wZXJhdGlvbi4iCiAgICAgIH0sCiAgICAgIElOVkFMSURfU1RPUkVEX0RBVEE6IHsKICAgICAgICBjb2RlOiAxNSwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDE1RSBJbnZhbGlkIGRhdGEgaW4gbG9jYWwgc3RvcmFnZSBrZXk9ezB9IHZhbHVlPXsxfS4iCiAgICAgIH0sCiAgICAgIElOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEU6IHsKICAgICAgICBjb2RlOiAxNiwKICAgICAgICB0ZXh0OiAiQU1RSlMwMDE2RSBJbnZhbGlkIE1RVFQgbWVzc2FnZSB0eXBlIHswfS4iCiAgICAgIH0sCiAgICAgIE1BTEZPUk1FRF9VTklDT0RFOiB7CiAgICAgICAgY29kZTogMTcsCiAgICAgICAgdGV4dDogIkFNUUpTMDAxN0UgTWFsZm9ybWVkIFVuaWNvZGUgc3RyaW5nOnswfSB7MX0uIgogICAgICB9LAogICAgICBCVUZGRVJfRlVMTDogewogICAgICAgIGNvZGU6IDE4LAogICAgICAgIHRleHQ6ICJBTVFKUzAwMThFIE1lc3NhZ2UgYnVmZmVyIGlzIGZ1bGwsIG1heGltdW0gYnVmZmVyIHNpemU6IHswfS4iCiAgICAgIH0KICAgIH07CiAgICAvKiogQ09OTkFDSyBSQyBNZWFuaW5nLiAqLwoKICAgIHZhciBDT05OQUNLX1JDID0gewogICAgICAwOiAiQ29ubmVjdGlvbiBBY2NlcHRlZCIsCiAgICAgIDE6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IHVuYWNjZXB0YWJsZSBwcm90b2NvbCB2ZXJzaW9uIiwKICAgICAgMjogIkNvbm5lY3Rpb24gUmVmdXNlZDogaWRlbnRpZmllciByZWplY3RlZCIsCiAgICAgIDM6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IHNlcnZlciB1bmF2YWlsYWJsZSIsCiAgICAgIDQ6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IGJhZCB1c2VyIG5hbWUgb3IgcGFzc3dvcmQiLAogICAgICA1OiAiQ29ubmVjdGlvbiBSZWZ1c2VkOiBub3QgYXV0aG9yaXplZCIKICAgIH07CiAgICAvKioKICAgICAqIEZvcm1hdCBhbiBlcnJvciBtZXNzYWdlIHRleHQuCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtlcnJvcn0gRVJST1IuS0VZIHZhbHVlIGFib3ZlLgogICAgICogQHBhcmFtIHtzdWJzdGl0dXRpb25zfSBbYXJyYXldIHN1YnN0aXR1dGVkIGludG8gdGhlIHRleHQuCiAgICAgKiBAcmV0dXJuIHRoZSB0ZXh0IHdpdGggdGhlIHN1YnN0aXR1dGlvbnMgbWFkZS4KICAgICAqLwoKICAgIHZhciBmb3JtYXQgPSBmdW5jdGlvbiBmb3JtYXQoZXJyb3IsIHN1YnN0aXR1dGlvbnMpIHsKICAgICAgdmFyIHRleHQgPSBlcnJvci50ZXh0OwoKICAgICAgaWYgKHN1YnN0aXR1dGlvbnMpIHsKICAgICAgICB2YXIgZmllbGQsIHN0YXJ0OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnN0aXR1dGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGZpZWxkID0gInsiICsgaSArICJ9IjsKICAgICAgICAgIHN0YXJ0ID0gdGV4dC5pbmRleE9mKGZpZWxkKTsKCiAgICAgICAgICBpZiAoc3RhcnQgPiAwKSB7CiAgICAgICAgICAgIHZhciBwYXJ0MSA9IHRleHQuc3Vic3RyaW5nKDAsIHN0YXJ0KTsKICAgICAgICAgICAgdmFyIHBhcnQyID0gdGV4dC5zdWJzdHJpbmcoc3RhcnQgKyBmaWVsZC5sZW5ndGgpOwogICAgICAgICAgICB0ZXh0ID0gcGFydDEgKyBzdWJzdGl0dXRpb25zW2ldICsgcGFydDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGV4dDsKICAgIH07IC8vTVFUVCBwcm90b2NvbCBhbmQgdmVyc2lvbiAgICAgICAgICA2ICAgIE0gICAgUSAgICBJICAgIHMgICAgZCAgICBwICAgIDMKCgogICAgdmFyIE1xdHRQcm90b0lkZW50aWZpZXJ2MyA9IFsweDAwLCAweDA2LCAweDRkLCAweDUxLCAweDQ5LCAweDczLCAweDY0LCAweDcwLCAweDAzXTsgLy9NUVRUIHByb3RvL3ZlcnNpb24gZm9yIDMxMSAgICAgICAgIDQgICAgTSAgICBRICAgIFQgICAgVCAgICA0CgogICAgdmFyIE1xdHRQcm90b0lkZW50aWZpZXJ2NCA9IFsweDAwLCAweDA0LCAweDRkLCAweDUxLCAweDU0LCAweDU0LCAweDA0XTsKICAgIC8qKgogICAgICogQ29uc3RydWN0IGFuIE1RVFQgd2lyZSBwcm90b2NvbCBtZXNzYWdlLgogICAgICogQHBhcmFtIHR5cGUgTVFUVCBwYWNrZXQgdHlwZS4KICAgICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbmFsIHdpcmUgbWVzc2FnZSBhdHRyaWJ1dGVzLgogICAgICoKICAgICAqIE9wdGlvbmFsIHByb3BlcnRpZXMKICAgICAqCiAgICAgKiBtZXNzYWdlSWRlbnRpZmllcjogbWVzc2FnZSBJRCBpbiB0aGUgcmFuZ2UgWzAuLjY1NTM1XQogICAgICogcGF5bG9hZE1lc3NhZ2U6CUFwcGxpY2F0aW9uIE1lc3NhZ2UgLSBQVUJMSVNIIG9ubHkKICAgICAqIGNvbm5lY3RTdHJpbmdzOglhcnJheSBvZiAwIG9yIG1vcmUgU3RyaW5ncyB0byBiZSBwdXQgaW50byB0aGUgQ09OTkVDVCBwYXlsb2FkCiAgICAgKiB0b3BpY3M6CQkJYXJyYXkgb2Ygc3RyaW5ncyAoU1VCU0NSSUJFLCBVTlNVQlNDUklCRSkKICAgICAqIHJlcXVlc3RRb1M6CQlhcnJheSBvZiBRb1MgdmFsdWVzIFswLi4yXQogICAgICoKICAgICAqICJGbGFnIiBwcm9wZXJ0aWVzCiAgICAgKiBjbGVhblNlc3Npb246CXRydWUgaWYgcHJlc2VudCAvIGZhbHNlIGlmIGFic2VudCAoQ09OTkVDVCkKICAgICAqIHdpbGxNZXNzYWdlOiAgCXRydWUgaWYgcHJlc2VudCAvIGZhbHNlIGlmIGFic2VudCAoQ09OTkVDVCkKICAgICAqIGlzUmV0YWluZWQ6CQl0cnVlIGlmIHByZXNlbnQgLyBmYWxzZSBpZiBhYnNlbnQgKENPTk5FQ1QpCiAgICAgKiB1c2VyTmFtZToJCXRydWUgaWYgcHJlc2VudCAvIGZhbHNlIGlmIGFic2VudCAoQ09OTkVDVCkKICAgICAqIHBhc3N3b3JkOgkJdHJ1ZSBpZiBwcmVzZW50IC8gZmFsc2UgaWYgYWJzZW50IChDT05ORUNUKQogICAgICoga2VlcEFsaXZlSW50ZXJ2YWw6CWludGVnZXIgWzAuLjY1NTM1XSAgKENPTk5FQ1QpCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBpZ25vcmUKICAgICAqLwoKICAgIHZhciBXaXJlTWVzc2FnZSA9IGZ1bmN0aW9uIFdpcmVNZXNzYWdlKHR5cGUsIG9wdGlvbnMpIHsKICAgICAgdGhpcy50eXBlID0gdHlwZTsKCiAgICAgIGZvciAodmFyIG5hbWUgaW4gb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICB0aGlzW25hbWVdID0gb3B0aW9uc1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgV2lyZU1lc3NhZ2UucHJvdG90eXBlLmVuY29kZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gQ29tcHV0ZSB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZml4ZWQgaGVhZGVyCiAgICAgIHZhciBmaXJzdCA9ICh0aGlzLnR5cGUgJiAweDBmKSA8PCA0OwogICAgICAvKgogICAgICAgKiBOb3cgY2FsY3VsYXRlIHRoZSBsZW5ndGggb2YgdGhlIHZhcmlhYmxlIGhlYWRlciArIHBheWxvYWQgYnkgYWRkaW5nIHVwIHRoZSBsZW5ndGhzCiAgICAgICAqIG9mIGFsbCB0aGUgY29tcG9uZW50IHBhcnRzCiAgICAgICAqLwoKICAgICAgdmFyIHJlbUxlbmd0aCA9IDA7CiAgICAgIHZhciB0b3BpY1N0ckxlbmd0aCA9IFtdOwogICAgICB2YXIgZGVzdGluYXRpb25OYW1lTGVuZ3RoID0gMDsKICAgICAgdmFyIHdpbGxNZXNzYWdlUGF5bG9hZEJ5dGVzOyAvLyBpZiB0aGUgbWVzc2FnZSBjb250YWlucyBhIG1lc3NhZ2VJZGVudGlmaWVyIHRoZW4gd2UgbmVlZCB0d28gYnl0ZXMgZm9yIHRoYXQKCiAgICAgIGlmICh0aGlzLm1lc3NhZ2VJZGVudGlmaWVyICE9PSB1bmRlZmluZWQpIHJlbUxlbmd0aCArPSAyOwoKICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHsKICAgICAgICAvLyBJZiB0aGlzIGEgQ29ubmVjdCB0aGVuIHdlIG5lZWQgdG8gaW5jbHVkZSAxMiBieXRlcyBmb3IgaXRzIGhlYWRlcgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkNPTk5FQ1Q6CiAgICAgICAgICBzd2l0Y2ggKHRoaXMubXF0dFZlcnNpb24pIHsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJlbUxlbmd0aCArPSBNcXR0UHJvdG9JZGVudGlmaWVydjMubGVuZ3RoICsgMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICByZW1MZW5ndGggKz0gTXF0dFByb3RvSWRlbnRpZmllcnY0Lmxlbmd0aCArIDM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy5jbGllbnRJZCkgKyAyOwoKICAgICAgICAgIGlmICh0aGlzLndpbGxNZXNzYWdlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUpICsgMjsgLy8gV2lsbCBtZXNzYWdlIGlzIGFsd2F5cyBhIHN0cmluZywgc2VudCBhcyBVVEYtOCBjaGFyYWN0ZXJzIHdpdGggYSBwcmVjZWRpbmcgbGVuZ3RoLgoKICAgICAgICAgICAgd2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMgPSB0aGlzLndpbGxNZXNzYWdlLnBheWxvYWRCeXRlczsKICAgICAgICAgICAgaWYgKCEod2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkgd2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMgPSBuZXcgVWludDhBcnJheShwYXlsb2FkQnl0ZXMpOwogICAgICAgICAgICByZW1MZW5ndGggKz0gd2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMuYnl0ZUxlbmd0aCArIDI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMudXNlck5hbWUgIT09IHVuZGVmaW5lZCkgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy51c2VyTmFtZSkgKyAyOwogICAgICAgICAgaWYgKHRoaXMucGFzc3dvcmQgIT09IHVuZGVmaW5lZCkgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy5wYXNzd29yZCkgKyAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3Vic2NyaWJlLCBVbnN1YnNjcmliZSBjYW4gYm90aCBjb250YWluIHRvcGljIHN0cmluZ3MKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuU1VCU0NSSUJFOgogICAgICAgICAgZmlyc3QgfD0gMHgwMjsgLy8gUW9zID0gMTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG9waWNzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRvcGljU3RyTGVuZ3RoW2ldID0gVVRGOExlbmd0aCh0aGlzLnRvcGljc1tpXSk7CiAgICAgICAgICAgIHJlbUxlbmd0aCArPSB0b3BpY1N0ckxlbmd0aFtpXSArIDI7CiAgICAgICAgICB9CgogICAgICAgICAgcmVtTGVuZ3RoICs9IHRoaXMucmVxdWVzdGVkUW9zLmxlbmd0aDsgLy8gMSBieXRlIGZvciBlYWNoIHRvcGljJ3MgUW9zCiAgICAgICAgICAvLyBRb1Mgb24gU3Vic2NyaWJlIG9ubHkKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuVU5TVUJTQ1JJQkU6CiAgICAgICAgICBmaXJzdCB8PSAweDAyOyAvLyBRb3MgPSAxOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3BpY3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG9waWNTdHJMZW5ndGhbaV0gPSBVVEY4TGVuZ3RoKHRoaXMudG9waWNzW2ldKTsKICAgICAgICAgICAgcmVtTGVuZ3RoICs9IHRvcGljU3RyTGVuZ3RoW2ldICsgMjsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCUkVMOgogICAgICAgICAgZmlyc3QgfD0gMHgwMjsgLy8gUW9zID0gMTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCTElTSDoKICAgICAgICAgIGlmICh0aGlzLnBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSkgZmlyc3QgfD0gMHgwODsKICAgICAgICAgIGZpcnN0ID0gZmlyc3QgfD0gdGhpcy5wYXlsb2FkTWVzc2FnZS5xb3MgPDwgMTsKICAgICAgICAgIGlmICh0aGlzLnBheWxvYWRNZXNzYWdlLnJldGFpbmVkKSBmaXJzdCB8PSAweDAxOwogICAgICAgICAgZGVzdGluYXRpb25OYW1lTGVuZ3RoID0gVVRGOExlbmd0aCh0aGlzLnBheWxvYWRNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSk7CiAgICAgICAgICByZW1MZW5ndGggKz0gZGVzdGluYXRpb25OYW1lTGVuZ3RoICsgMjsKICAgICAgICAgIHZhciBwYXlsb2FkQnl0ZXMgPSB0aGlzLnBheWxvYWRNZXNzYWdlLnBheWxvYWRCeXRlczsKICAgICAgICAgIHJlbUxlbmd0aCArPSBwYXlsb2FkQnl0ZXMuYnl0ZUxlbmd0aDsKICAgICAgICAgIGlmIChwYXlsb2FkQnl0ZXMgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgcGF5bG9hZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocGF5bG9hZEJ5dGVzKTtlbHNlIGlmICghKHBheWxvYWRCeXRlcyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKSBwYXlsb2FkQnl0ZXMgPSBuZXcgVWludDhBcnJheShwYXlsb2FkQnl0ZXMuYnVmZmVyKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5ESVNDT05ORUNUOgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfSAvLyBOb3cgd2UgY2FuIGFsbG9jYXRlIGEgYnVmZmVyIGZvciB0aGUgbWVzc2FnZQoKCiAgICAgIHZhciBtYmkgPSBlbmNvZGVNQkkocmVtTGVuZ3RoKTsgLy8gQ29udmVydCB0aGUgbGVuZ3RoIHRvIE1RVFQgTUJJIGZvcm1hdAoKICAgICAgdmFyIHBvcyA9IG1iaS5sZW5ndGggKyAxOyAvLyBPZmZzZXQgb2Ygc3RhcnQgb2YgdmFyaWFibGUgaGVhZGVyCgogICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHJlbUxlbmd0aCArIHBvcyk7CiAgICAgIHZhciBieXRlU3RyZWFtID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsgLy8gdmlldyBpdCBhcyBhIHNlcXVlbmNlIG9mIGJ5dGVzCiAgICAgIC8vV3JpdGUgdGhlIGZpeGVkIGhlYWRlciBpbnRvIHRoZSBidWZmZXIKCiAgICAgIGJ5dGVTdHJlYW1bMF0gPSBmaXJzdDsKICAgICAgYnl0ZVN0cmVhbS5zZXQobWJpLCAxKTsgLy8gSWYgdGhpcyBpcyBhIFBVQkxJU0ggdGhlbiB0aGUgdmFyaWFibGUgaGVhZGVyIHN0YXJ0cyB3aXRoIGEgdG9waWMKCiAgICAgIGlmICh0aGlzLnR5cGUgPT0gTUVTU0FHRV9UWVBFLlBVQkxJU0gpIHBvcyA9IHdyaXRlU3RyaW5nKHRoaXMucGF5bG9hZE1lc3NhZ2UuZGVzdGluYXRpb25OYW1lLCBkZXN0aW5hdGlvbk5hbWVMZW5ndGgsIGJ5dGVTdHJlYW0sIHBvcyk7IC8vIElmIHRoaXMgaXMgYSBDT05ORUNUIHRoZW4gdGhlIHZhcmlhYmxlIGhlYWRlciBjb250YWlucyB0aGUgcHJvdG9jb2wgbmFtZS92ZXJzaW9uLCBmbGFncyBhbmQga2VlcGFsaXZlIHRpbWUKICAgICAgZWxzZSBpZiAodGhpcy50eXBlID09IE1FU1NBR0VfVFlQRS5DT05ORUNUKSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMubXF0dFZlcnNpb24pIHsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGJ5dGVTdHJlYW0uc2V0KE1xdHRQcm90b0lkZW50aWZpZXJ2MywgcG9zKTsKICAgICAgICAgICAgICBwb3MgKz0gTXF0dFByb3RvSWRlbnRpZmllcnYzLmxlbmd0aDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBieXRlU3RyZWFtLnNldChNcXR0UHJvdG9JZGVudGlmaWVydjQsIHBvcyk7CiAgICAgICAgICAgICAgcG9zICs9IE1xdHRQcm90b0lkZW50aWZpZXJ2NC5sZW5ndGg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGNvbm5lY3RGbGFncyA9IDA7CiAgICAgICAgICBpZiAodGhpcy5jbGVhblNlc3Npb24pIGNvbm5lY3RGbGFncyA9IDB4MDI7CgogICAgICAgICAgaWYgKHRoaXMud2lsbE1lc3NhZ2UgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25uZWN0RmxhZ3MgfD0gMHgwNDsKICAgICAgICAgICAgY29ubmVjdEZsYWdzIHw9IHRoaXMud2lsbE1lc3NhZ2UucW9zIDw8IDM7CgogICAgICAgICAgICBpZiAodGhpcy53aWxsTWVzc2FnZS5yZXRhaW5lZCkgewogICAgICAgICAgICAgIGNvbm5lY3RGbGFncyB8PSAweDIwOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMudXNlck5hbWUgIT09IHVuZGVmaW5lZCkgY29ubmVjdEZsYWdzIHw9IDB4ODA7CiAgICAgICAgICBpZiAodGhpcy5wYXNzd29yZCAhPT0gdW5kZWZpbmVkKSBjb25uZWN0RmxhZ3MgfD0gMHg0MDsKICAgICAgICAgIGJ5dGVTdHJlYW1bcG9zKytdID0gY29ubmVjdEZsYWdzOwogICAgICAgICAgcG9zID0gd3JpdGVVaW50MTYodGhpcy5rZWVwQWxpdmVJbnRlcnZhbCwgYnl0ZVN0cmVhbSwgcG9zKTsKICAgICAgICB9IC8vIE91dHB1dCB0aGUgbWVzc2FnZUlkZW50aWZpZXIgLSBpZiB0aGVyZSBpcyBvbmUKCiAgICAgIGlmICh0aGlzLm1lc3NhZ2VJZGVudGlmaWVyICE9PSB1bmRlZmluZWQpIHBvcyA9IHdyaXRlVWludDE2KHRoaXMubWVzc2FnZUlkZW50aWZpZXIsIGJ5dGVTdHJlYW0sIHBvcyk7CgogICAgICBzd2l0Y2ggKHRoaXMudHlwZSkgewogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkNPTk5FQ1Q6CiAgICAgICAgICBwb3MgPSB3cml0ZVN0cmluZyh0aGlzLmNsaWVudElkLCBVVEY4TGVuZ3RoKHRoaXMuY2xpZW50SWQpLCBieXRlU3RyZWFtLCBwb3MpOwoKICAgICAgICAgIGlmICh0aGlzLndpbGxNZXNzYWdlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUsIFVURjhMZW5ndGgodGhpcy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUpLCBieXRlU3RyZWFtLCBwb3MpOwogICAgICAgICAgICBwb3MgPSB3cml0ZVVpbnQxNih3aWxsTWVzc2FnZVBheWxvYWRCeXRlcy5ieXRlTGVuZ3RoLCBieXRlU3RyZWFtLCBwb3MpOwogICAgICAgICAgICBieXRlU3RyZWFtLnNldCh3aWxsTWVzc2FnZVBheWxvYWRCeXRlcywgcG9zKTsKICAgICAgICAgICAgcG9zICs9IHdpbGxNZXNzYWdlUGF5bG9hZEJ5dGVzLmJ5dGVMZW5ndGg7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMudXNlck5hbWUgIT09IHVuZGVmaW5lZCkgcG9zID0gd3JpdGVTdHJpbmcodGhpcy51c2VyTmFtZSwgVVRGOExlbmd0aCh0aGlzLnVzZXJOYW1lKSwgYnl0ZVN0cmVhbSwgcG9zKTsKICAgICAgICAgIGlmICh0aGlzLnBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHBvcyA9IHdyaXRlU3RyaW5nKHRoaXMucGFzc3dvcmQsIFVURjhMZW5ndGgodGhpcy5wYXNzd29yZCksIGJ5dGVTdHJlYW0sIHBvcyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCTElTSDoKICAgICAgICAgIC8vIFBVQkxJU0ggaGFzIGEgdGV4dCBvciBiaW5hcnkgcGF5bG9hZCwgaWYgdGV4dCBkbyBub3QgYWRkIGEgMiBieXRlIGxlbmd0aCBmaWVsZCwganVzdCB0aGUgVVRGIGNoYXJhY3RlcnMuCiAgICAgICAgICBieXRlU3RyZWFtLnNldChwYXlsb2FkQnl0ZXMsIHBvcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICAvLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFQzoKICAgICAgICAvLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFTDoKICAgICAgICAvLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkNPTVA6CiAgICAgICAgLy8gICAgCSAgICAJYnJlYWs7CgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlNVQlNDUklCRToKICAgICAgICAgIC8vIFNVQlNDUklCRSBoYXMgYSBsaXN0IG9mIHRvcGljIHN0cmluZ3MgYW5kIHJlcXVlc3QgUW9TCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG9waWNzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHBvcyA9IHdyaXRlU3RyaW5nKHRoaXMudG9waWNzW2ldLCB0b3BpY1N0ckxlbmd0aFtpXSwgYnl0ZVN0cmVhbSwgcG9zKTsKICAgICAgICAgICAgYnl0ZVN0cmVhbVtwb3MrK10gPSB0aGlzLnJlcXVlc3RlZFFvc1tpXTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuVU5TVUJTQ1JJQkU6CiAgICAgICAgICAvLyBVTlNVQlNDUklCRSBoYXMgYSBsaXN0IG9mIHRvcGljIHN0cmluZ3MKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3BpY3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy50b3BpY3NbaV0sIHRvcGljU3RyTGVuZ3RoW2ldLCBieXRlU3RyZWFtLCBwb3MpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OiAvLyBEbyBub3RoaW5nLgoKICAgICAgfQoKICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH07CgogICAgZnVuY3Rpb24gZGVjb2RlTWVzc2FnZShpbnB1dCwgcG9zKSB7CiAgICAgIHZhciBzdGFydGluZ1BvcyA9IHBvczsKICAgICAgdmFyIGZpcnN0ID0gaW5wdXRbcG9zXTsKICAgICAgdmFyIHR5cGUgPSBmaXJzdCA+PiA0OwogICAgICB2YXIgbWVzc2FnZUluZm8gPSBmaXJzdCAmPSAweDBmOwogICAgICBwb3MgKz0gMTsgLy8gRGVjb2RlIHRoZSByZW1haW5pbmcgbGVuZ3RoIChNQkkgZm9ybWF0KQoKICAgICAgdmFyIGRpZ2l0OwogICAgICB2YXIgcmVtTGVuZ3RoID0gMDsKICAgICAgdmFyIG11bHRpcGxpZXIgPSAxOwoKICAgICAgZG8gewogICAgICAgIGlmIChwb3MgPT0gaW5wdXQubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gW251bGwsIHN0YXJ0aW5nUG9zXTsKICAgICAgICB9CgogICAgICAgIGRpZ2l0ID0gaW5wdXRbcG9zKytdOwogICAgICAgIHJlbUxlbmd0aCArPSAoZGlnaXQgJiAweDdGKSAqIG11bHRpcGxpZXI7CiAgICAgICAgbXVsdGlwbGllciAqPSAxMjg7CiAgICAgIH0gd2hpbGUgKChkaWdpdCAmIDB4ODApICE9PSAwKTsKCiAgICAgIHZhciBlbmRQb3MgPSBwb3MgKyByZW1MZW5ndGg7CgogICAgICBpZiAoZW5kUG9zID4gaW5wdXQubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIFtudWxsLCBzdGFydGluZ1Bvc107CiAgICAgIH0KCiAgICAgIHZhciB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZSh0eXBlKTsKCiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkNPTk5BQ0s6CiAgICAgICAgICB2YXIgY29ubmVjdEFja25vd2xlZGdlRmxhZ3MgPSBpbnB1dFtwb3MrK107CiAgICAgICAgICBpZiAoY29ubmVjdEFja25vd2xlZGdlRmxhZ3MgJiAweDAxKSB3aXJlTWVzc2FnZS5zZXNzaW9uUHJlc2VudCA9IHRydWU7CiAgICAgICAgICB3aXJlTWVzc2FnZS5yZXR1cm5Db2RlID0gaW5wdXRbcG9zKytdOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkxJU0g6CiAgICAgICAgICB2YXIgcW9zID0gbWVzc2FnZUluZm8gPj4gMSAmIDB4MDM7CiAgICAgICAgICB2YXIgbGVuID0gcmVhZFVpbnQxNihpbnB1dCwgcG9zKTsKICAgICAgICAgIHBvcyArPSAyOwogICAgICAgICAgdmFyIHRvcGljTmFtZSA9IHBhcnNlVVRGOChpbnB1dCwgcG9zLCBsZW4pOwogICAgICAgICAgcG9zICs9IGxlbjsgLy8gSWYgUW9TIDEgb3IgMiB0aGVyZSB3aWxsIGJlIGEgbWVzc2FnZUlkZW50aWZpZXIKCiAgICAgICAgICBpZiAocW9zID4gMCkgewogICAgICAgICAgICB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllciA9IHJlYWRVaW50MTYoaW5wdXQsIHBvcyk7CiAgICAgICAgICAgIHBvcyArPSAyOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3IFBhaG8uTVFUVC5NZXNzYWdlKGlucHV0LnN1YmFycmF5KHBvcywgZW5kUG9zKSk7CiAgICAgICAgICBpZiAoKG1lc3NhZ2VJbmZvICYgMHgwMSkgPT0gMHgwMSkgbWVzc2FnZS5yZXRhaW5lZCA9IHRydWU7CiAgICAgICAgICBpZiAoKG1lc3NhZ2VJbmZvICYgMHgwOCkgPT0gMHgwOCkgbWVzc2FnZS5kdXBsaWNhdGUgPSB0cnVlOwogICAgICAgICAgbWVzc2FnZS5xb3MgPSBxb3M7CiAgICAgICAgICBtZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9IHRvcGljTmFtZTsKICAgICAgICAgIHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJBQ0s6CiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCUkVDOgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFTDoKICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJDT01QOgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlVOU1VCQUNLOgogICAgICAgICAgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIgPSByZWFkVWludDE2KGlucHV0LCBwb3MpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlNVQkFDSzoKICAgICAgICAgIHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyID0gcmVhZFVpbnQxNihpbnB1dCwgcG9zKTsKICAgICAgICAgIHBvcyArPSAyOwogICAgICAgICAgd2lyZU1lc3NhZ2UucmV0dXJuQ29kZSA9IGlucHV0LnN1YmFycmF5KHBvcywgZW5kUG9zKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHJldHVybiBbd2lyZU1lc3NhZ2UsIGVuZFBvc107CiAgICB9CgogICAgZnVuY3Rpb24gd3JpdGVVaW50MTYoaW5wdXQsIGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIGJ1ZmZlcltvZmZzZXQrK10gPSBpbnB1dCA+PiA4OyAvL01TQgoKICAgICAgYnVmZmVyW29mZnNldCsrXSA9IGlucHV0ICUgMjU2OyAvL0xTQgoKICAgICAgcmV0dXJuIG9mZnNldDsKICAgIH0KCiAgICBmdW5jdGlvbiB3cml0ZVN0cmluZyhpbnB1dCwgdXRmOExlbmd0aCwgYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgb2Zmc2V0ID0gd3JpdGVVaW50MTYodXRmOExlbmd0aCwgYnVmZmVyLCBvZmZzZXQpOwogICAgICBzdHJpbmdUb1VURjgoaW5wdXQsIGJ1ZmZlciwgb2Zmc2V0KTsKICAgICAgcmV0dXJuIG9mZnNldCArIHV0ZjhMZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gcmVhZFVpbnQxNihidWZmZXIsIG9mZnNldCkgewogICAgICByZXR1cm4gMjU2ICogYnVmZmVyW29mZnNldF0gKyBidWZmZXJbb2Zmc2V0ICsgMV07CiAgICB9CiAgICAvKioKICAgICAqIEVuY29kZXMgYW4gTVFUVCBNdWx0aS1CeXRlIEludGVnZXIKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCgogICAgZnVuY3Rpb24gZW5jb2RlTUJJKG51bWJlcikgewogICAgICB2YXIgb3V0cHV0ID0gbmV3IEFycmF5KDEpOwogICAgICB2YXIgbnVtQnl0ZXMgPSAwOwoKICAgICAgZG8gewogICAgICAgIHZhciBkaWdpdCA9IG51bWJlciAlIDEyODsKICAgICAgICBudW1iZXIgPSBudW1iZXIgPj4gNzsKCiAgICAgICAgaWYgKG51bWJlciA+IDApIHsKICAgICAgICAgIGRpZ2l0IHw9IDB4ODA7CiAgICAgICAgfQoKICAgICAgICBvdXRwdXRbbnVtQnl0ZXMrK10gPSBkaWdpdDsKICAgICAgfSB3aGlsZSAobnVtYmVyID4gMCAmJiBudW1CeXRlcyA8IDQpOwoKICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH0KICAgIC8qKgogICAgICogVGFrZXMgYSBTdHJpbmcgYW5kIGNhbGN1bGF0ZXMgaXRzIGxlbmd0aCBpbiBieXRlcyB3aGVuIGVuY29kZWQgaW4gVVRGOC4KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCgogICAgZnVuY3Rpb24gVVRGOExlbmd0aChpbnB1dCkgewogICAgICB2YXIgb3V0cHV0ID0gMDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY2hhckNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGkpOwoKICAgICAgICBpZiAoY2hhckNvZGUgPiAweDdGRikgewogICAgICAgICAgLy8gU3Vycm9nYXRlIHBhaXIgbWVhbnMgaXRzIGEgNCBieXRlIGNoYXJhY3RlcgogICAgICAgICAgaWYgKDB4RDgwMCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweERCRkYpIHsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICBvdXRwdXQrKzsKICAgICAgICAgIH0KCiAgICAgICAgICBvdXRwdXQgKz0gMzsKICAgICAgICB9IGVsc2UgaWYgKGNoYXJDb2RlID4gMHg3Rikgb3V0cHV0ICs9IDI7ZWxzZSBvdXRwdXQrKzsKICAgICAgfQoKICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH0KICAgIC8qKgogICAgICogVGFrZXMgYSBTdHJpbmcgYW5kIHdyaXRlcyBpdCBpbnRvIGFuIGFycmF5IGFzIFVURjggZW5jb2RlZCBieXRlcy4KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCgogICAgZnVuY3Rpb24gc3RyaW5nVG9VVEY4KGlucHV0LCBvdXRwdXQsIHN0YXJ0KSB7CiAgICAgIHZhciBwb3MgPSBzdGFydDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY2hhckNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGkpOyAvLyBDaGVjayBmb3IgYSBzdXJyb2dhdGUgcGFpci4KCiAgICAgICAgaWYgKDB4RDgwMCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweERCRkYpIHsKICAgICAgICAgIHZhciBsb3dDaGFyQ29kZSA9IGlucHV0LmNoYXJDb2RlQXQoKytpKTsKCiAgICAgICAgICBpZiAoaXNOYU4obG93Q2hhckNvZGUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuTUFMRk9STUVEX1VOSUNPREUsIFtjaGFyQ29kZSwgbG93Q2hhckNvZGVdKSk7CiAgICAgICAgICB9CgogICAgICAgICAgY2hhckNvZGUgPSAoY2hhckNvZGUgLSAweEQ4MDAgPDwgMTApICsgKGxvd0NoYXJDb2RlIC0gMHhEQzAwKSArIDB4MTAwMDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hhckNvZGUgPD0gMHg3RikgewogICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlOwogICAgICAgIH0gZWxzZSBpZiAoY2hhckNvZGUgPD0gMHg3RkYpIHsKICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA+PiA2ICYgMHgxRiB8IDB4QzA7CiAgICAgICAgICBvdXRwdXRbcG9zKytdID0gY2hhckNvZGUgJiAweDNGIHwgMHg4MDsKICAgICAgICB9IGVsc2UgaWYgKGNoYXJDb2RlIDw9IDB4RkZGRikgewogICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlID4+IDEyICYgMHgwRiB8IDB4RTA7CiAgICAgICAgICBvdXRwdXRbcG9zKytdID0gY2hhckNvZGUgPj4gNiAmIDB4M0YgfCAweDgwOwogICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlICYgMHgzRiB8IDB4ODA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA+PiAxOCAmIDB4MDcgfCAweEYwOwogICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlID4+IDEyICYgMHgzRiB8IDB4ODA7CiAgICAgICAgICBvdXRwdXRbcG9zKytdID0gY2hhckNvZGUgPj4gNiAmIDB4M0YgfCAweDgwOwogICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlICYgMHgzRiB8IDB4ODA7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb3V0cHV0OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlVVRGOChpbnB1dCwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgdmFyIG91dHB1dCA9ICIiOwogICAgICB2YXIgdXRmMTY7CiAgICAgIHZhciBwb3MgPSBvZmZzZXQ7CgogICAgICB3aGlsZSAocG9zIDwgb2Zmc2V0ICsgbGVuZ3RoKSB7CiAgICAgICAgdmFyIGJ5dGUxID0gaW5wdXRbcG9zKytdOwogICAgICAgIGlmIChieXRlMSA8IDEyOCkgdXRmMTYgPSBieXRlMTtlbHNlIHsKICAgICAgICAgIHZhciBieXRlMiA9IGlucHV0W3BvcysrXSAtIDEyODsKICAgICAgICAgIGlmIChieXRlMiA8IDApIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuTUFMRk9STUVEX1VURiwgW2J5dGUxLnRvU3RyaW5nKDE2KSwgYnl0ZTIudG9TdHJpbmcoMTYpLCAiIl0pKTsKICAgICAgICAgIGlmIChieXRlMSA8IDB4RTApIC8vIDIgYnl0ZSBjaGFyYWN0ZXIKICAgICAgICAgICAgdXRmMTYgPSA2NCAqIChieXRlMSAtIDB4QzApICsgYnl0ZTI7ZWxzZSB7CiAgICAgICAgICAgIHZhciBieXRlMyA9IGlucHV0W3BvcysrXSAtIDEyODsKICAgICAgICAgICAgaWYgKGJ5dGUzIDwgMCkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5NQUxGT1JNRURfVVRGLCBbYnl0ZTEudG9TdHJpbmcoMTYpLCBieXRlMi50b1N0cmluZygxNiksIGJ5dGUzLnRvU3RyaW5nKDE2KV0pKTsKICAgICAgICAgICAgaWYgKGJ5dGUxIDwgMHhGMCkgLy8gMyBieXRlIGNoYXJhY3RlcgogICAgICAgICAgICAgIHV0ZjE2ID0gNDA5NiAqIChieXRlMSAtIDB4RTApICsgNjQgKiBieXRlMiArIGJ5dGUzO2Vsc2UgewogICAgICAgICAgICAgIHZhciBieXRlNCA9IGlucHV0W3BvcysrXSAtIDEyODsKICAgICAgICAgICAgICBpZiAoYnl0ZTQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLk1BTEZPUk1FRF9VVEYsIFtieXRlMS50b1N0cmluZygxNiksIGJ5dGUyLnRvU3RyaW5nKDE2KSwgYnl0ZTMudG9TdHJpbmcoMTYpLCBieXRlNC50b1N0cmluZygxNildKSk7CiAgICAgICAgICAgICAgaWYgKGJ5dGUxIDwgMHhGOCkgLy8gNCBieXRlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgdXRmMTYgPSAyNjIxNDQgKiAoYnl0ZTEgLSAweEYwKSArIDQwOTYgKiBieXRlMiArIDY0ICogYnl0ZTMgKyBieXRlNDtlbHNlIC8vIGxvbmdlciBlbmNvZGluZ3MgYXJlIG5vdCBzdXBwb3J0ZWQKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuTUFMRk9STUVEX1VURiwgW2J5dGUxLnRvU3RyaW5nKDE2KSwgYnl0ZTIudG9TdHJpbmcoMTYpLCBieXRlMy50b1N0cmluZygxNiksIGJ5dGU0LnRvU3RyaW5nKDE2KV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHV0ZjE2ID4gMHhGRkZGKSAvLyA0IGJ5dGUgY2hhcmFjdGVyIC0gZXhwcmVzcyBhcyBhIHN1cnJvZ2F0ZSBwYWlyCiAgICAgICAgICB7CiAgICAgICAgICAgIHV0ZjE2IC09IDB4MTAwMDA7CiAgICAgICAgICAgIG91dHB1dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4RDgwMCArICh1dGYxNiA+PiAxMCkpOyAvLyBsZWFkIGNoYXJhY3RlcgoKICAgICAgICAgICAgdXRmMTYgPSAweERDMDAgKyAodXRmMTYgJiAweDNGRik7IC8vIHRyYWlsIGNoYXJhY3RlcgogICAgICAgICAgfQoKICAgICAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh1dGYxNik7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlcGVhdCBrZWVwYWxpdmUgcmVxdWVzdHMsIG1vbml0b3IgcmVzcG9uc2VzLgogICAgICogQGlnbm9yZQogICAgICovCgoKICAgIHZhciBQaW5nZXIgPSBmdW5jdGlvbiBQaW5nZXIoY2xpZW50LCB3aW5kb3csIGtlZXBBbGl2ZUludGVydmFsKSB7CiAgICAgIHRoaXMuX2NsaWVudCA9IGNsaWVudDsKICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93OwogICAgICB0aGlzLl9rZWVwQWxpdmVJbnRlcnZhbCA9IGtlZXBBbGl2ZUludGVydmFsICogMTAwMDsKICAgICAgdGhpcy5pc1Jlc2V0ID0gZmFsc2U7CiAgICAgIHZhciBwaW5nUmVxID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5QSU5HUkVRKS5lbmNvZGUoKTsKCiAgICAgIHZhciBkb1RpbWVvdXQgPSBmdW5jdGlvbiBkb1RpbWVvdXQocGluZ2VyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBkb1BpbmcuYXBwbHkocGluZ2VyKTsKICAgICAgICB9OwogICAgICB9OwogICAgICAvKiogQGlnbm9yZSAqLwoKCiAgICAgIHZhciBkb1BpbmcgPSBmdW5jdGlvbiBkb1BpbmcoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzUmVzZXQpIHsKICAgICAgICAgIHRoaXMuX2NsaWVudC5fdHJhY2UoIlBpbmdlci5kb1BpbmciLCAiVGltZWQgb3V0Iik7CgogICAgICAgICAgdGhpcy5fY2xpZW50Ll9kaXNjb25uZWN0ZWQoRVJST1IuUElOR19USU1FT1VULmNvZGUsIGZvcm1hdChFUlJPUi5QSU5HX1RJTUVPVVQpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pc1Jlc2V0ID0gZmFsc2U7CgogICAgICAgICAgdGhpcy5fY2xpZW50Ll90cmFjZSgiUGluZ2VyLmRvUGluZyIsICJzZW5kIFBJTkdSRVEiKTsKCiAgICAgICAgICB0aGlzLl9jbGllbnQuc29ja2V0LnNlbmQocGluZ1JlcSk7CgogICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGhpcy5fd2luZG93LnNldFRpbWVvdXQoZG9UaW1lb3V0KHRoaXMpLCB0aGlzLl9rZWVwQWxpdmVJbnRlcnZhbCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdGhpcy5yZXNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmlzUmVzZXQgPSB0cnVlOwoKICAgICAgICB0aGlzLl93aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7CgogICAgICAgIGlmICh0aGlzLl9rZWVwQWxpdmVJbnRlcnZhbCA+IDApIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoZG9UaW1lb3V0KHRoaXMpLCB0aGlzLl9rZWVwQWxpdmVJbnRlcnZhbCk7CiAgICAgIH07CgogICAgICB0aGlzLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl93aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7CiAgICAgIH07CiAgICB9OwogICAgLyoqCiAgICAgKiBNb25pdG9yIHJlcXVlc3QgY29tcGxldGlvbi4KICAgICAqIEBpZ25vcmUKICAgICAqLwoKCiAgICB2YXIgVGltZW91dCA9IGZ1bmN0aW9uIFRpbWVvdXQoY2xpZW50LCB3aW5kb3csIHRpbWVvdXRTZWNvbmRzLCBhY3Rpb24sIGFyZ3MpIHsKICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93OwogICAgICBpZiAoIXRpbWVvdXRTZWNvbmRzKSB0aW1lb3V0U2Vjb25kcyA9IDMwOwoKICAgICAgdmFyIGRvVGltZW91dCA9IGZ1bmN0aW9uIGRvVGltZW91dChhY3Rpb24sIGNsaWVudCwgYXJncykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gYWN0aW9uLmFwcGx5KGNsaWVudCwgYXJncyk7CiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoZG9UaW1lb3V0KGFjdGlvbiwgY2xpZW50LCBhcmdzKSwgdGltZW91dFNlY29uZHMgKiAxMDAwKTsKCiAgICAgIHRoaXMuY2FuY2VsID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3dpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTsKICAgICAgfTsKICAgIH07CiAgICAvKgogICAgICogSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgdGhlIFdlYnNvY2tldHMgTVFUVCBWMy4xIGNsaWVudC4KICAgICAqCiAgICAgKiBAbmFtZSBQYWhvLk1RVFQuQ2xpZW50SW1wbCBAY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBob3N0IHRoZSBETlMgbmFtZW9mIHRoZSB3ZWJTb2NrZXQgaG9zdC4KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwb3J0IHRoZSBwb3J0IG51bWJlciBmb3IgdGhhdCBob3N0LgogICAgICogQHBhcmFtIHtTdHJpbmd9IGNsaWVudElkIHRoZSBNUSBjbGllbnQgaWRlbnRpZmllci4KICAgICAqLwoKCiAgICB2YXIgQ2xpZW50SW1wbCA9IGZ1bmN0aW9uIENsaWVudEltcGwodXJpLCBob3N0LCBwb3J0LCBwYXRoLCBjbGllbnRJZCkgewogICAgICAvLyBDaGVjayBkZXBlbmRlbmNpZXMgYXJlIHNhdGlzZmllZCBpbiB0aGlzIGJyb3dzZXIuCiAgICAgIGlmICghKCJXZWJTb2NrZXQiIGluIGdsb2JhbCAmJiBnbG9iYWwuV2ViU29ja2V0ICE9PSBudWxsKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuVU5TVVBQT1JURUQsIFsiV2ViU29ja2V0Il0pKTsKICAgICAgfQoKICAgICAgaWYgKCEoImxvY2FsU3RvcmFnZSIgaW4gZ2xvYmFsICYmIGdsb2JhbC5sb2NhbFN0b3JhZ2UgIT09IG51bGwpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRCwgWyJsb2NhbFN0b3JhZ2UiXSkpOwogICAgICB9CgogICAgICBpZiAoISgiQXJyYXlCdWZmZXIiIGluIGdsb2JhbCAmJiBnbG9iYWwuQXJyYXlCdWZmZXIgIT09IG51bGwpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRCwgWyJBcnJheUJ1ZmZlciJdKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3RyYWNlKCJQYWhvLk1RVFQuQ2xpZW50IiwgdXJpLCBob3N0LCBwb3J0LCBwYXRoLCBjbGllbnRJZCk7CgogICAgICB0aGlzLmhvc3QgPSBob3N0OwogICAgICB0aGlzLnBvcnQgPSBwb3J0OwogICAgICB0aGlzLnBhdGggPSBwYXRoOwogICAgICB0aGlzLnVyaSA9IHVyaTsKICAgICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOwogICAgICB0aGlzLl93c3VyaSA9IG51bGw7IC8vIExvY2FsIHN0b3JhZ2VrZXlzIGFyZSBxdWFsaWZpZWQgd2l0aCB0aGUgZm9sbG93aW5nIHN0cmluZy4KICAgICAgLy8gVGhlIGNvbmRpdGlvbmFsIGluY2x1c2lvbiBvZiBwYXRoIGluIHRoZSBrZXkgaXMgZm9yIGJhY2t3YXJkCiAgICAgIC8vIGNvbXBhdGliaWxpdHkgdG8gd2hlbiB0aGUgcGF0aCB3YXMgbm90IGNvbmZpZ3VyYWJsZSBhbmQgYXNzdW1lZCB0bwogICAgICAvLyBiZSAvbXF0dAoKICAgICAgdGhpcy5fbG9jYWxLZXkgPSBob3N0ICsgIjoiICsgcG9ydCArIChwYXRoICE9ICIvbXF0dCIgPyAiOiIgKyBwYXRoIDogIiIpICsgIjoiICsgY2xpZW50SWQgKyAiOiI7IC8vIENyZWF0ZSBwcml2YXRlIGluc3RhbmNlLW9ubHkgbWVzc2FnZSBxdWV1ZQogICAgICAvLyBJbnRlcm5hbCBxdWV1ZSBvZiBtZXNzYWdlcyB0byBiZSBzZW50LCBpbiBzZW5kaW5nIG9yZGVyLgoKICAgICAgdGhpcy5fbXNnX3F1ZXVlID0gW107CiAgICAgIHRoaXMuX2J1ZmZlcmVkX21zZ19xdWV1ZSA9IFtdOyAvLyBNZXNzYWdlcyB3ZSBoYXZlIHNlbnQgYW5kIGFyZSBleHBlY3RpbmcgYSByZXNwb25zZSBmb3IsIGluZGV4ZWQgYnkgdGhlaXIgcmVzcGVjdGl2ZSBtZXNzYWdlIGlkcy4KCiAgICAgIHRoaXMuX3NlbnRNZXNzYWdlcyA9IHt9OyAvLyBNZXNzYWdlcyB3ZSBoYXZlIHJlY2VpdmVkIGFuZCBhY2tub3dsZWdlZCBhbmQgYXJlIGV4cGVjdGluZyBhIGNvbmZpcm0gbWVzc2FnZSBmb3IKICAgICAgLy8gaW5kZXhlZCBieSB0aGVpciByZXNwZWN0aXZlIG1lc3NhZ2UgaWRzLgoKICAgICAgdGhpcy5fcmVjZWl2ZWRNZXNzYWdlcyA9IHt9OyAvLyBJbnRlcm5hbCBsaXN0IG9mIGNhbGxiYWNrcyB0byBiZSBleGVjdXRlZCB3aGVuIG1lc3NhZ2VzCiAgICAgIC8vIGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgc2VudCBvdmVyIHdlYiBzb2NrZXQsIGUuZy4gZGlzY29ubmVjdAogICAgICAvLyB3aGVuIGl0IGRvZXNuJ3QgaGF2ZSB0byB3YWl0IGZvciBBQ0ssIGp1c3QgbWVzc2FnZSBpcyBkaXNwYXRjaGVkLgoKICAgICAgdGhpcy5fbm90aWZ5X21zZ19zZW50ID0ge307IC8vIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBTRU5EIG1lc3NhZ2VzLCBpbmNyZW1lbnRpbmcKICAgICAgLy8gY291bnRlciBhcyBtZXNzYWdlcyBhcmUgc2VudC4KCiAgICAgIHRoaXMuX21lc3NhZ2VfaWRlbnRpZmllciA9IDE7IC8vIFVzZWQgdG8gZGV0ZXJtaW5lIHRoZSB0cmFuc21pc3Npb24gc2VxdWVuY2Ugb2Ygc3RvcmVkIHNlbnQgbWVzc2FnZXMuCgogICAgICB0aGlzLl9zZXF1ZW5jZSA9IDA7IC8vIExvYWQgdGhlIGxvY2FsIHN0YXRlLCBpZiBhbnksIGZyb20gdGhlIHNhdmVkIHZlcnNpb24sIG9ubHkgcmVzdG9yZSBzdGF0ZSByZWxldmFudCB0byB0aGlzIGNsaWVudC4KCiAgICAgIGZvciAodmFyIGtleSBpbiBsb2NhbFN0b3JhZ2UpIHsKICAgICAgICBpZiAoa2V5LmluZGV4T2YoIlNlbnQ6IiArIHRoaXMuX2xvY2FsS2V5KSA9PT0gMCB8fCBrZXkuaW5kZXhPZigiUmVjZWl2ZWQ6IiArIHRoaXMuX2xvY2FsS2V5KSA9PT0gMCkgdGhpcy5yZXN0b3JlKGtleSk7CiAgICAgIH0KICAgIH07IC8vIE1lc3NhZ2luZyBDbGllbnQgcHVibGljIGluc3RhbmNlIG1lbWJlcnMuCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLmhvc3QgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUucG9ydCA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5wYXRoID0gbnVsbDsKICAgIENsaWVudEltcGwucHJvdG90eXBlLnVyaSA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5jbGllbnRJZCA9IG51bGw7IC8vIE1lc3NhZ2luZyBDbGllbnQgcHJpdmF0ZSBpbnN0YW5jZSBtZW1iZXJzLgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnNvY2tldCA9IG51bGw7CiAgICAvKiB0cnVlIG9uY2Ugd2UgaGF2ZSByZWNlaXZlZCBhbiBhY2tub3dsZWRnZW1lbnQgdG8gYSBDT05ORUNUIHBhY2tldC4gKi8KCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5jb25uZWN0ZWQgPSBmYWxzZTsKICAgIC8qIFRoZSBsYXJnZXN0IG1lc3NhZ2UgaWRlbnRpZmllciBhbGxvd2VkLCBtYXkgbm90IGJlIGxhcmdlciB0aGFuIDIqKjE2IGJ1dAogICAgICogaWYgc2V0IHNtYWxsZXIgcmVkdWNlcyB0aGUgbWF4aW11bSBudW1iZXIgb2Ygb3V0Ym91bmQgbWVzc2FnZXMgYWxsb3dlZC4KICAgICAqLwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLm1heE1lc3NhZ2VJZGVudGlmaWVyID0gNjU1MzY7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5jb25uZWN0T3B0aW9ucyA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5ob3N0SW5kZXggPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUub25Db25uZWN0ZWQgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUub25Db25uZWN0aW9uTG9zdCA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5vbk1lc3NhZ2VEZWxpdmVyZWQgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUub25NZXNzYWdlQXJyaXZlZCA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS50cmFjZUZ1bmN0aW9uID0gbnVsbDsKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9tc2dfcXVldWUgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2J1ZmZlcmVkX21zZ19xdWV1ZSA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fY29ubmVjdFRpbWVvdXQgPSBudWxsOwogICAgLyogVGhlIHNlbmRQaW5nZXIgbW9uaXRvcnMgaG93IGxvbmcgd2UgYWxsb3cgYmVmb3JlIHdlIHNlbmQgZGF0YSB0byBwcm92ZSB0byB0aGUgc2VydmVyIHRoYXQgd2UgYXJlIGFsaXZlLiAqLwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnNlbmRQaW5nZXIgPSBudWxsOwogICAgLyogVGhlIHJlY2VpdmVQaW5nZXIgbW9uaXRvcnMgaG93IGxvbmcgd2UgYWxsb3cgYmVmb3JlIHdlIHJlcXVpcmUgZXZpZGVuY2UgdGhhdCB0aGUgc2VydmVyIGlzIGFsaXZlLiAqLwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnJlY2VpdmVQaW5nZXIgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3JlY29ubmVjdEludGVydmFsID0gMTsgLy8gUmVjb25uZWN0IERlbGF5LCBzdGFydHMgYXQgMSBzZWNvbmQKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fcmVjb25uZWN0aW5nID0gZmFsc2U7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fcmVjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5kaXNjb25uZWN0ZWRQdWJsaXNoaW5nID0gZmFsc2U7CiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5kaXNjb25uZWN0ZWRCdWZmZXJTaXplID0gNTAwMDsKICAgIENsaWVudEltcGwucHJvdG90eXBlLnJlY2VpdmVCdWZmZXIgPSBudWxsOwogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3RyYWNlQnVmZmVyID0gbnVsbDsKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9NQVhfVFJBQ0VfRU5UUklFUyA9IDEwMDsKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKGNvbm5lY3RPcHRpb25zKSB7CiAgICAgIHZhciBjb25uZWN0T3B0aW9uc01hc2tlZCA9IHRoaXMuX3RyYWNlTWFzayhjb25uZWN0T3B0aW9ucywgInBhc3N3b3JkIik7CgogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LmNvbm5lY3QiLCBjb25uZWN0T3B0aW9uc01hc2tlZCwgdGhpcy5zb2NrZXQsIHRoaXMuY29ubmVjdGVkKTsKCiAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbImFscmVhZHkgY29ubmVjdGVkIl0pKTsKICAgICAgaWYgKHRoaXMuc29ja2V0KSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfU1RBVEUsIFsiYWxyZWFkeSBjb25uZWN0ZWQiXSkpOwoKICAgICAgaWYgKHRoaXMuX3JlY29ubmVjdGluZykgewogICAgICAgIC8vIGNvbm5lY3QoKSBmdW5jdGlvbiBpcyBjYWxsZWQgd2hpbGUgcmVjb25uZWN0IGlzIGluIHByb2dyZXNzLgogICAgICAgIC8vIFRlcm1pbmF0ZSB0aGUgYXV0byByZWNvbm5lY3QgcHJvY2VzcyB0byB1c2UgbmV3IGNvbm5lY3Qgb3B0aW9ucy4KICAgICAgICB0aGlzLl9yZWNvbm5lY3RUaW1lb3V0LmNhbmNlbCgpOwoKICAgICAgICB0aGlzLl9yZWNvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgICB0aGlzLl9yZWNvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdGhpcy5jb25uZWN0T3B0aW9ucyA9IGNvbm5lY3RPcHRpb25zOwogICAgICB0aGlzLl9yZWNvbm5lY3RJbnRlcnZhbCA9IDE7CiAgICAgIHRoaXMuX3JlY29ubmVjdGluZyA9IGZhbHNlOwoKICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLnVyaXMpIHsKICAgICAgICB0aGlzLmhvc3RJbmRleCA9IDA7CgogICAgICAgIHRoaXMuX2RvQ29ubmVjdChjb25uZWN0T3B0aW9ucy51cmlzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9kb0Nvbm5lY3QodGhpcy51cmkpOwogICAgICB9CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChmaWx0ZXIsIHN1YnNjcmliZU9wdGlvbnMpIHsKICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5zdWJzY3JpYmUiLCBmaWx0ZXIsIHN1YnNjcmliZU9wdGlvbnMpOwoKICAgICAgaWYgKCF0aGlzLmNvbm5lY3RlZCkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbIm5vdCBjb25uZWN0ZWQiXSkpOwogICAgICB2YXIgd2lyZU1lc3NhZ2UgPSBuZXcgV2lyZU1lc3NhZ2UoTUVTU0FHRV9UWVBFLlNVQlNDUklCRSk7CiAgICAgIHdpcmVNZXNzYWdlLnRvcGljcyA9IFtmaWx0ZXJdOwogICAgICBpZiAoc3Vic2NyaWJlT3B0aW9ucy5xb3MgIT09IHVuZGVmaW5lZCkgd2lyZU1lc3NhZ2UucmVxdWVzdGVkUW9zID0gW3N1YnNjcmliZU9wdGlvbnMucW9zXTtlbHNlIHdpcmVNZXNzYWdlLnJlcXVlc3RlZFFvcyA9IFswXTsKCiAgICAgIGlmIChzdWJzY3JpYmVPcHRpb25zLm9uU3VjY2VzcykgewogICAgICAgIHdpcmVNZXNzYWdlLm9uU3VjY2VzcyA9IGZ1bmN0aW9uIChncmFudGVkUW9zKSB7CiAgICAgICAgICBzdWJzY3JpYmVPcHRpb25zLm9uU3VjY2Vzcyh7CiAgICAgICAgICAgIGludm9jYXRpb25Db250ZXh0OiBzdWJzY3JpYmVPcHRpb25zLmludm9jYXRpb25Db250ZXh0LAogICAgICAgICAgICBncmFudGVkUW9zOiBncmFudGVkUW9zCiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAoc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUpIHsKICAgICAgICB3aXJlTWVzc2FnZS5vbkZhaWx1cmUgPSBmdW5jdGlvbiAoZXJyb3JDb2RlKSB7CiAgICAgICAgICBzdWJzY3JpYmVPcHRpb25zLm9uRmFpbHVyZSh7CiAgICAgICAgICAgIGludm9jYXRpb25Db250ZXh0OiBzdWJzY3JpYmVPcHRpb25zLmludm9jYXRpb25Db250ZXh0LAogICAgICAgICAgICBlcnJvckNvZGU6IGVycm9yQ29kZSwKICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBmb3JtYXQoZXJyb3JDb2RlKQogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKHN1YnNjcmliZU9wdGlvbnMudGltZW91dCkgewogICAgICAgIHdpcmVNZXNzYWdlLnRpbWVPdXQgPSBuZXcgVGltZW91dCh0aGlzLCB3aW5kb3csIHN1YnNjcmliZU9wdGlvbnMudGltZW91dCwgc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUsIFt7CiAgICAgICAgICBpbnZvY2F0aW9uQ29udGV4dDogc3Vic2NyaWJlT3B0aW9ucy5pbnZvY2F0aW9uQ29udGV4dCwKICAgICAgICAgIGVycm9yQ29kZTogRVJST1IuU1VCU0NSSUJFX1RJTUVPVVQuY29kZSwKICAgICAgICAgIGVycm9yTWVzc2FnZTogZm9ybWF0KEVSUk9SLlNVQlNDUklCRV9USU1FT1VUKQogICAgICAgIH1dKTsKICAgICAgfSAvLyBBbGwgc3Vic2NyaXB0aW9ucyByZXR1cm4gYSBTVUJBQ0suCgoKICAgICAgdGhpcy5fcmVxdWlyZXNfYWNrKHdpcmVNZXNzYWdlKTsKCiAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2Uod2lyZU1lc3NhZ2UpOwogICAgfTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGZpbHRlciwgdW5zdWJzY3JpYmVPcHRpb25zKSB7CiAgICAgIHRoaXMuX3RyYWNlKCJDbGllbnQudW5zdWJzY3JpYmUiLCBmaWx0ZXIsIHVuc3Vic2NyaWJlT3B0aW9ucyk7CgogICAgICBpZiAoIXRoaXMuY29ubmVjdGVkKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfU1RBVEUsIFsibm90IGNvbm5lY3RlZCJdKSk7CiAgICAgIHZhciB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuVU5TVUJTQ1JJQkUpOwogICAgICB3aXJlTWVzc2FnZS50b3BpY3MgPSBbZmlsdGVyXTsKCiAgICAgIGlmICh1bnN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzKSB7CiAgICAgICAgd2lyZU1lc3NhZ2UuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB1bnN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzKHsKICAgICAgICAgICAgaW52b2NhdGlvbkNvbnRleHQ6IHVuc3Vic2NyaWJlT3B0aW9ucy5pbnZvY2F0aW9uQ29udGV4dAogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKHVuc3Vic2NyaWJlT3B0aW9ucy50aW1lb3V0KSB7CiAgICAgICAgd2lyZU1lc3NhZ2UudGltZU91dCA9IG5ldyBUaW1lb3V0KHRoaXMsIHdpbmRvdywgdW5zdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQsIHVuc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUsIFt7CiAgICAgICAgICBpbnZvY2F0aW9uQ29udGV4dDogdW5zdWJzY3JpYmVPcHRpb25zLmludm9jYXRpb25Db250ZXh0LAogICAgICAgICAgZXJyb3JDb2RlOiBFUlJPUi5VTlNVQlNDUklCRV9USU1FT1VULmNvZGUsCiAgICAgICAgICBlcnJvck1lc3NhZ2U6IGZvcm1hdChFUlJPUi5VTlNVQlNDUklCRV9USU1FT1VUKQogICAgICAgIH1dKTsKICAgICAgfSAvLyBBbGwgdW5zdWJzY3JpYmVzIHJldHVybiBhIFNVQkFDSy4KCgogICAgICB0aGlzLl9yZXF1aXJlc19hY2sod2lyZU1lc3NhZ2UpOwoKICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZSh3aXJlTWVzc2FnZSk7CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LnNlbmQiLCBtZXNzYWdlKTsKCiAgICAgIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5QVUJMSVNIKTsKICAgICAgd2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UgPSBtZXNzYWdlOwoKICAgICAgaWYgKHRoaXMuY29ubmVjdGVkKSB7CiAgICAgICAgLy8gTWFyayBxb3MgMSAmIDIgbWVzc2FnZSBhcyAiQUNLIHJlcXVpcmVkIgogICAgICAgIC8vIEZvciBxb3MgMCBtZXNzYWdlLCBpbnZva2Ugb25NZXNzYWdlRGVsaXZlcmVkIGNhbGxiYWNrIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAvLyBUaGVuIHNjaGVkdWxlIHRoZSBtZXNzYWdlLgogICAgICAgIGlmIChtZXNzYWdlLnFvcyA+IDApIHsKICAgICAgICAgIHRoaXMuX3JlcXVpcmVzX2Fjayh3aXJlTWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZCkgewogICAgICAgICAgdGhpcy5fbm90aWZ5X21zZ19zZW50W3dpcmVNZXNzYWdlXSA9IHRoaXMub25NZXNzYWdlRGVsaXZlcmVkKHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2Uod2lyZU1lc3NhZ2UpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEN1cnJlbnRseSBkaXNjb25uZWN0ZWQsIHdpbGwgbm90IHNjaGVkdWxlIHRoaXMgbWVzc2FnZQogICAgICAgIC8vIENoZWNrIGlmIHJlY29ubmVjdGluZyBpcyBpbiBwcm9ncmVzcyBhbmQgZGlzY29ubmVjdGVkIHB1Ymxpc2ggaXMgZW5hYmxlZC4KICAgICAgICBpZiAodGhpcy5fcmVjb25uZWN0aW5nICYmIHRoaXMuZGlzY29ubmVjdGVkUHVibGlzaGluZykgewogICAgICAgICAgLy8gQ2hlY2sgdGhlIGxpbWl0IHdoaWNoIGluY2x1ZGUgdGhlICJyZXF1aXJlZCBBQ0siIG1lc3NhZ2VzCiAgICAgICAgICB2YXIgbWVzc2FnZUNvdW50ID0gT2JqZWN0LmtleXModGhpcy5fc2VudE1lc3NhZ2VzKS5sZW5ndGggKyB0aGlzLl9idWZmZXJlZF9tc2dfcXVldWUubGVuZ3RoOwoKICAgICAgICAgIGlmIChtZXNzYWdlQ291bnQgPiB0aGlzLmRpc2Nvbm5lY3RlZEJ1ZmZlclNpemUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5CVUZGRVJfRlVMTCwgW3RoaXMuZGlzY29ubmVjdGVkQnVmZmVyU2l6ZV0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChtZXNzYWdlLnFvcyA+IDApIHsKICAgICAgICAgICAgICAvLyBNYXJrIHRoaXMgbWVzc2FnZSBhcyAiQUNLIHJlcXVpcmVkIgogICAgICAgICAgICAgIHRoaXMuX3JlcXVpcmVzX2Fjayh3aXJlTWVzc2FnZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd2lyZU1lc3NhZ2Uuc2VxdWVuY2UgPSArK3RoaXMuX3NlcXVlbmNlOwoKICAgICAgICAgICAgICB0aGlzLl9idWZmZXJlZF9tc2dfcXVldWUucHVzaCh3aXJlTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbIm5vdCBjb25uZWN0ZWQiXSkpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LmRpc2Nvbm5lY3QiKTsKCiAgICAgIGlmICh0aGlzLl9yZWNvbm5lY3RpbmcpIHsKICAgICAgICAvLyBkaXNjb25uZWN0KCkgZnVuY3Rpb24gaXMgY2FsbGVkIHdoaWxlIHJlY29ubmVjdCBpcyBpbiBwcm9ncmVzcy4KICAgICAgICAvLyBUZXJtaW5hdGUgdGhlIGF1dG8gcmVjb25uZWN0IHByb2Nlc3MuCiAgICAgICAgdGhpcy5fcmVjb25uZWN0VGltZW91dC5jYW5jZWwoKTsKCiAgICAgICAgdGhpcy5fcmVjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICAgICAgdGhpcy5fcmVjb25uZWN0aW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5zb2NrZXQpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9TVEFURSwgWyJub3QgY29ubmVjdGluZyBvciBjb25uZWN0ZWQiXSkpOwogICAgICB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuRElTQ09OTkVDVCk7IC8vIFJ1biB0aGUgZGlzY29ubmVjdGVkIGNhbGwgYmFjayBhcyBzb29uIGFzIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHNlbnQsCiAgICAgIC8vIGluIGNhc2Ugb2YgYSBmYWlsdXJlIGxhdGVyIG9uIGluIHRoZSBkaXNjb25uZWN0IHByb2Nlc3NpbmcuCiAgICAgIC8vIGFzIGEgY29uc2VxdWVuY2UsIHRoZSBfZGlzY29uZWN0ZWQgY2FsbCBiYWNrIG1heSBiZSBydW4gc2V2ZXJhbCB0aW1lcy4KCiAgICAgIHRoaXMuX25vdGlmeV9tc2dfc2VudFt3aXJlTWVzc2FnZV0gPSBzY29wZSh0aGlzLl9kaXNjb25uZWN0ZWQsIHRoaXMpOwoKICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZSh3aXJlTWVzc2FnZSk7CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLmdldFRyYWNlTG9nID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5fdHJhY2VCdWZmZXIgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LmdldFRyYWNlTG9nIiwgbmV3IERhdGUoKSk7CgogICAgICAgIHRoaXMuX3RyYWNlKCJDbGllbnQuZ2V0VHJhY2VMb2cgaW4gZmxpZ2h0IG1lc3NhZ2VzIiwgdGhpcy5fc2VudE1lc3NhZ2VzLmxlbmd0aCk7CgogICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9zZW50TWVzc2FnZXMpIHsKICAgICAgICAgIHRoaXMuX3RyYWNlKCJfc2VudE1lc3NhZ2VzICIsIGtleSwgdGhpcy5fc2VudE1lc3NhZ2VzW2tleV0pOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXMpIHsKICAgICAgICAgIHRoaXMuX3RyYWNlKCJfcmVjZWl2ZWRNZXNzYWdlcyAiLCBrZXksIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2VCdWZmZXI7CiAgICAgIH0KICAgIH07CgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuc3RhcnRUcmFjZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMuX3RyYWNlQnVmZmVyID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5fdHJhY2VCdWZmZXIgPSBbXTsKICAgICAgfQoKICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5zdGFydFRyYWNlIiwgbmV3IERhdGUoKSwgdmVyc2lvbik7CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnN0b3BUcmFjZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZGVsZXRlIHRoaXMuX3RyYWNlQnVmZmVyOwogICAgfTsKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fZG9Db25uZWN0ID0gZnVuY3Rpb24gKHdzdXJsKSB7CiAgICAgIC8vIFdoZW4gdGhlIHNvY2tldCBpcyBvcGVuLCB0aGlzIGNsaWVudCB3aWxsIHNlbmQgdGhlIENPTk5FQ1QgV2lyZU1lc3NhZ2UgdXNpbmcgdGhlIHNhdmVkIHBhcmFtZXRlcnMuCiAgICAgIGlmICh0aGlzLmNvbm5lY3RPcHRpb25zLnVzZVNTTCkgewogICAgICAgIHZhciB1cmlQYXJ0cyA9IHdzdXJsLnNwbGl0KCI6Iik7CiAgICAgICAgdXJpUGFydHNbMF0gPSAid3NzIjsKICAgICAgICB3c3VybCA9IHVyaVBhcnRzLmpvaW4oIjoiKTsKICAgICAgfQoKICAgICAgdGhpcy5fd3N1cmkgPSB3c3VybDsKICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsKCiAgICAgIGlmICh0aGlzLmNvbm5lY3RPcHRpb25zLm1xdHRWZXJzaW9uIDwgNCkgewogICAgICAgIHRoaXMuc29ja2V0ID0gbmV3IFdlYlNvY2tldCh3c3VybCwgWyJtcXR0djMuMSJdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBXZWJTb2NrZXQod3N1cmwsIFsibXF0dCJdKTsKICAgICAgfQoKICAgICAgdGhpcy5zb2NrZXQuYmluYXJ5VHlwZSA9ICdhcnJheWJ1ZmZlcic7CiAgICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IHNjb3BlKHRoaXMuX29uX3NvY2tldF9vcGVuLCB0aGlzKTsKICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gc2NvcGUodGhpcy5fb25fc29ja2V0X21lc3NhZ2UsIHRoaXMpOwogICAgICB0aGlzLnNvY2tldC5vbmVycm9yID0gc2NvcGUodGhpcy5fb25fc29ja2V0X2Vycm9yLCB0aGlzKTsKICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IHNjb3BlKHRoaXMuX29uX3NvY2tldF9jbG9zZSwgdGhpcyk7CiAgICAgIHRoaXMuc2VuZFBpbmdlciA9IG5ldyBQaW5nZXIodGhpcywgd2luZG93LCB0aGlzLmNvbm5lY3RPcHRpb25zLmtlZXBBbGl2ZUludGVydmFsKTsKICAgICAgdGhpcy5yZWNlaXZlUGluZ2VyID0gbmV3IFBpbmdlcih0aGlzLCB3aW5kb3csIHRoaXMuY29ubmVjdE9wdGlvbnMua2VlcEFsaXZlSW50ZXJ2YWwpOwoKICAgICAgaWYgKHRoaXMuX2Nvbm5lY3RUaW1lb3V0KSB7CiAgICAgICAgdGhpcy5fY29ubmVjdFRpbWVvdXQuY2FuY2VsKCk7CgogICAgICAgIHRoaXMuX2Nvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgfQoKICAgICAgdGhpcy5fY29ubmVjdFRpbWVvdXQgPSBuZXcgVGltZW91dCh0aGlzLCB3aW5kb3csIHRoaXMuY29ubmVjdE9wdGlvbnMudGltZW91dCwgdGhpcy5fZGlzY29ubmVjdGVkLCBbRVJST1IuQ09OTkVDVF9USU1FT1VULmNvZGUsIGZvcm1hdChFUlJPUi5DT05ORUNUX1RJTUVPVVQpXSk7CiAgICB9OyAvLyBTY2hlZHVsZSBhIG5ldyBtZXNzYWdlIHRvIGJlIHNlbnQgb3ZlciB0aGUgV2ViU29ja2V0cwogICAgLy8gY29ubmVjdGlvbi4gQ09OTkVDVCBtZXNzYWdlcyBjYXVzZSBXZWJTb2NrZXQgY29ubmVjdGlvbgogICAgLy8gdG8gYmUgc3RhcnRlZC4gQWxsIG90aGVyIG1lc3NhZ2VzIGFyZSBxdWV1ZWQgaW50ZXJuYWxseQogICAgLy8gdW50aWwgdGhpcyBoYXMgaGFwcGVuZWQuIFdoZW4gV1MgY29ubmVjdGlvbiBzdGFydHMsIHByb2Nlc3MKICAgIC8vIGFsbCBvdXRzdGFuZGluZyBtZXNzYWdlcy4KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3NjaGVkdWxlX21lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICB0aGlzLl9tc2dfcXVldWUucHVzaChtZXNzYWdlKTsgLy8gUHJvY2VzcyBvdXRzdGFuZGluZyBtZXNzYWdlcyBpbiB0aGUgcXVldWUgaWYgd2UgaGF2ZSBhbiAgb3BlbiBzb2NrZXQsIGFuZCBoYXZlIHJlY2VpdmVkIENPTk5BQ0suCgoKICAgICAgaWYgKHRoaXMuY29ubmVjdGVkKSB7CiAgICAgICAgdGhpcy5fcHJvY2Vzc19xdWV1ZSgpOwogICAgICB9CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLnN0b3JlID0gZnVuY3Rpb24gKHByZWZpeCwgd2lyZU1lc3NhZ2UpIHsKICAgICAgdmFyIHN0b3JlZE1lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogd2lyZU1lc3NhZ2UudHlwZSwKICAgICAgICBtZXNzYWdlSWRlbnRpZmllcjogd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIsCiAgICAgICAgdmVyc2lvbjogMQogICAgICB9OwoKICAgICAgc3dpdGNoICh3aXJlTWVzc2FnZS50eXBlKSB7CiAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCTElTSDoKICAgICAgICAgIGlmICh3aXJlTWVzc2FnZS5wdWJSZWNSZWNlaXZlZCkgc3RvcmVkTWVzc2FnZS5wdWJSZWNSZWNlaXZlZCA9IHRydWU7IC8vIENvbnZlcnQgdGhlIHBheWxvYWQgdG8gYSBoZXggc3RyaW5nLgoKICAgICAgICAgIHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UgPSB7fTsKICAgICAgICAgIHZhciBoZXggPSAiIjsKICAgICAgICAgIHZhciBtZXNzYWdlQnl0ZXMgPSB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5wYXlsb2FkQnl0ZXM7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlQnl0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1lc3NhZ2VCeXRlc1tpXSA8PSAweEYpIGhleCA9IGhleCArICIwIiArIG1lc3NhZ2VCeXRlc1tpXS50b1N0cmluZygxNik7ZWxzZSBoZXggPSBoZXggKyBtZXNzYWdlQnl0ZXNbaV0udG9TdHJpbmcoMTYpOwogICAgICAgICAgfQoKICAgICAgICAgIHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucGF5bG9hZEhleCA9IGhleDsKICAgICAgICAgIHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucW9zID0gd2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucW9zOwogICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUgPSB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWU7CiAgICAgICAgICBpZiAod2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UuZHVwbGljYXRlKSBzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSA9IHRydWU7CiAgICAgICAgICBpZiAod2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucmV0YWluZWQpIHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucmV0YWluZWQgPSB0cnVlOyAvLyBBZGQgYSBzZXF1ZW5jZSBudW1iZXIgdG8gc2VudCBtZXNzYWdlcy4KCiAgICAgICAgICBpZiAocHJlZml4LmluZGV4T2YoIlNlbnQ6IikgPT09IDApIHsKICAgICAgICAgICAgaWYgKHdpcmVNZXNzYWdlLnNlcXVlbmNlID09PSB1bmRlZmluZWQpIHdpcmVNZXNzYWdlLnNlcXVlbmNlID0gKyt0aGlzLl9zZXF1ZW5jZTsKICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5zZXF1ZW5jZSA9IHdpcmVNZXNzYWdlLnNlcXVlbmNlOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfU1RPUkVEX0RBVEEsIFtrZXksIHN0b3JlZE1lc3NhZ2VdKSk7CiAgICAgIH0KCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByZWZpeCArIHRoaXMuX2xvY2FsS2V5ICsgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIsIEpTT04uc3RyaW5naWZ5KHN0b3JlZE1lc3NhZ2UpKTsKICAgIH07CgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUucmVzdG9yZSA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIHZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTsKICAgICAgdmFyIHN0b3JlZE1lc3NhZ2UgPSBKU09OLnBhcnNlKHZhbHVlKTsKICAgICAgdmFyIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKHN0b3JlZE1lc3NhZ2UudHlwZSwgc3RvcmVkTWVzc2FnZSk7CgogICAgICBzd2l0Y2ggKHN0b3JlZE1lc3NhZ2UudHlwZSkgewogICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkxJU0g6CiAgICAgICAgICAvLyBSZXBsYWNlIHRoZSBwYXlsb2FkIG1lc3NhZ2Ugd2l0aCBhIE1lc3NhZ2Ugb2JqZWN0LgogICAgICAgICAgdmFyIGhleCA9IHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucGF5bG9hZEhleDsKICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoaGV4Lmxlbmd0aCAvIDIpOwogICAgICAgICAgdmFyIGJ5dGVTdHJlYW0gPSBuZXcgVWludDhBcnJheShidWZmZXIpOwogICAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICAgIHdoaWxlIChoZXgubGVuZ3RoID49IDIpIHsKICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChoZXguc3Vic3RyaW5nKDAsIDIpLCAxNik7CiAgICAgICAgICAgIGhleCA9IGhleC5zdWJzdHJpbmcoMiwgaGV4Lmxlbmd0aCk7CiAgICAgICAgICAgIGJ5dGVTdHJlYW1baSsrXSA9IHg7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBheWxvYWRNZXNzYWdlID0gbmV3IFBhaG8uTVFUVC5NZXNzYWdlKGJ5dGVTdHJlYW0pOwogICAgICAgICAgcGF5bG9hZE1lc3NhZ2UucW9zID0gc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5xb3M7CiAgICAgICAgICBwYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUgPSBzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZTsKICAgICAgICAgIGlmIChzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSkgcGF5bG9hZE1lc3NhZ2UuZHVwbGljYXRlID0gdHJ1ZTsKICAgICAgICAgIGlmIChzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLnJldGFpbmVkKSBwYXlsb2FkTWVzc2FnZS5yZXRhaW5lZCA9IHRydWU7CiAgICAgICAgICB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZSA9IHBheWxvYWRNZXNzYWdlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9TVE9SRURfREFUQSwgW2tleSwgdmFsdWVdKSk7CiAgICAgIH0KCiAgICAgIGlmIChrZXkuaW5kZXhPZigiU2VudDoiICsgdGhpcy5fbG9jYWxLZXkpID09PSAwKSB7CiAgICAgICAgd2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UuZHVwbGljYXRlID0gdHJ1ZTsKICAgICAgICB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdID0gd2lyZU1lc3NhZ2U7CiAgICAgIH0gZWxzZSBpZiAoa2V5LmluZGV4T2YoIlJlY2VpdmVkOiIgKyB0aGlzLl9sb2NhbEtleSkgPT09IDApIHsKICAgICAgICB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXSA9IHdpcmVNZXNzYWdlOwogICAgICB9CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9wcm9jZXNzX3F1ZXVlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgbWVzc2FnZSA9IG51bGw7IC8vIFByb2Nlc3MgbWVzc2FnZXMgaW4gb3JkZXIgdGhleSB3ZXJlIGFkZGVkCgogICAgICB2YXIgZmlmbyA9IHRoaXMuX21zZ19xdWV1ZS5yZXZlcnNlKCk7IC8vIFNlbmQgYWxsIHF1ZXVlZCBtZXNzYWdlcyBkb3duIHNvY2tldCBjb25uZWN0aW9uCgoKICAgICAgd2hpbGUgKG1lc3NhZ2UgPSBmaWZvLnBvcCgpKSB7CiAgICAgICAgdGhpcy5fc29ja2V0X3NlbmQobWVzc2FnZSk7IC8vIE5vdGlmeSBsaXN0ZW5lcnMgdGhhdCBtZXNzYWdlIHdhcyBzdWNjZXNzZnVsbHkgc2VudAoKCiAgICAgICAgaWYgKHRoaXMuX25vdGlmeV9tc2dfc2VudFttZXNzYWdlXSkgewogICAgICAgICAgdGhpcy5fbm90aWZ5X21zZ19zZW50W21lc3NhZ2VdKCk7CgogICAgICAgICAgZGVsZXRlIHRoaXMuX25vdGlmeV9tc2dfc2VudFttZXNzYWdlXTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEV4cGVjdCBhbiBBQ0sgcmVzcG9uc2UgZm9yIHRoaXMgbWVzc2FnZS4gQWRkIG1lc3NhZ2UgdG8gdGhlIHNldCBvZiBpbiBwcm9ncmVzcwogICAgICogbWVzc2FnZXMgYW5kIHNldCBhbiB1bnVzZWQgaWRlbnRpZmllciBpbiB0aGlzIG1lc3NhZ2UuCiAgICAgKiBAaWdub3JlCiAgICAgKi8KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3JlcXVpcmVzX2FjayA9IGZ1bmN0aW9uICh3aXJlTWVzc2FnZSkgewogICAgICB2YXIgbWVzc2FnZUNvdW50ID0gT2JqZWN0LmtleXModGhpcy5fc2VudE1lc3NhZ2VzKS5sZW5ndGg7CiAgICAgIGlmIChtZXNzYWdlQ291bnQgPiB0aGlzLm1heE1lc3NhZ2VJZGVudGlmaWVyKSB0aHJvdyBFcnJvcigiVG9vIG1hbnkgbWVzc2FnZXM6IiArIG1lc3NhZ2VDb3VudCk7CgogICAgICB3aGlsZSAodGhpcy5fc2VudE1lc3NhZ2VzW3RoaXMuX21lc3NhZ2VfaWRlbnRpZmllcl0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX21lc3NhZ2VfaWRlbnRpZmllcisrOwogICAgICB9CgogICAgICB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllciA9IHRoaXMuX21lc3NhZ2VfaWRlbnRpZmllcjsKICAgICAgdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXSA9IHdpcmVNZXNzYWdlOwoKICAgICAgaWYgKHdpcmVNZXNzYWdlLnR5cGUgPT09IE1FU1NBR0VfVFlQRS5QVUJMSVNIKSB7CiAgICAgICAgdGhpcy5zdG9yZSgiU2VudDoiLCB3aXJlTWVzc2FnZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9tZXNzYWdlX2lkZW50aWZpZXIgPT09IHRoaXMubWF4TWVzc2FnZUlkZW50aWZpZXIpIHsKICAgICAgICB0aGlzLl9tZXNzYWdlX2lkZW50aWZpZXIgPSAxOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgdW5kZXJseWluZyB3ZWJzb2NrZXQgaGFzIGJlZW4gb3BlbmVkLgogICAgICogQGlnbm9yZQogICAgICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9vbl9zb2NrZXRfb3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gQ3JlYXRlIHRoZSBDT05ORUNUIG1lc3NhZ2Ugb2JqZWN0LgogICAgICB2YXIgd2lyZU1lc3NhZ2UgPSBuZXcgV2lyZU1lc3NhZ2UoTUVTU0FHRV9UWVBFLkNPTk5FQ1QsIHRoaXMuY29ubmVjdE9wdGlvbnMpOwogICAgICB3aXJlTWVzc2FnZS5jbGllbnRJZCA9IHRoaXMuY2xpZW50SWQ7CgogICAgICB0aGlzLl9zb2NrZXRfc2VuZCh3aXJlTWVzc2FnZSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgdW5kZXJseWluZyB3ZWJzb2NrZXQgaGFzIHJlY2VpdmVkIGEgY29tcGxldGUgcGFja2V0LgogICAgICogQGlnbm9yZQogICAgICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9vbl9zb2NrZXRfbWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50Ll9vbl9zb2NrZXRfbWVzc2FnZSIsIGV2ZW50LmRhdGEpOwoKICAgICAgdmFyIG1lc3NhZ2VzID0gdGhpcy5fZGVmcmFtZU1lc3NhZ2VzKGV2ZW50LmRhdGEpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgIHRoaXMuX2hhbmRsZU1lc3NhZ2UobWVzc2FnZXNbaV0pOwogICAgICB9CiAgICB9OwoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9kZWZyYW1lTWVzc2FnZXMgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICB2YXIgYnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgICAgIHZhciBtZXNzYWdlcyA9IFtdOwoKICAgICAgaWYgKHRoaXMucmVjZWl2ZUJ1ZmZlcikgewogICAgICAgIHZhciBuZXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5yZWNlaXZlQnVmZmVyLmxlbmd0aCArIGJ5dGVBcnJheS5sZW5ndGgpOwogICAgICAgIG5ld0RhdGEuc2V0KHRoaXMucmVjZWl2ZUJ1ZmZlcik7CiAgICAgICAgbmV3RGF0YS5zZXQoYnl0ZUFycmF5LCB0aGlzLnJlY2VpdmVCdWZmZXIubGVuZ3RoKTsKICAgICAgICBieXRlQXJyYXkgPSBuZXdEYXRhOwogICAgICAgIGRlbGV0ZSB0aGlzLnJlY2VpdmVCdWZmZXI7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG9mZnNldCA9IDA7CgogICAgICAgIHdoaWxlIChvZmZzZXQgPCBieXRlQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gZGVjb2RlTWVzc2FnZShieXRlQXJyYXksIG9mZnNldCk7CiAgICAgICAgICB2YXIgd2lyZU1lc3NhZ2UgPSByZXN1bHRbMF07CiAgICAgICAgICBvZmZzZXQgPSByZXN1bHRbMV07CgogICAgICAgICAgaWYgKHdpcmVNZXNzYWdlICE9PSBudWxsKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2god2lyZU1lc3NhZ2UpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAob2Zmc2V0IDwgYnl0ZUFycmF5Lmxlbmd0aCkgewogICAgICAgICAgdGhpcy5yZWNlaXZlQnVmZmVyID0gYnl0ZUFycmF5LnN1YmFycmF5KG9mZnNldCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHZhciBlcnJvclN0YWNrID0gZXJyb3IuaGFzT3duUHJvcGVydHkoJ3N0YWNrJykgPT0gJ3VuZGVmaW5lZCcgPyBlcnJvci5zdGFjay50b1N0cmluZygpIDogIk5vIEVycm9yIFN0YWNrIEF2YWlsYWJsZSI7CgogICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RlZChFUlJPUi5JTlRFUk5BTF9FUlJPUi5jb2RlLCBmb3JtYXQoRVJST1IuSU5URVJOQUxfRVJST1IsIFtlcnJvci5tZXNzYWdlLCBlcnJvclN0YWNrXSkpOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiBtZXNzYWdlczsKICAgIH07CgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2hhbmRsZU1lc3NhZ2UgPSBmdW5jdGlvbiAod2lyZU1lc3NhZ2UpIHsKICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5faGFuZGxlTWVzc2FnZSIsIHdpcmVNZXNzYWdlKTsKCiAgICAgIHRyeSB7CiAgICAgICAgc3dpdGNoICh3aXJlTWVzc2FnZS50eXBlKSB7CiAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5DT05OQUNLOgogICAgICAgICAgICB0aGlzLl9jb25uZWN0VGltZW91dC5jYW5jZWwoKTsKCiAgICAgICAgICAgIGlmICh0aGlzLl9yZWNvbm5lY3RUaW1lb3V0KSB0aGlzLl9yZWNvbm5lY3RUaW1lb3V0LmNhbmNlbCgpOyAvLyBJZiB3ZSBoYXZlIHN0YXJ0ZWQgdXNpbmcgY2xlYW4gc2Vzc2lvbiB0aGVuIGNsZWFyIHVwIHRoZSBsb2NhbCBzdGF0ZS4KCiAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3RPcHRpb25zLmNsZWFuU2Vzc2lvbikgewogICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9zZW50TWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgIHZhciBzZW50TWVzc2FnZSA9IHRoaXMuX3NlbnRNZXNzYWdlc1trZXldOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIlNlbnQ6IiArIHRoaXMuX2xvY2FsS2V5ICsgc2VudE1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5fc2VudE1lc3NhZ2VzID0ge307CgogICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVjZWl2ZWRNZXNzYWdlID0gdGhpcy5fcmVjZWl2ZWRNZXNzYWdlc1trZXldOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIlJlY2VpdmVkOiIgKyB0aGlzLl9sb2NhbEtleSArIHJlY2VpdmVkTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzID0ge307CiAgICAgICAgICAgIH0gLy8gQ2xpZW50IGNvbm5lY3RlZCBhbmQgcmVhZHkgZm9yIGJ1c2luZXNzLgoKCiAgICAgICAgICAgIGlmICh3aXJlTWVzc2FnZS5yZXR1cm5Db2RlID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlOyAvLyBKdW1wIHRvIHRoZSBlbmQgb2YgdGhlIGxpc3Qgb2YgdXJpcyBhbmQgc3RvcCBsb29raW5nIGZvciBhIGdvb2QgaG9zdC4KCiAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMudXJpcykgdGhpcy5ob3N0SW5kZXggPSB0aGlzLmNvbm5lY3RPcHRpb25zLnVyaXMubGVuZ3RoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RlZChFUlJPUi5DT05OQUNLX1JFVFVSTkNPREUuY29kZSwgZm9ybWF0KEVSUk9SLkNPTk5BQ0tfUkVUVVJOQ09ERSwgW3dpcmVNZXNzYWdlLnJldHVybkNvZGUsIENPTk5BQ0tfUkNbd2lyZU1lc3NhZ2UucmV0dXJuQ29kZV1dKSk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IC8vIFJlc2VuZCBtZXNzYWdlcy4KCgogICAgICAgICAgICB2YXIgc2VxdWVuY2VkTWVzc2FnZXMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIG1zZ0lkIGluIHRoaXMuX3NlbnRNZXNzYWdlcykgewogICAgICAgICAgICAgIGlmICh0aGlzLl9zZW50TWVzc2FnZXMuaGFzT3duUHJvcGVydHkobXNnSWQpKSBzZXF1ZW5jZWRNZXNzYWdlcy5wdXNoKHRoaXMuX3NlbnRNZXNzYWdlc1ttc2dJZF0pOwogICAgICAgICAgICB9IC8vIEFsc28gc2NoZWR1bGUgcW9zIDAgYnVmZmVyZWQgbWVzc2FnZXMgaWYgYW55CgoKICAgICAgICAgICAgaWYgKHRoaXMuX2J1ZmZlcmVkX21zZ19xdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7CgogICAgICAgICAgICAgIHZhciBmaWZvID0gdGhpcy5fYnVmZmVyZWRfbXNnX3F1ZXVlLnJldmVyc2UoKTsKCiAgICAgICAgICAgICAgd2hpbGUgKG1zZyA9IGZpZm8ucG9wKCkpIHsKICAgICAgICAgICAgICAgIHNlcXVlbmNlZE1lc3NhZ2VzLnB1c2gobXNnKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZCkgdGhpcy5fbm90aWZ5X21zZ19zZW50W21zZ10gPSB0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZChtc2cucGF5bG9hZE1lc3NhZ2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBTb3J0IHNlbnRNZXNzYWdlcyBpbnRvIHRoZSBvcmlnaW5hbCBzZW50IG9yZGVyLgoKCiAgICAgICAgICAgIHZhciBzZXF1ZW5jZWRNZXNzYWdlcyA9IHNlcXVlbmNlZE1lc3NhZ2VzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gYS5zZXF1ZW5jZSAtIGIuc2VxdWVuY2U7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlcXVlbmNlZE1lc3NhZ2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gc2VxdWVuY2VkTWVzc2FnZXNbaV07CgogICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS50eXBlID09IE1FU1NBR0VfVFlQRS5QVUJMSVNIICYmIHNlbnRNZXNzYWdlLnB1YlJlY1JlY2VpdmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgcHViUmVsTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCUkVMLCB7CiAgICAgICAgICAgICAgICAgIG1lc3NhZ2VJZGVudGlmaWVyOiBzZW50TWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZShwdWJSZWxNZXNzYWdlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZShzZW50TWVzc2FnZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IC8vIEV4ZWN1dGUgdGhlIGNvbm5lY3RPcHRpb25zLm9uU3VjY2VzcyBjYWxsYmFjayBpZiB0aGVyZSBpcyBvbmUuCiAgICAgICAgICAgIC8vIFdpbGwgYWxzbyBub3cgcmV0dXJuIGlmIHRoaXMgY29ubmVjdGlvbiB3YXMgdGhlIHJlc3VsdCBvZiBhbiBhdXRvbWF0aWMKICAgICAgICAgICAgLy8gcmVjb25uZWN0IGFuZCB3aGljaCBVUkkgd2FzIHN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8uCgoKICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMub25TdWNjZXNzKSB7CiAgICAgICAgICAgICAgdGhpcy5jb25uZWN0T3B0aW9ucy5vblN1Y2Nlc3MoewogICAgICAgICAgICAgICAgaW52b2NhdGlvbkNvbnRleHQ6IHRoaXMuY29ubmVjdE9wdGlvbnMuaW52b2NhdGlvbkNvbnRleHQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlY29ubmVjdGVkID0gZmFsc2U7CgogICAgICAgICAgICBpZiAodGhpcy5fcmVjb25uZWN0aW5nKSB7CiAgICAgICAgICAgICAgcmVjb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuX3JlY29ubmVjdEludGVydmFsID0gMTsKICAgICAgICAgICAgICB0aGlzLl9yZWNvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSAvLyBFeGVjdXRlIHRoZSBvbkNvbm5lY3RlZCBjYWxsYmFjayBpZiB0aGVyZSBpcyBvbmUuCgoKICAgICAgICAgICAgdGhpcy5fY29ubmVjdGVkKHJlY29ubmVjdGVkLCB0aGlzLl93c3VyaSk7IC8vIFByb2Nlc3MgYWxsIHF1ZXVlZCBtZXNzYWdlcyBub3cgdGhhdCB0aGUgY29ubmVjdGlvbiBpcyBlc3RhYmxpc2hlZC4KCgogICAgICAgICAgICB0aGlzLl9wcm9jZXNzX3F1ZXVlKCk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJMSVNIOgogICAgICAgICAgICB0aGlzLl9yZWNlaXZlUHVibGlzaCh3aXJlTWVzc2FnZSk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJBQ0s6CiAgICAgICAgICAgIHZhciBzZW50TWVzc2FnZSA9IHRoaXMuX3NlbnRNZXNzYWdlc1t3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcl07IC8vIElmIHRoaXMgaXMgYSByZSBmbG93IG9mIGEgUFVCQUNLIGFmdGVyIHdlIGhhdmUgcmVzdGFydGVkIHJlY2VpdmVkTWVzc2FnZSB3aWxsIG5vdCBleGlzdC4KCiAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZSkgewogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOwogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJTZW50OiIgKyB0aGlzLl9sb2NhbEtleSArIHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyKTsKICAgICAgICAgICAgICBpZiAodGhpcy5vbk1lc3NhZ2VEZWxpdmVyZWQpIHRoaXMub25NZXNzYWdlRGVsaXZlcmVkKHNlbnRNZXNzYWdlLnBheWxvYWRNZXNzYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCUkVDOgogICAgICAgICAgICB2YXIgc2VudE1lc3NhZ2UgPSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOyAvLyBJZiB0aGlzIGlzIGEgcmUgZmxvdyBvZiBhIFBVQlJFQyBhZnRlciB3ZSBoYXZlIHJlc3RhcnRlZCByZWNlaXZlZE1lc3NhZ2Ugd2lsbCBub3QgZXhpc3QuCgogICAgICAgICAgICBpZiAoc2VudE1lc3NhZ2UpIHsKICAgICAgICAgICAgICBzZW50TWVzc2FnZS5wdWJSZWNSZWNlaXZlZCA9IHRydWU7CiAgICAgICAgICAgICAgdmFyIHB1YlJlbE1lc3NhZ2UgPSBuZXcgV2lyZU1lc3NhZ2UoTUVTU0FHRV9UWVBFLlBVQlJFTCwgewogICAgICAgICAgICAgICAgbWVzc2FnZUlkZW50aWZpZXI6IHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5zdG9yZSgiU2VudDoiLCBzZW50TWVzc2FnZSk7CgogICAgICAgICAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2UocHViUmVsTWVzc2FnZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFTDoKICAgICAgICAgICAgdmFyIHJlY2VpdmVkTWVzc2FnZSA9IHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiUmVjZWl2ZWQ6IiArIHRoaXMuX2xvY2FsS2V5ICsgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIpOyAvLyBJZiB0aGlzIGlzIGEgcmUgZmxvdyBvZiBhIFBVQlJFTCBhZnRlciB3ZSBoYXZlIHJlc3RhcnRlZCByZWNlaXZlZE1lc3NhZ2Ugd2lsbCBub3QgZXhpc3QuCgogICAgICAgICAgICBpZiAocmVjZWl2ZWRNZXNzYWdlKSB7CiAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZU1lc3NhZ2UocmVjZWl2ZWRNZXNzYWdlKTsKCiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOwogICAgICAgICAgICB9IC8vIEFsd2F5cyBmbG93IFB1YkNvbXAsIHdlIG1heSBoYXZlIHByZXZpb3VzbHkgZmxvd2VkIFB1YkNvbXAgYnV0IHRoZSBzZXJ2ZXIgbG9zdCBpdCBhbmQgcmVzdGFydGVkLgoKCiAgICAgICAgICAgIHZhciBwdWJDb21wTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCQ09NUCwgewogICAgICAgICAgICAgIG1lc3NhZ2VJZGVudGlmaWVyOiB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2UocHViQ29tcE1lc3NhZ2UpOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCQ09NUDoKICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3NlbnRNZXNzYWdlc1t3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcl07CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJTZW50OiIgKyB0aGlzLl9sb2NhbEtleSArIHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyKTsKICAgICAgICAgICAgaWYgKHRoaXMub25NZXNzYWdlRGVsaXZlcmVkKSB0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZChzZW50TWVzc2FnZS5wYXlsb2FkTWVzc2FnZSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlNVQkFDSzoKICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsKCiAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZSkgewogICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS50aW1lT3V0KSBzZW50TWVzc2FnZS50aW1lT3V0LmNhbmNlbCgpOyAvLyBUaGlzIHdpbGwgbmVlZCB0byBiZSBmaXhlZCB3aGVuIHdlIGFkZCBtdWx0aXBsZSB0b3BpYyBzdXBwb3J0CgogICAgICAgICAgICAgIGlmICh3aXJlTWVzc2FnZS5yZXR1cm5Db2RlWzBdID09PSAweDgwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VudE1lc3NhZ2Uub25GYWlsdXJlKSB7CiAgICAgICAgICAgICAgICAgIHNlbnRNZXNzYWdlLm9uRmFpbHVyZSh3aXJlTWVzc2FnZS5yZXR1cm5Db2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbnRNZXNzYWdlLm9uU3VjY2VzcykgewogICAgICAgICAgICAgICAgc2VudE1lc3NhZ2Uub25TdWNjZXNzKHdpcmVNZXNzYWdlLnJldHVybkNvZGUpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3NlbnRNZXNzYWdlc1t3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcl07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlVOU1VCQUNLOgogICAgICAgICAgICB2YXIgc2VudE1lc3NhZ2UgPSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOwoKICAgICAgICAgICAgaWYgKHNlbnRNZXNzYWdlKSB7CiAgICAgICAgICAgICAgaWYgKHNlbnRNZXNzYWdlLnRpbWVPdXQpIHNlbnRNZXNzYWdlLnRpbWVPdXQuY2FuY2VsKCk7CgogICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS5jYWxsYmFjaykgewogICAgICAgICAgICAgICAgc2VudE1lc3NhZ2UuY2FsbGJhY2soKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QSU5HUkVTUDoKICAgICAgICAgICAgLyogVGhlIHNlbmRQaW5nZXIgb3IgcmVjZWl2ZVBpbmdlciBtYXkgaGF2ZSBzZW50IGEgcGluZywgdGhlIHJlY2VpdmVQaW5nZXIgaGFzIGFscmVhZHkgYmVlbiByZXNldC4gKi8KICAgICAgICAgICAgdGhpcy5zZW5kUGluZ2VyLnJlc2V0KCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkRJU0NPTk5FQ1Q6CiAgICAgICAgICAgIC8vIENsaWVudHMgZG8gbm90IGV4cGVjdCB0byByZWNlaXZlIGRpc2Nvbm5lY3QgcGFja2V0cy4KICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUuY29kZSwgZm9ybWF0KEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUsIFt3aXJlTWVzc2FnZS50eXBlXSkpOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUuY29kZSwgZm9ybWF0KEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUsIFt3aXJlTWVzc2FnZS50eXBlXSkpOwoKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdmFyIGVycm9yU3RhY2sgPSBlcnJvci5oYXNPd25Qcm9wZXJ0eSgnc3RhY2snKSA9PSAndW5kZWZpbmVkJyA/IGVycm9yLnN0YWNrLnRvU3RyaW5nKCkgOiAiTm8gRXJyb3IgU3RhY2sgQXZhaWxhYmxlIjsKCiAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLklOVEVSTkFMX0VSUk9SLmNvZGUsIGZvcm1hdChFUlJPUi5JTlRFUk5BTF9FUlJPUiwgW2Vycm9yLm1lc3NhZ2UsIGVycm9yU3RhY2tdKSk7CgogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9vbl9zb2NrZXRfZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgaWYgKCF0aGlzLl9yZWNvbm5lY3RpbmcpIHsKICAgICAgICB0aGlzLl9kaXNjb25uZWN0ZWQoRVJST1IuU09DS0VUX0VSUk9SLmNvZGUsIGZvcm1hdChFUlJPUi5TT0NLRVRfRVJST1IsIFtlcnJvci5kYXRhXSkpOwogICAgICB9CiAgICB9OwogICAgLyoqIEBpZ25vcmUgKi8KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX29uX3NvY2tldF9jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLl9yZWNvbm5lY3RpbmcpIHsKICAgICAgICB0aGlzLl9kaXNjb25uZWN0ZWQoRVJST1IuU09DS0VUX0NMT1NFLmNvZGUsIGZvcm1hdChFUlJPUi5TT0NLRVRfQ0xPU0UpKTsKICAgICAgfQogICAgfTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9zb2NrZXRfc2VuZCA9IGZ1bmN0aW9uICh3aXJlTWVzc2FnZSkgewogICAgICBpZiAod2lyZU1lc3NhZ2UudHlwZSA9PSAxKSB7CiAgICAgICAgdmFyIHdpcmVNZXNzYWdlTWFza2VkID0gdGhpcy5fdHJhY2VNYXNrKHdpcmVNZXNzYWdlLCAicGFzc3dvcmQiKTsKCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5fc29ja2V0X3NlbmQiLCB3aXJlTWVzc2FnZU1hc2tlZCk7CiAgICAgIH0gZWxzZSB0aGlzLl90cmFjZSgiQ2xpZW50Ll9zb2NrZXRfc2VuZCIsIHdpcmVNZXNzYWdlKTsKCiAgICAgIHRoaXMuc29ja2V0LnNlbmQod2lyZU1lc3NhZ2UuZW5jb2RlKCkpOwogICAgICAvKiBXZSBoYXZlIHByb3ZlZCB0byB0aGUgc2VydmVyIHdlIGFyZSBhbGl2ZS4gKi8KCiAgICAgIHRoaXMuc2VuZFBpbmdlci5yZXNldCgpOwogICAgfTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIENsaWVudEltcGwucHJvdG90eXBlLl9yZWNlaXZlUHVibGlzaCA9IGZ1bmN0aW9uICh3aXJlTWVzc2FnZSkgewogICAgICBzd2l0Y2ggKHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlLnFvcykgewogICAgICAgIGNhc2UgInVuZGVmaW5lZCI6CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgdGhpcy5fcmVjZWl2ZU1lc3NhZ2Uod2lyZU1lc3NhZ2UpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB2YXIgcHViQWNrTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCQUNLLCB7CiAgICAgICAgICAgIG1lc3NhZ2VJZGVudGlmaWVyOiB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcgogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZShwdWJBY2tNZXNzYWdlKTsKCiAgICAgICAgICB0aGlzLl9yZWNlaXZlTWVzc2FnZSh3aXJlTWVzc2FnZSk7CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdID0gd2lyZU1lc3NhZ2U7CiAgICAgICAgICB0aGlzLnN0b3JlKCJSZWNlaXZlZDoiLCB3aXJlTWVzc2FnZSk7CiAgICAgICAgICB2YXIgcHViUmVjTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCUkVDLCB7CiAgICAgICAgICAgIG1lc3NhZ2VJZGVudGlmaWVyOiB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcgogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZShwdWJSZWNNZXNzYWdlKTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IEVycm9yKCJJbnZhaWxkIHFvcz0iICsgd2lyZU1tZXNzYWdlLnBheWxvYWRNZXNzYWdlLnFvcyk7CiAgICAgIH0KICAgIH07CiAgICAvKiogQGlnbm9yZSAqLwoKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fcmVjZWl2ZU1lc3NhZ2UgPSBmdW5jdGlvbiAod2lyZU1lc3NhZ2UpIHsKICAgICAgaWYgKHRoaXMub25NZXNzYWdlQXJyaXZlZCkgewogICAgICAgIHRoaXMub25NZXNzYWdlQXJyaXZlZCh3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIENsaWVudCBoYXMgY29ubmVjdGVkLgogICAgICogQHBhcmFtIHtyZWNvbm5lY3R9IFtib29sZWFuXSBpbmRpY2F0ZSBpZiB0aGlzIHdhcyBhIHJlc3VsdCBvZiByZWNvbm5lY3Qgb3BlcmF0aW9uLgogICAgICogQHBhcmFtIHt1cml9IFtzdHJpbmddIGZ1bGx5IHF1YWxpZmllZCBXZWJTb2NrZXQgVVJJIG9mIHRoZSBzZXJ2ZXIuCiAgICAgKi8KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2Nvbm5lY3RlZCA9IGZ1bmN0aW9uIChyZWNvbm5lY3QsIHVyaSkgewogICAgICAvLyBFeGVjdXRlIHRoZSBvbkNvbm5lY3RlZCBjYWxsYmFjayBpZiB0aGVyZSBpcyBvbmUuCiAgICAgIGlmICh0aGlzLm9uQ29ubmVjdGVkKSB0aGlzLm9uQ29ubmVjdGVkKHJlY29ubmVjdCwgdXJpKTsKICAgIH07CiAgICAvKioKICAgICAqIEF0dGVtcHRzIHRvIHJlY29ubmVjdCB0aGUgY2xpZW50IHRvIHRoZSBzZXJ2ZXIuCiAgICAgICogRm9yIGVhY2ggcmVjb25uZWN0IGF0dGVtcHQsIHdpbGwgZG91YmxlIHRoZSByZWNvbm5lY3QgaW50ZXJ2YWwKICAgICAgKiB1cCB0byAxMjggc2Vjb25kcy4KICAgICAqLwoKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fcmVjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50Ll9yZWNvbm5lY3QiKTsKCiAgICAgIGlmICghdGhpcy5jb25uZWN0ZWQpIHsKICAgICAgICB0aGlzLl9yZWNvbm5lY3RpbmcgPSB0cnVlOwogICAgICAgIHRoaXMuc2VuZFBpbmdlci5jYW5jZWwoKTsKICAgICAgICB0aGlzLnJlY2VpdmVQaW5nZXIuY2FuY2VsKCk7CiAgICAgICAgaWYgKHRoaXMuX3JlY29ubmVjdEludGVydmFsIDwgMTI4KSB0aGlzLl9yZWNvbm5lY3RJbnRlcnZhbCA9IHRoaXMuX3JlY29ubmVjdEludGVydmFsICogMjsKCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMudXJpcykgewogICAgICAgICAgdGhpcy5ob3N0SW5kZXggPSAwOwoKICAgICAgICAgIHRoaXMuX2RvQ29ubmVjdCh0aGlzLmNvbm5lY3RPcHRpb25zLnVyaXNbMF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9kb0Nvbm5lY3QodGhpcy51cmkpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogQ2xpZW50IGhhcyBkaXNjb25uZWN0ZWQgZWl0aGVyIGF0IGl0cyBvd24gcmVxdWVzdCBvciBiZWNhdXNlIHRoZSBzZXJ2ZXIKICAgICAqIG9yIG5ldHdvcmsgZGlzY29ubmVjdGVkIGl0LiBSZW1vdmUgYWxsIG5vbi1kdXJhYmxlIHN0YXRlLgogICAgICogQHBhcmFtIHtlcnJvckNvZGV9IFtudW1iZXJdIHRoZSBlcnJvciBudW1iZXIuCiAgICAgKiBAcGFyYW0ge2Vycm9yVGV4dH0gW3N0cmluZ10gdGhlIGVycm9yIHRleHQuCiAgICAgKiBAaWdub3JlCiAgICAgKi8KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2Rpc2Nvbm5lY3RlZCA9IGZ1bmN0aW9uIChlcnJvckNvZGUsIGVycm9yVGV4dCkgewogICAgICB0aGlzLl90cmFjZSgiQ2xpZW50Ll9kaXNjb25uZWN0ZWQiLCBlcnJvckNvZGUsIGVycm9yVGV4dCk7CgogICAgICBpZiAoZXJyb3JDb2RlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fcmVjb25uZWN0aW5nKSB7CiAgICAgICAgLy9Db250aW51ZSBhdXRvbWF0aWMgcmVjb25uZWN0IHByb2Nlc3MKICAgICAgICB0aGlzLl9yZWNvbm5lY3RUaW1lb3V0ID0gbmV3IFRpbWVvdXQodGhpcywgd2luZG93LCB0aGlzLl9yZWNvbm5lY3RJbnRlcnZhbCwgdGhpcy5fcmVjb25uZWN0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2VuZFBpbmdlci5jYW5jZWwoKTsKICAgICAgdGhpcy5yZWNlaXZlUGluZ2VyLmNhbmNlbCgpOwoKICAgICAgaWYgKHRoaXMuX2Nvbm5lY3RUaW1lb3V0KSB7CiAgICAgICAgdGhpcy5fY29ubmVjdFRpbWVvdXQuY2FuY2VsKCk7CgogICAgICAgIHRoaXMuX2Nvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgfSAvLyBDbGVhciBtZXNzYWdlIGJ1ZmZlcnMuCgoKICAgICAgdGhpcy5fbXNnX3F1ZXVlID0gW107CiAgICAgIHRoaXMuX2J1ZmZlcmVkX21zZ19xdWV1ZSA9IFtdOwogICAgICB0aGlzLl9ub3RpZnlfbXNnX3NlbnQgPSB7fTsKCiAgICAgIGlmICh0aGlzLnNvY2tldCkgewogICAgICAgIC8vIENhbmNlbCBhbGwgc29ja2V0IGNhbGxiYWNrcyBzbyB0aGF0IHRoZXkgY2Fubm90IGJlIGRyaXZlbiBhZ2FpbiBieSB0aGlzIHNvY2tldC4KICAgICAgICB0aGlzLnNvY2tldC5vbm9wZW4gPSBudWxsOwogICAgICAgIHRoaXMuc29ja2V0Lm9ubWVzc2FnZSA9IG51bGw7CiAgICAgICAgdGhpcy5zb2NrZXQub25lcnJvciA9IG51bGw7CiAgICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IG51bGw7CiAgICAgICAgaWYgKHRoaXMuc29ja2V0LnJlYWR5U3RhdGUgPT09IDEpIHRoaXMuc29ja2V0LmNsb3NlKCk7CiAgICAgICAgZGVsZXRlIHRoaXMuc29ja2V0OwogICAgICB9CgogICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy51cmlzICYmIHRoaXMuaG9zdEluZGV4IDwgdGhpcy5jb25uZWN0T3B0aW9ucy51cmlzLmxlbmd0aCAtIDEpIHsKICAgICAgICAvLyBUcnkgdGhlIG5leHQgaG9zdC4KICAgICAgICB0aGlzLmhvc3RJbmRleCsrOwoKICAgICAgICB0aGlzLl9kb0Nvbm5lY3QodGhpcy5jb25uZWN0T3B0aW9ucy51cmlzW3RoaXMuaG9zdEluZGV4XSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGVycm9yQ29kZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBlcnJvckNvZGUgPSBFUlJPUi5PSy5jb2RlOwogICAgICAgICAgZXJyb3JUZXh0ID0gZm9ybWF0KEVSUk9SLk9LKTsKICAgICAgICB9IC8vIFJ1biBhbnkgYXBwbGljYXRpb24gY2FsbGJhY2tzIGxhc3QgYXMgdGhleSBtYXkgYXR0ZW1wdCB0byByZWNvbm5lY3QgYW5kIGhlbmNlIGNyZWF0ZSBhIG5ldyBzb2NrZXQuCgoKICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWQpIHsKICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7IC8vIEV4ZWN1dGUgdGhlIGNvbm5lY3Rpb25Mb3N0Q2FsbGJhY2sgaWYgdGhlcmUgaXMgb25lLCBhbmQgd2Ugd2VyZSBjb25uZWN0ZWQuCgogICAgICAgICAgaWYgKHRoaXMub25Db25uZWN0aW9uTG9zdCkgewogICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvbkxvc3QoewogICAgICAgICAgICAgIGVycm9yQ29kZTogZXJyb3JDb2RlLAogICAgICAgICAgICAgIGVycm9yTWVzc2FnZTogZXJyb3JUZXh0LAogICAgICAgICAgICAgIHJlY29ubmVjdDogdGhpcy5jb25uZWN0T3B0aW9ucy5yZWNvbm5lY3QsCiAgICAgICAgICAgICAgdXJpOiB0aGlzLl93c3VyaQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXJyb3JDb2RlICE9PSBFUlJPUi5PSy5jb2RlICYmIHRoaXMuY29ubmVjdE9wdGlvbnMucmVjb25uZWN0KSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IGF1dG9tYXRpYyByZWNvbm5lY3QgcHJvY2VzcyBmb3IgdGhlIHZlcnkgZmlyc3QgdGltZSBzaW5jZSBsYXN0IHN1Y2Nlc3NmdWwgY29ubmVjdC4KICAgICAgICAgICAgdGhpcy5fcmVjb25uZWN0SW50ZXJ2YWwgPSAxOwoKICAgICAgICAgICAgdGhpcy5fcmVjb25uZWN0KCk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSBuZXZlciBoYWQgYSBjb25uZWN0aW9uLCBzbyBpbmRpY2F0ZSB0aGF0IHRoZSBjb25uZWN0IGhhcyBmYWlsZWQuCiAgICAgICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiA9PT0gNCAmJiB0aGlzLmNvbm5lY3RPcHRpb25zLm1xdHRWZXJzaW9uRXhwbGljaXQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNlKCJGYWlsZWQgdG8gY29ubmVjdCBWNCwgZHJvcHBpbmcgYmFjayB0byBWMyIpOwoKICAgICAgICAgICAgdGhpcy5jb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiA9IDM7CgogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy51cmlzKSB7CiAgICAgICAgICAgICAgdGhpcy5ob3N0SW5kZXggPSAwOwoKICAgICAgICAgICAgICB0aGlzLl9kb0Nvbm5lY3QodGhpcy5jb25uZWN0T3B0aW9ucy51cmlzWzBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLl9kb0Nvbm5lY3QodGhpcy51cmkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMub25GYWlsdXJlKSB7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdE9wdGlvbnMub25GYWlsdXJlKHsKICAgICAgICAgICAgICBpbnZvY2F0aW9uQ29udGV4dDogdGhpcy5jb25uZWN0T3B0aW9ucy5pbnZvY2F0aW9uQ29udGV4dCwKICAgICAgICAgICAgICBlcnJvckNvZGU6IGVycm9yQ29kZSwKICAgICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGVycm9yVGV4dAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICAvKiogQGlnbm9yZSAqLwoKCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fdHJhY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIFBhc3MgdHJhY2UgbWVzc2FnZSBiYWNrIHRvIGNsaWVudCdzIGNhbGxiYWNrIGZ1bmN0aW9uCiAgICAgIGlmICh0aGlzLnRyYWNlRnVuY3Rpb24pIHsKICAgICAgICBmb3IgKHZhciBpIGluIGFyZ3VtZW50cykgewogICAgICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbaV0gIT09ICJ1bmRlZmluZWQiKSBhcmd1bWVudHMuc3BsaWNlKGksIDEsIEpTT04uc3RyaW5naWZ5KGFyZ3VtZW50c1tpXSkpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlY29yZCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykuam9pbigiIik7CiAgICAgICAgdGhpcy50cmFjZUZ1bmN0aW9uKHsKICAgICAgICAgIHNldmVyaXR5OiAiRGVidWciLAogICAgICAgICAgbWVzc2FnZTogcmVjb3JkCiAgICAgICAgfSk7CiAgICAgIH0gLy9idWZmZXIgc3R5bGUgdHJhY2UKCgogICAgICBpZiAodGhpcy5fdHJhY2VCdWZmZXIgIT09IG51bGwpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbWF4ID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5fdHJhY2VCdWZmZXIubGVuZ3RoID09IHRoaXMuX01BWF9UUkFDRV9FTlRSSUVTKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNlQnVmZmVyLnNoaWZ0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGkgPT09IDApIHRoaXMuX3RyYWNlQnVmZmVyLnB1c2goYXJndW1lbnRzW2ldKTtlbHNlIGlmICh0eXBlb2YgYXJndW1lbnRzW2ldID09PSAidW5kZWZpbmVkIikgdGhpcy5fdHJhY2VCdWZmZXIucHVzaChhcmd1bWVudHNbaV0pO2Vsc2UgdGhpcy5fdHJhY2VCdWZmZXIucHVzaCgiICAiICsgSlNPTi5zdHJpbmdpZnkoYXJndW1lbnRzW2ldKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgLyoqIEBpZ25vcmUgKi8KCgogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3RyYWNlTWFzayA9IGZ1bmN0aW9uICh0cmFjZU9iamVjdCwgbWFza2VkKSB7CiAgICAgIHZhciB0cmFjZU9iamVjdE1hc2tlZCA9IHt9OwoKICAgICAgZm9yICh2YXIgYXR0ciBpbiB0cmFjZU9iamVjdCkgewogICAgICAgIGlmICh0cmFjZU9iamVjdC5oYXNPd25Qcm9wZXJ0eShhdHRyKSkgewogICAgICAgICAgaWYgKGF0dHIgPT0gbWFza2VkKSB0cmFjZU9iamVjdE1hc2tlZFthdHRyXSA9ICIqKioqKioiO2Vsc2UgdHJhY2VPYmplY3RNYXNrZWRbYXR0cl0gPSB0cmFjZU9iamVjdFthdHRyXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cmFjZU9iamVjdE1hc2tlZDsKICAgIH07IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUHVibGljIFByb2dyYW1taW5nIGludGVyZmFjZS4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgICogVGhlIEphdmFTY3JpcHQgYXBwbGljYXRpb24gY29tbXVuaWNhdGVzIHRvIHRoZSBzZXJ2ZXIgdXNpbmcgYSB7QGxpbmsgUGFoby5NUVRULkNsaWVudH0gb2JqZWN0LgogICAgICogPHA+CiAgICAgKiBNb3N0IGFwcGxpY2F0aW9ucyB3aWxsIGNyZWF0ZSBqdXN0IG9uZSBDbGllbnQgb2JqZWN0IGFuZCB0aGVuIGNhbGwgaXRzIGNvbm5lY3QoKSBtZXRob2QsCiAgICAgKiBob3dldmVyIGFwcGxpY2F0aW9ucyBjYW4gY3JlYXRlIG1vcmUgdGhhbiBvbmUgQ2xpZW50IG9iamVjdCBpZiB0aGV5IHdpc2guCiAgICAgKiBJbiB0aGlzIGNhc2UgdGhlIGNvbWJpbmF0aW9uIG9mIGhvc3QsIHBvcnQgYW5kIGNsaWVudElkIGF0dHJpYnV0ZXMgbXVzdCBiZSBkaWZmZXJlbnQgZm9yIGVhY2ggQ2xpZW50IG9iamVjdC4KICAgICAqIDxwPgogICAgICogVGhlIHNlbmQsIHN1YnNjcmliZSBhbmQgdW5zdWJzY3JpYmUgbWV0aG9kcyBhcmUgaW1wbGVtZW50ZWQgYXMgYXN5bmNocm9ub3VzIEphdmFTY3JpcHQgbWV0aG9kcwogICAgICogKGV2ZW4gdGhvdWdoIHRoZSB1bmRlcmx5aW5nIHByb3RvY29sIGV4Y2hhbmdlIG1pZ2h0IGJlIHN5bmNocm9ub3VzIGluIG5hdHVyZSkuCiAgICAgKiBUaGlzIG1lYW5zIHRoZXkgc2lnbmFsIHRoZWlyIGNvbXBsZXRpb24gYnkgY2FsbGluZyBiYWNrIHRvIHRoZSBhcHBsaWNhdGlvbiwKICAgICAqIHZpYSBTdWNjZXNzIG9yIEZhaWx1cmUgY2FsbGJhY2sgZnVuY3Rpb25zIHByb3ZpZGVkIGJ5IHRoZSBhcHBsaWNhdGlvbiBvbiB0aGUgbWV0aG9kIGluIHF1ZXN0aW9uLgogICAgICogU3VjaCBjYWxsYmFja3MgYXJlIGNhbGxlZCBhdCBtb3N0IG9uY2UgcGVyIG1ldGhvZCBpbnZvY2F0aW9uIGFuZCBkbyBub3QgcGVyc2lzdCBiZXlvbmQgdGhlIGxpZmV0aW1lCiAgICAgKiBvZiB0aGUgc2NyaXB0IHRoYXQgbWFkZSB0aGUgaW52b2NhdGlvbi4KICAgICAqIDxwPgogICAgICogSW4gY29udHJhc3QgdGhlcmUgYXJlIHNvbWUgY2FsbGJhY2sgZnVuY3Rpb25zLCBtb3N0IG5vdGFibHkgPGk+b25NZXNzYWdlQXJyaXZlZDwvaT4sCiAgICAgKiB0aGF0IGFyZSBkZWZpbmVkIG9uIHRoZSB7QGxpbmsgUGFoby5NUVRULkNsaWVudH0gb2JqZWN0LgogICAgICogVGhlc2UgbWF5IGdldCBjYWxsZWQgbXVsdGlwbGUgdGltZXMsIGFuZCBhcmVuJ3QgZGlyZWN0bHkgcmVsYXRlZCB0byBzcGVjaWZpYyBtZXRob2QgaW52b2NhdGlvbnMgbWFkZSBieSB0aGUgY2xpZW50LgogICAgICoKICAgICAqIEBuYW1lIFBhaG8uTVFUVC5DbGllbnQKICAgICAqCiAgICAgKiBAY29uc3RydWN0b3IKICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdCAtIHRoZSBhZGRyZXNzIG9mIHRoZSBtZXNzYWdpbmcgc2VydmVyLCBhcyBhIGZ1bGx5IHF1YWxpZmllZCBXZWJTb2NrZXQgVVJJLCBhcyBhIEROUyBuYW1lIG9yIGRvdHRlZCBkZWNpbWFsIElQIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gcG9ydCAtIHRoZSBwb3J0IG51bWJlciB0byBjb25uZWN0IHRvIC0gb25seSByZXF1aXJlZCBpZiBob3N0IGlzIG5vdCBhIFVSSQogICAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSB0aGUgcGF0aCBvbiB0aGUgaG9zdCB0byBjb25uZWN0IHRvIC0gb25seSB1c2VkIGlmIGhvc3QgaXMgbm90IGEgVVJJLiBEZWZhdWx0OiAnL21xdHQnLgogICAgICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIC0gdGhlIE1lc3NhZ2luZyBjbGllbnQgaWRlbnRpZmllciwgYmV0d2VlbiAxIGFuZCAyMyBjaGFyYWN0ZXJzIGluIGxlbmd0aC4KICAgICAqCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gaG9zdCAtIDxpPnJlYWQgb25seTwvaT4gdGhlIHNlcnZlcidzIEROUyBob3N0bmFtZSBvciBkb3R0ZWQgZGVjaW1hbCBJUCBhZGRyZXNzLgogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHBvcnQgLSA8aT5yZWFkIG9ubHk8L2k+IHRoZSBzZXJ2ZXIncyBwb3J0LgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IHBhdGggLSA8aT5yZWFkIG9ubHk8L2k+IHRoZSBzZXJ2ZXIncyBwYXRoLgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGNsaWVudElkIC0gPGk+cmVhZCBvbmx5PC9pPiB1c2VkIHdoZW4gY29ubmVjdGluZyB0byB0aGUgc2VydmVyLgogICAgICogQHByb3BlcnR5IHtmdW5jdGlvbn0gb25Db25uZWN0aW9uTG9zdCAtIGNhbGxlZCB3aGVuIGEgY29ubmVjdGlvbiBoYXMgYmVlbiBsb3N0LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXIgYSBjb25uZWN0KCkgbWV0aG9kIGhhcyBzdWNjZWVkZWQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFc3RhYmxpc2ggdGhlIGNhbGwgYmFjayB1c2VkIHdoZW4gYSBjb25uZWN0aW9uIGhhcyBiZWVuIGxvc3QuIFRoZSBjb25uZWN0aW9uIG1heSBiZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9zdCBiZWNhdXNlIHRoZSBjbGllbnQgaW5pdGlhdGVzIGEgZGlzY29ubmVjdCBvciBiZWNhdXNlIHRoZSBzZXJ2ZXIgb3IgbmV0d29yawogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2UgdGhlIGNsaWVudCB0byBiZSBkaXNjb25uZWN0ZWQuIFRoZSBkaXNjb25uZWN0IGNhbGwgYmFjayBtYXkgYmUgY2FsbGVkIHdpdGhvdXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBjb25uZWN0aW9uQ29tcGxldGUgY2FsbCBiYWNrIGJlaW5nIGludm9rZWQgaWYsIGZvciBleGFtcGxlIHRoZSBjbGllbnQgZmFpbHMgdG8KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3QuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25Db25uZWN0aW9uTG9zdCBjYWxsYmFjayBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgZmllbGRzOgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9sPgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPmVycm9yQ29kZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPmVycm9yTWVzc2FnZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9vbD4KICAgICAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IG9uTWVzc2FnZURlbGl2ZXJlZCAtIGNhbGxlZCB3aGVuIGEgbWVzc2FnZSBoYXMgYmVlbiBkZWxpdmVyZWQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGwgcHJvY2Vzc2luZyB0aGF0IHRoaXMgQ2xpZW50IHdpbGwgZXZlciBkbyBoYXMgYmVlbiBjb21wbGV0ZWQuIFNvLCBmb3IgZXhhbXBsZSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBjYXNlIG9mIGEgUW9zPTIgbWVzc2FnZSBzZW50IGJ5IHRoaXMgY2xpZW50LCB0aGUgUHViQ29tcCBmbG93IGhhcyBiZWVuIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBwZXJzaXN0ZW50IHN0b3JhZ2UgYmVmb3JlIHRoaXMgY2FsbGJhY2sgaXMgaW52b2tlZC4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtZXRlcnMgcGFzc2VkIHRvIHRoZSBvbk1lc3NhZ2VEZWxpdmVyZWQgY2FsbGJhY2sgYXJlOgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9sPgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPntAbGluayBQYWhvLk1RVFQuTWVzc2FnZX0gdGhhdCB3YXMgZGVsaXZlcmVkLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9vbD4KICAgICAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IG9uTWVzc2FnZUFycml2ZWQgLSBjYWxsZWQgd2hlbiBhIG1lc3NhZ2UgaGFzIGFycml2ZWQgaW4gdGhpcyBQYWhvLk1RVFQuY2xpZW50LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW1ldGVycyBwYXNzZWQgdG8gdGhlIG9uTWVzc2FnZUFycml2ZWQgY2FsbGJhY2sgYXJlOgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9sPgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPntAbGluayBQYWhvLk1RVFQuTWVzc2FnZX0gdGhhdCBoYXMgYXJyaXZlZC4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvb2w+CiAgICAgKiBAcHJvcGVydHkge2Z1bmN0aW9ufSBvbkNvbm5lY3RlZCAtIGNhbGxlZCB3aGVuIGEgY29ubmVjdGlvbiBpcyBzdWNjZXNzZnVsbHkgbWFkZSB0byB0aGUgc2VydmVyLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXIgYSBjb25uZWN0KCkgbWV0aG9kLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW1ldGVycyBwYXNzZWQgdG8gdGhlIG9uQ29ubmVjdGVkIGNhbGxiYWNrIGFyZToKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvbD4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5yZWNvbm5lY3QgKGJvb2xlYW4pIC0gSWYgdHJ1ZSwgdGhlIGNvbm5lY3Rpb24gd2FzIHRoZSByZXN1bHQgb2YgYSByZWNvbm5lY3QuPC9saT4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5VUkkgKHN0cmluZykgLSBUaGUgVVJJIHVzZWQgdG8gY29ubmVjdCB0byB0aGUgc2VydmVyLjwvbGk+CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L29sPgogICAgICogQHByb3BlcnR5IHtib29sZWFufSBkaXNjb25uZWN0ZWRQdWJsaXNoaW5nIC0gaWYgc2V0LCB3aWxsIGVuYWJsZSBkaXNjb25uZWN0ZWQgcHVibGlzaGluZyBpbgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBldmVudCB0aGF0IHRoZSBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgaXMgbG9zdC4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkaXNjb25uZWN0ZWRCdWZmZXJTaXplIC0gVXNlZCB0byBzZXQgdGhlIG1heGltdW0gbnVtYmVyIG9mIG1lc3NhZ2VzIHRoYXQgdGhlIGRpc2Nvbm5lY3RlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIgd2lsbCBob2xkIGJlZm9yZSByZWplY3RpbmcgbmV3IG1lc3NhZ2VzLiBEZWZhdWx0IHNpemU6IDUwMDAgbWVzc2FnZXMKICAgICAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IHRyYWNlIC0gY2FsbGVkIHdoZW5ldmVyIHRyYWNlIGlzIGNhbGxlZC4gVE9ETwogICAgICovCgoKICAgIHZhciBDbGllbnQgPSBmdW5jdGlvbiBDbGllbnQoaG9zdCwgcG9ydCwgcGF0aCwgY2xpZW50SWQpIHsKICAgICAgdmFyIHVyaTsKICAgICAgaWYgKHR5cGVvZiBob3N0ICE9PSAic3RyaW5nIikgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFtfdHlwZW9mKGhvc3QpLCAiaG9zdCJdKSk7CgogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgLy8gaG9zdDogbXVzdCBiZSBmdWxsIHdzOi8vIHVyaQogICAgICAgIC8vIHBvcnQ6IGNsaWVudElkCiAgICAgICAgY2xpZW50SWQgPSBwb3J0OwogICAgICAgIHVyaSA9IGhvc3Q7CiAgICAgICAgdmFyIG1hdGNoID0gdXJpLm1hdGNoKC9eKHdzcz8pOlwvXC8oKFxbKC4rKVxdKXwoW15cL10rPykpKDooXGQrKSk/KFwvLiopJC8pOwoKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIGhvc3QgPSBtYXRjaFs0XSB8fCBtYXRjaFsyXTsKICAgICAgICAgIHBvcnQgPSBwYXJzZUludChtYXRjaFs3XSk7CiAgICAgICAgICBwYXRoID0gbWF0Y2hbOF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2hvc3QsICJob3N0Il0pKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICAgICAgY2xpZW50SWQgPSBwYXRoOwogICAgICAgICAgcGF0aCA9ICIvbXF0dCI7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHBvcnQgIT09ICJudW1iZXIiIHx8IHBvcnQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YocG9ydCksICJwb3J0Il0pKTsKICAgICAgICBpZiAodHlwZW9mIHBhdGggIT09ICJzdHJpbmciKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YocGF0aCksICJwYXRoIl0pKTsKICAgICAgICB2YXIgaXB2NkFkZFNCcmFja2V0ID0gaG9zdC5pbmRleE9mKCI6IikgIT09IC0xICYmIGhvc3Quc2xpY2UoMCwgMSkgIT09ICJbIiAmJiBob3N0LnNsaWNlKC0xKSAhPT0gIl0iOwogICAgICAgIHVyaSA9ICJ3czovLyIgKyAoaXB2NkFkZFNCcmFja2V0ID8gIlsiICsgaG9zdCArICJdIiA6IGhvc3QpICsgIjoiICsgcG9ydCArIHBhdGg7CiAgICAgIH0KCiAgICAgIHZhciBjbGllbnRJZExlbmd0aCA9IDA7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsaWVudElkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNoYXJDb2RlID0gY2xpZW50SWQuY2hhckNvZGVBdChpKTsKCiAgICAgICAgaWYgKDB4RDgwMCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweERCRkYpIHsKICAgICAgICAgIGkrKzsgLy8gU3Vycm9nYXRlIHBhaXIuCiAgICAgICAgfQoKICAgICAgICBjbGllbnRJZExlbmd0aCsrOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIGNsaWVudElkICE9PSAic3RyaW5nIiB8fCBjbGllbnRJZExlbmd0aCA+IDY1NTM1KSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjbGllbnRJZCwgImNsaWVudElkIl0pKTsKICAgICAgdmFyIGNsaWVudCA9IG5ldyBDbGllbnRJbXBsKHVyaSwgaG9zdCwgcG9ydCwgcGF0aCwgY2xpZW50SWQpOwoKICAgICAgdGhpcy5fZ2V0SG9zdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaG9zdDsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldEhvc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRF9PUEVSQVRJT04pKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldFBvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHBvcnQ7CiAgICAgIH07CgogICAgICB0aGlzLl9zZXRQb3J0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuVU5TVVBQT1JURURfT1BFUkFUSU9OKSk7CiAgICAgIH07CgogICAgICB0aGlzLl9nZXRQYXRoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBwYXRoOwogICAgICB9OwoKICAgICAgdGhpcy5fc2V0UGF0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLlVOU1VQUE9SVEVEX09QRVJBVElPTikpOwogICAgICB9OwoKICAgICAgdGhpcy5fZ2V0VVJJID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB1cmk7CiAgICAgIH07CgogICAgICB0aGlzLl9zZXRVUkkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRF9PUEVSQVRJT04pKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldENsaWVudElkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBjbGllbnQuY2xpZW50SWQ7CiAgICAgIH07CgogICAgICB0aGlzLl9zZXRDbGllbnRJZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLlVOU1VQUE9SVEVEX09QRVJBVElPTikpOwogICAgICB9OwoKICAgICAgdGhpcy5fZ2V0T25Db25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNsaWVudC5vbkNvbm5lY3RlZDsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldE9uQ29ubmVjdGVkID0gZnVuY3Rpb24gKG5ld09uQ29ubmVjdGVkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBuZXdPbkNvbm5lY3RlZCA9PT0gImZ1bmN0aW9uIikgY2xpZW50Lm9uQ29ubmVjdGVkID0gbmV3T25Db25uZWN0ZWQ7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YobmV3T25Db25uZWN0ZWQpLCAib25Db25uZWN0ZWQiXSkpOwogICAgICB9OwoKICAgICAgdGhpcy5fZ2V0RGlzY29ubmVjdGVkUHVibGlzaGluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gY2xpZW50LmRpc2Nvbm5lY3RlZFB1Ymxpc2hpbmc7CiAgICAgIH07CgogICAgICB0aGlzLl9zZXREaXNjb25uZWN0ZWRQdWJsaXNoaW5nID0gZnVuY3Rpb24gKG5ld0Rpc2Nvbm5lY3RlZFB1Ymxpc2hpbmcpIHsKICAgICAgICBjbGllbnQuZGlzY29ubmVjdGVkUHVibGlzaGluZyA9IG5ld0Rpc2Nvbm5lY3RlZFB1Ymxpc2hpbmc7CiAgICAgIH07CgogICAgICB0aGlzLl9nZXREaXNjb25uZWN0ZWRCdWZmZXJTaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBjbGllbnQuZGlzY29ubmVjdGVkQnVmZmVyU2l6ZTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldERpc2Nvbm5lY3RlZEJ1ZmZlclNpemUgPSBmdW5jdGlvbiAobmV3RGlzY29ubmVjdGVkQnVmZmVyU2l6ZSkgewogICAgICAgIGNsaWVudC5kaXNjb25uZWN0ZWRCdWZmZXJTaXplID0gbmV3RGlzY29ubmVjdGVkQnVmZmVyU2l6ZTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldE9uQ29ubmVjdGlvbkxvc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNsaWVudC5vbkNvbm5lY3Rpb25Mb3N0OwogICAgICB9OwoKICAgICAgdGhpcy5fc2V0T25Db25uZWN0aW9uTG9zdCA9IGZ1bmN0aW9uIChuZXdPbkNvbm5lY3Rpb25Mb3N0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBuZXdPbkNvbm5lY3Rpb25Mb3N0ID09PSAiZnVuY3Rpb24iKSBjbGllbnQub25Db25uZWN0aW9uTG9zdCA9IG5ld09uQ29ubmVjdGlvbkxvc3Q7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YobmV3T25Db25uZWN0aW9uTG9zdCksICJvbkNvbm5lY3Rpb25Mb3N0Il0pKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldE9uTWVzc2FnZURlbGl2ZXJlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gY2xpZW50Lm9uTWVzc2FnZURlbGl2ZXJlZDsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldE9uTWVzc2FnZURlbGl2ZXJlZCA9IGZ1bmN0aW9uIChuZXdPbk1lc3NhZ2VEZWxpdmVyZWQpIHsKICAgICAgICBpZiAodHlwZW9mIG5ld09uTWVzc2FnZURlbGl2ZXJlZCA9PT0gImZ1bmN0aW9uIikgY2xpZW50Lm9uTWVzc2FnZURlbGl2ZXJlZCA9IG5ld09uTWVzc2FnZURlbGl2ZXJlZDtlbHNlIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbX3R5cGVvZihuZXdPbk1lc3NhZ2VEZWxpdmVyZWQpLCAib25NZXNzYWdlRGVsaXZlcmVkIl0pKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldE9uTWVzc2FnZUFycml2ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNsaWVudC5vbk1lc3NhZ2VBcnJpdmVkOwogICAgICB9OwoKICAgICAgdGhpcy5fc2V0T25NZXNzYWdlQXJyaXZlZCA9IGZ1bmN0aW9uIChuZXdPbk1lc3NhZ2VBcnJpdmVkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBuZXdPbk1lc3NhZ2VBcnJpdmVkID09PSAiZnVuY3Rpb24iKSBjbGllbnQub25NZXNzYWdlQXJyaXZlZCA9IG5ld09uTWVzc2FnZUFycml2ZWQ7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YobmV3T25NZXNzYWdlQXJyaXZlZCksICJvbk1lc3NhZ2VBcnJpdmVkIl0pKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2dldFRyYWNlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBjbGllbnQudHJhY2VGdW5jdGlvbjsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldFRyYWNlID0gZnVuY3Rpb24gKHRyYWNlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0cmFjZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgY2xpZW50LnRyYWNlRnVuY3Rpb24gPSB0cmFjZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFtfdHlwZW9mKHRyYWNlKSwgIm9uVHJhY2UiXSkpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIENvbm5lY3QgdGhpcyBNZXNzYWdpbmcgY2xpZW50IHRvIGl0cyBzZXJ2ZXIuCiAgICAgICAqCiAgICAgICAqIEBuYW1lIFBhaG8uTVFUVC5DbGllbnQjY29ubmVjdAogICAgICAgKiBAZnVuY3Rpb24KICAgICAgICogQHBhcmFtIHtvYmplY3R9IGNvbm5lY3RPcHRpb25zIC0gQXR0cmlidXRlcyB1c2VkIHdpdGggdGhlIGNvbm5lY3Rpb24uCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb25uZWN0T3B0aW9ucy50aW1lb3V0IC0gSWYgdGhlIGNvbm5lY3QgaGFzIG5vdCBzdWNjZWVkZWQgd2l0aGluIHRoaXMKICAgICAgICogICAgICAgICAgICAgICAgICAgIG51bWJlciBvZiBzZWNvbmRzLCBpdCBpcyBkZWVtZWQgdG8gaGF2ZSBmYWlsZWQuCiAgICAgICAqICAgICAgICAgICAgICAgICAgICBUaGUgZGVmYXVsdCBpcyAzMCBzZWNvbmRzLgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29ubmVjdE9wdGlvbnMudXNlck5hbWUgLSBBdXRoZW50aWNhdGlvbiB1c2VybmFtZSBmb3IgdGhpcyBjb25uZWN0aW9uLgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29ubmVjdE9wdGlvbnMucGFzc3dvcmQgLSBBdXRoZW50aWNhdGlvbiBwYXNzd29yZCBmb3IgdGhpcyBjb25uZWN0aW9uLgogICAgICAgKiBAcGFyYW0ge1BhaG8uTVFUVC5NZXNzYWdlfSBjb25uZWN0T3B0aW9ucy53aWxsTWVzc2FnZSAtIHNlbnQgYnkgdGhlIHNlcnZlciB3aGVuIHRoZSBjbGllbnQKICAgICAgICogICAgICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3RzIGFibm9ybWFsbHkuCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb25uZWN0T3B0aW9ucy5rZWVwQWxpdmVJbnRlcnZhbCAtIHRoZSBzZXJ2ZXIgZGlzY29ubmVjdHMgdGhpcyBjbGllbnQgaWYKICAgICAgICogICAgICAgICAgICAgICAgICAgIHRoZXJlIGlzIG5vIGFjdGl2aXR5IGZvciB0aGlzIG51bWJlciBvZiBzZWNvbmRzLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgdmFsdWUgb2YgNjAgc2Vjb25kcyBpcyBhc3N1bWVkIGlmIG5vdCBzZXQuCiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gY29ubmVjdE9wdGlvbnMuY2xlYW5TZXNzaW9uIC0gaWYgdHJ1ZShkZWZhdWx0KSB0aGUgY2xpZW50IGFuZCBzZXJ2ZXIKICAgICAgICogICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlbnQgc3RhdGUgaXMgZGVsZXRlZCBvbiBzdWNjZXNzZnVsIGNvbm5lY3QuCiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gY29ubmVjdE9wdGlvbnMudXNlU1NMIC0gaWYgcHJlc2VudCBhbmQgdHJ1ZSwgdXNlIGFuIFNTTCBXZWJzb2NrZXQgY29ubmVjdGlvbi4KICAgICAgICogQHBhcmFtIHtvYmplY3R9IGNvbm5lY3RPcHRpb25zLmludm9jYXRpb25Db250ZXh0IC0gcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MgY2FsbGJhY2sgb3Igb25GYWlsdXJlIGNhbGxiYWNrLgogICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjb25uZWN0T3B0aW9ucy5vblN1Y2Nlc3MgLSBjYWxsZWQgd2hlbiB0aGUgY29ubmVjdCBhY2tub3dsZWRnZW1lbnQKICAgICAgICogICAgICAgICAgICAgICAgICAgIGhhcyBiZWVuIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlci4KICAgICAgICogQSBzaW5nbGUgcmVzcG9uc2Ugb2JqZWN0IHBhcmFtZXRlciBpcyBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcyBjYWxsYmFjayBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgZmllbGRzOgogICAgICAgKiA8b2w+CiAgICAgICAqIDxsaT5pbnZvY2F0aW9uQ29udGV4dCBhcyBwYXNzZWQgaW4gdG8gdGhlIG9uU3VjY2VzcyBtZXRob2QgaW4gdGhlIGNvbm5lY3RPcHRpb25zLgogICAgICAgKiA8L29sPgogICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNvbm5lY3RPcHRpb25zLm9uRmFpbHVyZSAtIGNhbGxlZCB3aGVuIHRoZSBjb25uZWN0IHJlcXVlc3QgaGFzIGZhaWxlZCBvciB0aW1lZCBvdXQuCiAgICAgICAqIEEgc2luZ2xlIHJlc3BvbnNlIG9iamVjdCBwYXJhbWV0ZXIgaXMgcGFzc2VkIHRvIHRoZSBvbkZhaWx1cmUgY2FsbGJhY2sgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIGZpZWxkczoKICAgICAgICogPG9sPgogICAgICAgKiA8bGk+aW52b2NhdGlvbkNvbnRleHQgYXMgcGFzc2VkIGluIHRvIHRoZSBvbkZhaWx1cmUgbWV0aG9kIGluIHRoZSBjb25uZWN0T3B0aW9ucy4KICAgICAgICogPGxpPmVycm9yQ29kZSBhIG51bWJlciBpbmRpY2F0aW5nIHRoZSBuYXR1cmUgb2YgdGhlIGVycm9yLgogICAgICAgKiA8bGk+ZXJyb3JNZXNzYWdlIHRleHQgZGVzY3JpYmluZyB0aGUgZXJyb3IuCiAgICAgICAqIDwvb2w+CiAgICAgICAgICogQHBhcmFtIHthcnJheX0gY29ubmVjdE9wdGlvbnMuaG9zdHMgLSBJZiBwcmVzZW50IHRoaXMgY29udGFpbnMgZWl0aGVyIGEgc2V0IG9mIGhvc3RuYW1lcyBvciBmdWxseSBxdWFsaWZpZWQKICAgICAgICogV2ViU29ja2V0IFVSSXMgKHdzOi8vaW90LmVjbGlwc2Uub3JnOjgwL3dzKSwgdGhhdCBhcmUgdHJpZWQgaW4gb3JkZXIgaW4gcGxhY2UKICAgICAgICogb2YgdGhlIGhvc3QgYW5kIHBvcnQgcGFyYW1hdGVyIG9uIHRoZSBjb25zdHJ1dG9yLiBUaGUgaG9zdHMgYXJlIHRyaWVkIG9uZSBhdCBhdCB0aW1lIGluIG9yZGVyIHVudGlsCiAgICAgICAqIG9uZSBvZiB0aGVuIHN1Y2NlZWRzLgogICAgICAgICAqIEBwYXJhbSB7YXJyYXl9IGNvbm5lY3RPcHRpb25zLnBvcnRzIC0gSWYgcHJlc2VudCB0aGUgc2V0IG9mIHBvcnRzIG1hdGNoaW5nIHRoZSBob3N0cy4gSWYgaG9zdHMgY29udGFpbnMgVVJJcywgdGhpcyBwcm9wZXJ0eQogICAgICAgKiBpcyBub3QgdXNlZC4KICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNvbm5lY3RPcHRpb25zLnJlY29ubmVjdCAtIFNldHMgd2hldGhlciB0aGUgY2xpZW50IHdpbGwgYXV0b21hdGljYWxseSBhdHRlbXB0IHRvIHJlY29ubmVjdAogICAgICAgICAqIHRvIHRoZSBzZXJ2ZXIgaWYgdGhlIGNvbm5lY3Rpb24gaXMgbG9zdC4KICAgICAgICAgKjx1bD4KICAgICAgICAgKjxsaT5JZiBzZXQgdG8gZmFsc2UsIHRoZSBjbGllbnQgd2lsbCBub3QgYXR0ZW1wdCB0byBhdXRvbWF0aWNhbGx5IHJlY29ubmVjdCB0byB0aGUgc2VydmVyIGluIHRoZSBldmVudCB0aGF0IHRoZQogICAgICAgICAqIGNvbm5lY3Rpb24gaXMgbG9zdC48L2xpPgogICAgICAgICAqPGxpPklmIHNldCB0byB0cnVlLCBpbiB0aGUgZXZlbnQgdGhhdCB0aGUgY29ubmVjdGlvbiBpcyBsb3N0LCB0aGUgY2xpZW50IHdpbGwgYXR0ZW1wdCB0byByZWNvbm5lY3QgdG8gdGhlIHNlcnZlci4KICAgICAgICAgKiBJdCB3aWxsIGluaXRpYWxseSB3YWl0IDEgc2Vjb25kIGJlZm9yZSBpdCBhdHRlbXB0cyB0byByZWNvbm5lY3QsIGZvciBldmVyeSBmYWlsZWQgcmVjb25uZWN0IGF0dGVtcHQsIHRoZSBkZWxheQogICAgICAgICAqIHdpbGwgZG91YmxlIHVudGlsIGl0IGlzIGF0IDIgbWludXRlcyBhdCB3aGljaCBwb2ludCB0aGUgZGVsYXkgd2lsbCBzdGF5IGF0IDIgbWludXRlcy48L2xpPgogICAgICAgICAqPC91bD4KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gY29ubmVjdE9wdGlvbnMubXF0dFZlcnNpb24gLSBUaGUgdmVyc2lvbiBvZiBNUVRUIHRvIHVzZSB0byBjb25uZWN0IHRvIHRoZSBNUVRUIEJyb2tlci4KICAgICAgICAgKjx1bD4KICAgICAgICAgKjxsaT4zIC0gTVFUVCBWMy4xPC9saT4KICAgICAgICAgKjxsaT40IC0gTVFUVCBWMy4xLjE8L2xpPgogICAgICAgICAqPC91bD4KICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNvbm5lY3RPcHRpb25zLm1xdHRWZXJzaW9uRXhwbGljaXQgLSBJZiBzZXQgdG8gdHJ1ZSwgd2lsbCBmb3JjZSB0aGUgY29ubmVjdGlvbiB0byB1c2UgdGhlCiAgICAgICAgICogc2VsZWN0ZWQgTVFUVCBWZXJzaW9uIG9yIHdpbGwgZmFpbCB0byBjb25uZWN0LgogICAgICAgICAqIEBwYXJhbSB7YXJyYXl9IGNvbm5lY3RPcHRpb25zLnVyaXMgLSBJZiBwcmVzZW50LCBzaG91bGQgY29udGFpbiBhIGxpc3Qgb2YgZnVsbHkgcXVhbGlmaWVkIFdlYlNvY2tldCB1cmlzCiAgICAgICAgICogKGUuZy4gd3M6Ly9pb3QuZWNsaXBzZS5vcmc6ODAvd3MpLCB0aGF0IGFyZSB0cmllZCBpbiBvcmRlciBpbiBwbGFjZSBvZiB0aGUgaG9zdCBhbmQgcG9ydCBwYXJhbWV0ZXIgb2YgdGhlIGNvbnN0cnV0b3IuCiAgICAgICAgICogVGhlIHVyaXMgYXJlIHRyaWVkIG9uZSBhdCBhIHRpbWUgaW4gb3JkZXIgdW50aWwgb25lIG9mIHRoZW0gc3VjY2VlZHMuIERvIG5vdCB1c2UgdGhpcyBpbiBjb25qdW5jdGlvbiB3aXRoIGhvc3RzIGFzCiAgICAgICAgICogdGhlIGhvc3RzIGFycmF5IHdpbGwgYmUgY29udmVydGVkIHRvIHVyaXMgYW5kIHdpbGwgb3ZlcndyaXRlIHRoaXMgcHJvcGVydHkuCiAgICAgICAqIEB0aHJvd3Mge0ludmFsaWRTdGF0ZX0gSWYgdGhlIGNsaWVudCBpcyBub3QgaW4gZGlzY29ubmVjdGVkIHN0YXRlLiBUaGUgY2xpZW50IG11c3QgaGF2ZSByZWNlaXZlZCBjb25uZWN0aW9uTG9zdAogICAgICAgKiBvciBkaXNjb25uZWN0ZWQgYmVmb3JlIGNhbGxpbmcgY29ubmVjdCBmb3IgYSBzZWNvbmQgb3Igc3Vic2VxdWVudCB0aW1lLgogICAgICAgKi8KCgogICAgICB0aGlzLmNvbm5lY3QgPSBmdW5jdGlvbiAoY29ubmVjdE9wdGlvbnMpIHsKICAgICAgICBjb25uZWN0T3B0aW9ucyA9IGNvbm5lY3RPcHRpb25zIHx8IHt9OwogICAgICAgIHZhbGlkYXRlKGNvbm5lY3RPcHRpb25zLCB7CiAgICAgICAgICB0aW1lb3V0OiAibnVtYmVyIiwKICAgICAgICAgIHVzZXJOYW1lOiAic3RyaW5nIiwKICAgICAgICAgIHBhc3N3b3JkOiAic3RyaW5nIiwKICAgICAgICAgIHdpbGxNZXNzYWdlOiAib2JqZWN0IiwKICAgICAgICAgIGtlZXBBbGl2ZUludGVydmFsOiAibnVtYmVyIiwKICAgICAgICAgIGNsZWFuU2Vzc2lvbjogImJvb2xlYW4iLAogICAgICAgICAgdXNlU1NMOiAiYm9vbGVhbiIsCiAgICAgICAgICBpbnZvY2F0aW9uQ29udGV4dDogIm9iamVjdCIsCiAgICAgICAgICBvblN1Y2Nlc3M6ICJmdW5jdGlvbiIsCiAgICAgICAgICBvbkZhaWx1cmU6ICJmdW5jdGlvbiIsCiAgICAgICAgICBob3N0czogIm9iamVjdCIsCiAgICAgICAgICBwb3J0czogIm9iamVjdCIsCiAgICAgICAgICByZWNvbm5lY3Q6ICJib29sZWFuIiwKICAgICAgICAgIG1xdHRWZXJzaW9uOiAibnVtYmVyIiwKICAgICAgICAgIG1xdHRWZXJzaW9uRXhwbGljaXQ6ICJib29sZWFuIiwKICAgICAgICAgIHVyaXM6ICJvYmplY3QiCiAgICAgICAgfSk7IC8vIElmIG5vIGtlZXAgYWxpdmUgaW50ZXJ2YWwgaXMgc2V0LCBhc3N1bWUgNjAgc2Vjb25kcy4KCiAgICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLmtlZXBBbGl2ZUludGVydmFsID09PSB1bmRlZmluZWQpIGNvbm5lY3RPcHRpb25zLmtlZXBBbGl2ZUludGVydmFsID0gNjA7CgogICAgICAgIGlmIChjb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiA+IDQgfHwgY29ubmVjdE9wdGlvbnMubXF0dFZlcnNpb24gPCAzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiwgImNvbm5lY3RPcHRpb25zLm1xdHRWZXJzaW9uIl0pKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbkV4cGxpY2l0ID0gZmFsc2U7CiAgICAgICAgICBjb25uZWN0T3B0aW9ucy5tcXR0VmVyc2lvbiA9IDQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbm5lY3RPcHRpb25zLm1xdHRWZXJzaW9uRXhwbGljaXQgPSB0cnVlOwogICAgICAgIH0gLy9DaGVjayB0aGF0IGlmIHBhc3N3b3JkIGlzIHNldCwgc28gaXMgdXNlcm5hbWUKCgogICAgICAgIGlmIChjb25uZWN0T3B0aW9ucy5wYXNzd29yZCAhPT0gdW5kZWZpbmVkICYmIGNvbm5lY3RPcHRpb25zLnVzZXJOYW1lID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLnBhc3N3b3JkLCAiY29ubmVjdE9wdGlvbnMucGFzc3dvcmQiXSkpOwoKICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2UpIHsKICAgICAgICAgIGlmICghKGNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlIGluc3RhbmNlb2YgTWVzc2FnZSkpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2UsICJjb25uZWN0T3B0aW9ucy53aWxsTWVzc2FnZSJdKSk7IC8vIFRoZSB3aWxsIG1lc3NhZ2UgbXVzdCBoYXZlIGEgcGF5bG9hZCB0aGF0IGNhbiBiZSByZXByZXNlbnRlZCBhcyBhIHN0cmluZy4KICAgICAgICAgIC8vIENhdXNlIHRoZSB3aWxsTWVzc2FnZSB0byB0aHJvdyBhbiBleGNlcHRpb24gaWYgdGhpcyBpcyBub3QgdGhlIGNhc2UuCgogICAgICAgICAgY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2Uuc3RyaW5nUGF5bG9hZCA9IG51bGw7CiAgICAgICAgICBpZiAodHlwZW9mIGNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbX3R5cGVvZihjb25uZWN0T3B0aW9ucy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUpLCAiY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2UuZGVzdGluYXRpb25OYW1lIl0pKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29ubmVjdE9wdGlvbnMuY2xlYW5TZXNzaW9uID09PSAidW5kZWZpbmVkIikgY29ubmVjdE9wdGlvbnMuY2xlYW5TZXNzaW9uID0gdHJ1ZTsKCiAgICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLmhvc3RzKSB7CiAgICAgICAgICBpZiAoIShjb25uZWN0T3B0aW9ucy5ob3N0cyBpbnN0YW5jZW9mIEFycmF5KSkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbY29ubmVjdE9wdGlvbnMuaG9zdHMsICJjb25uZWN0T3B0aW9ucy5ob3N0cyJdKSk7CiAgICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMuaG9zdHMubGVuZ3RoIDwgMSkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbY29ubmVjdE9wdGlvbnMuaG9zdHMsICJjb25uZWN0T3B0aW9ucy5ob3N0cyJdKSk7CiAgICAgICAgICB2YXIgdXNpbmdVUklzID0gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb25uZWN0T3B0aW9ucy5ob3N0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodHlwZW9mIGNvbm5lY3RPcHRpb25zLmhvc3RzW2ldICE9PSAic3RyaW5nIikgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFtfdHlwZW9mKGNvbm5lY3RPcHRpb25zLmhvc3RzW2ldKSwgImNvbm5lY3RPcHRpb25zLmhvc3RzWyIgKyBpICsgIl0iXSkpOwoKICAgICAgICAgICAgaWYgKC9eKHdzcz8pOlwvXC8oKFxbKC4rKVxdKXwoW15cL10rPykpKDooXGQrKSk/KFwvLiopJC8udGVzdChjb25uZWN0T3B0aW9ucy5ob3N0c1tpXSkpIHsKICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgICAgICAgdXNpbmdVUklzID0gdHJ1ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1c2luZ1VSSXMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLmhvc3RzW2ldLCAiY29ubmVjdE9wdGlvbnMuaG9zdHNbIiArIGkgKyAiXSJdKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHVzaW5nVVJJcykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLmhvc3RzW2ldLCAiY29ubmVjdE9wdGlvbnMuaG9zdHNbIiArIGkgKyAiXSJdKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXVzaW5nVVJJcykgewogICAgICAgICAgICBpZiAoIWNvbm5lY3RPcHRpb25zLnBvcnRzKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjb25uZWN0T3B0aW9ucy5wb3J0cywgImNvbm5lY3RPcHRpb25zLnBvcnRzIl0pKTsKICAgICAgICAgICAgaWYgKCEoY29ubmVjdE9wdGlvbnMucG9ydHMgaW5zdGFuY2VvZiBBcnJheSkpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLnBvcnRzLCAiY29ubmVjdE9wdGlvbnMucG9ydHMiXSkpOwogICAgICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMuaG9zdHMubGVuZ3RoICE9PSBjb25uZWN0T3B0aW9ucy5wb3J0cy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLnBvcnRzLCAiY29ubmVjdE9wdGlvbnMucG9ydHMiXSkpOwogICAgICAgICAgICBjb25uZWN0T3B0aW9ucy51cmlzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbm5lY3RPcHRpb25zLmhvc3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25uZWN0T3B0aW9ucy5wb3J0c1tpXSAhPT0gIm51bWJlciIgfHwgY29ubmVjdE9wdGlvbnMucG9ydHNbaV0gPCAwKSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW190eXBlb2YoY29ubmVjdE9wdGlvbnMucG9ydHNbaV0pLCAiY29ubmVjdE9wdGlvbnMucG9ydHNbIiArIGkgKyAiXSJdKSk7CiAgICAgICAgICAgICAgdmFyIGhvc3QgPSBjb25uZWN0T3B0aW9ucy5ob3N0c1tpXTsKICAgICAgICAgICAgICB2YXIgcG9ydCA9IGNvbm5lY3RPcHRpb25zLnBvcnRzW2ldOwogICAgICAgICAgICAgIHZhciBpcHY2ID0gaG9zdC5pbmRleE9mKCI6IikgIT09IC0xOwogICAgICAgICAgICAgIHVyaSA9ICJ3czovLyIgKyAoaXB2NiA/ICJbIiArIGhvc3QgKyAiXSIgOiBob3N0KSArICI6IiArIHBvcnQgKyBwYXRoOwogICAgICAgICAgICAgIGNvbm5lY3RPcHRpb25zLnVyaXMucHVzaCh1cmkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25uZWN0T3B0aW9ucy51cmlzID0gY29ubmVjdE9wdGlvbnMuaG9zdHM7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjbGllbnQuY29ubmVjdChjb25uZWN0T3B0aW9ucyk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBTdWJzY3JpYmUgZm9yIG1lc3NhZ2VzLCByZXF1ZXN0IHJlY2VpcHQgb2YgYSBjb3B5IG9mIG1lc3NhZ2VzIHNlbnQgdG8gdGhlIGRlc3RpbmF0aW9ucyBkZXNjcmliZWQgYnkgdGhlIGZpbHRlci4KICAgICAgICoKICAgICAgICogQG5hbWUgUGFoby5NUVRULkNsaWVudCNzdWJzY3JpYmUKICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmaWx0ZXIgZGVzY3JpYmluZyB0aGUgZGVzdGluYXRpb25zIHRvIHJlY2VpdmUgbWVzc2FnZXMgZnJvbS4KICAgICAgICogPGJyPgogICAgICAgKiBAcGFyYW0ge29iamVjdH0gc3Vic2NyaWJlT3B0aW9ucyAtIHVzZWQgdG8gY29udHJvbCB0aGUgc3Vic2NyaXB0aW9uCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJzY3JpYmVPcHRpb25zLnFvcyAtIHRoZSBtYWl4aW11bSBxb3Mgb2YgYW55IHB1YmxpY2F0aW9ucyBzZW50CiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIGEgcmVzdWx0IG9mIG1ha2luZyB0aGlzIHN1YnNjcmlwdGlvbi4KICAgICAgICogQHBhcmFtIHtvYmplY3R9IHN1YnNjcmliZU9wdGlvbnMuaW52b2NhdGlvbkNvbnRleHQgLSBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcyBjYWxsYmFjawogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBvbkZhaWx1cmUgY2FsbGJhY2suCiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzIC0gY2FsbGVkIHdoZW4gdGhlIHN1YnNjcmliZSBhY2tub3dsZWRnZW1lbnQKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzIGJlZW4gcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25TdWNjZXNzIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6CiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvbD4KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPmludm9jYXRpb25Db250ZXh0IGlmIHNldCBpbiB0aGUgc3Vic2NyaWJlT3B0aW9ucy4KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9vbD4KICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUgLSBjYWxsZWQgd2hlbiB0aGUgc3Vic2NyaWJlIHJlcXVlc3QgaGFzIGZhaWxlZCBvciB0aW1lZCBvdXQuCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgc2luZ2xlIHJlc3BvbnNlIG9iamVjdCBwYXJhbWV0ZXIgaXMgcGFzc2VkIHRvIHRoZSBvbkZhaWx1cmUgY2FsbGJhY2sgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIGZpZWxkczoKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9sPgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+aW52b2NhdGlvbkNvbnRleHQgLSBpZiBzZXQgaW4gdGhlIHN1YnNjcmliZU9wdGlvbnMuCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5lcnJvckNvZGUgLSBhIG51bWJlciBpbmRpY2F0aW5nIHRoZSBuYXR1cmUgb2YgdGhlIGVycm9yLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+ZXJyb3JNZXNzYWdlIC0gdGV4dCBkZXNjcmliaW5nIHRoZSBlcnJvci4KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9vbD4KICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHN1YnNjcmliZU9wdGlvbnMudGltZW91dCAtIHdoaWNoLCBpZiBwcmVzZW50LCBkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2YKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcyBhZnRlciB3aGljaCB0aGUgb25GYWlsdXJlIGNhbGJhY2sgaXMgY2FsbGVkLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgcHJlc2VuY2Ugb2YgYSB0aW1lb3V0IGRvZXMgbm90IHByZXZlbnQgdGhlIG9uU3VjY2VzcwogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayBmcm9tIGJlaW5nIGNhbGxlZCB3aGVuIHRoZSBzdWJzY3JpYmUgY29tcGxldGVzLgogICAgICAgKiBAdGhyb3dzIHtJbnZhbGlkU3RhdGV9IGlmIHRoZSBjbGllbnQgaXMgbm90IGluIGNvbm5lY3RlZCBzdGF0ZS4KICAgICAgICovCgoKICAgICAgdGhpcy5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZmlsdGVyLCBzdWJzY3JpYmVPcHRpb25zKSB7CiAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgIT09ICJzdHJpbmciKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQ6IiArIGZpbHRlcik7CiAgICAgICAgc3Vic2NyaWJlT3B0aW9ucyA9IHN1YnNjcmliZU9wdGlvbnMgfHwge307CiAgICAgICAgdmFsaWRhdGUoc3Vic2NyaWJlT3B0aW9ucywgewogICAgICAgICAgcW9zOiAibnVtYmVyIiwKICAgICAgICAgIGludm9jYXRpb25Db250ZXh0OiAib2JqZWN0IiwKICAgICAgICAgIG9uU3VjY2VzczogImZ1bmN0aW9uIiwKICAgICAgICAgIG9uRmFpbHVyZTogImZ1bmN0aW9uIiwKICAgICAgICAgIHRpbWVvdXQ6ICJudW1iZXIiCiAgICAgICAgfSk7CiAgICAgICAgaWYgKHN1YnNjcmliZU9wdGlvbnMudGltZW91dCAmJiAhc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUpIHRocm93IG5ldyBFcnJvcigic3Vic2NyaWJlT3B0aW9ucy50aW1lb3V0IHNwZWNpZmllZCB3aXRoIG5vIG9uRmFpbHVyZSBjYWxsYmFjay4iKTsKICAgICAgICBpZiAodHlwZW9mIHN1YnNjcmliZU9wdGlvbnMucW9zICE9PSAidW5kZWZpbmVkIiAmJiAhKHN1YnNjcmliZU9wdGlvbnMucW9zID09PSAwIHx8IHN1YnNjcmliZU9wdGlvbnMucW9zID09PSAxIHx8IHN1YnNjcmliZU9wdGlvbnMucW9zID09PSAyKSkgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbc3Vic2NyaWJlT3B0aW9ucy5xb3MsICJzdWJzY3JpYmVPcHRpb25zLnFvcyJdKSk7CiAgICAgICAgY2xpZW50LnN1YnNjcmliZShmaWx0ZXIsIHN1YnNjcmliZU9wdGlvbnMpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogVW5zdWJzY3JpYmUgZm9yIG1lc3NhZ2VzLCBzdG9wIHJlY2VpdmluZyBtZXNzYWdlcyBzZW50IHRvIGRlc3RpbmF0aW9ucyBkZXNjcmliZWQgYnkgdGhlIGZpbHRlci4KICAgICAgICoKICAgICAgICogQG5hbWUgUGFoby5NUVRULkNsaWVudCN1bnN1YnNjcmliZQogICAgICAgKiBAZnVuY3Rpb24KICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlciAtIGRlc2NyaWJpbmcgdGhlIGRlc3RpbmF0aW9ucyB0byByZWNlaXZlIG1lc3NhZ2VzIGZyb20uCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB1bnN1YnNjcmliZU9wdGlvbnMgLSB1c2VkIHRvIGNvbnRyb2wgdGhlIHN1YnNjcmlwdGlvbgogICAgICAgKiBAcGFyYW0ge29iamVjdH0gdW5zdWJzY3JpYmVPcHRpb25zLmludm9jYXRpb25Db250ZXh0IC0gcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MgY2FsbGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBvbkZhaWx1cmUgY2FsbGJhY2suCiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHVuc3Vic2NyaWJlT3B0aW9ucy5vblN1Y2Nlc3MgLSBjYWxsZWQgd2hlbiB0aGUgdW5zdWJzY3JpYmUgYWNrbm93bGVkZ2VtZW50IGhhcyBiZWVuIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlci4KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3MgY2FsbGJhY2sgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIGZpZWxkczoKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b2w+CiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPmludm9jYXRpb25Db250ZXh0IC0gaWYgc2V0IGluIHRoZSB1bnN1YnNjcmliZU9wdGlvbnMuCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9vbD4KICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gdW5zdWJzY3JpYmVPcHRpb25zLm9uRmFpbHVyZSBjYWxsZWQgd2hlbiB0aGUgdW5zdWJzY3JpYmUgcmVxdWVzdCBoYXMgZmFpbGVkIG9yIHRpbWVkIG91dC4KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25GYWlsdXJlIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6CiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9sPgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5pbnZvY2F0aW9uQ29udGV4dCAtIGlmIHNldCBpbiB0aGUgdW5zdWJzY3JpYmVPcHRpb25zLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5lcnJvckNvZGUgLSBhIG51bWJlciBpbmRpY2F0aW5nIHRoZSBuYXR1cmUgb2YgdGhlIGVycm9yLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5lcnJvck1lc3NhZ2UgLSB0ZXh0IGRlc2NyaWJpbmcgdGhlIGVycm9yLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvb2w+CiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB1bnN1YnNjcmliZU9wdGlvbnMudGltZW91dCAtIHdoaWNoLCBpZiBwcmVzZW50LCBkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2Ygc2Vjb25kcwogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyIHdoaWNoIHRoZSBvbkZhaWx1cmUgY2FsbGJhY2sgaXMgY2FsbGVkLiBUaGUgcHJlc2VuY2Ugb2YKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHRpbWVvdXQgZG9lcyBub3QgcHJldmVudCB0aGUgb25TdWNjZXNzIGNhbGxiYWNrIGZyb20gYmVpbmcKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsZWQgd2hlbiB0aGUgdW5zdWJzY3JpYmUgY29tcGxldGVzCiAgICAgICAqIEB0aHJvd3Mge0ludmFsaWRTdGF0ZX0gaWYgdGhlIGNsaWVudCBpcyBub3QgaW4gY29ubmVjdGVkIHN0YXRlLgogICAgICAgKi8KCgogICAgICB0aGlzLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGZpbHRlciwgdW5zdWJzY3JpYmVPcHRpb25zKSB7CiAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgIT09ICJzdHJpbmciKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQ6IiArIGZpbHRlcik7CiAgICAgICAgdW5zdWJzY3JpYmVPcHRpb25zID0gdW5zdWJzY3JpYmVPcHRpb25zIHx8IHt9OwogICAgICAgIHZhbGlkYXRlKHVuc3Vic2NyaWJlT3B0aW9ucywgewogICAgICAgICAgaW52b2NhdGlvbkNvbnRleHQ6ICJvYmplY3QiLAogICAgICAgICAgb25TdWNjZXNzOiAiZnVuY3Rpb24iLAogICAgICAgICAgb25GYWlsdXJlOiAiZnVuY3Rpb24iLAogICAgICAgICAgdGltZW91dDogIm51bWJlciIKICAgICAgICB9KTsKICAgICAgICBpZiAodW5zdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQgJiYgIXVuc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUpIHRocm93IG5ldyBFcnJvcigidW5zdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQgc3BlY2lmaWVkIHdpdGggbm8gb25GYWlsdXJlIGNhbGxiYWNrLiIpOwogICAgICAgIGNsaWVudC51bnN1YnNjcmliZShmaWx0ZXIsIHVuc3Vic2NyaWJlT3B0aW9ucyk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgY29uc3VtZXJzIG9mIHRoZSBkZXN0aW5hdGlvbiBpbiB0aGUgTWVzc2FnZS4KICAgICAgICoKICAgICAgICogQG5hbWUgUGFoby5NUVRULkNsaWVudCNzZW5kCiAgICAgICAqIEBmdW5jdGlvbgogICAgICAgKiBAcGFyYW0ge3N0cmluZ3xQYWhvLk1RVFQuTWVzc2FnZX0gdG9waWMgLSA8Yj5tYW5kYXRvcnk8L2I+IFRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiB0byB3aGljaCB0aGUgbWVzc2FnZSBpcyB0byBiZSBzZW50LgogICAgICAgKiAJCQkJCSAgIC0gSWYgaXQgaXMgdGhlIG9ubHkgcGFyYW1ldGVyLCB1c2VkIGFzIFBhaG8uTVFUVC5NZXNzYWdlIG9iamVjdC4KICAgICAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXlCdWZmZXJ9IHBheWxvYWQgLSBUaGUgbWVzc2FnZSBkYXRhIHRvIGJlIHNlbnQuCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBxb3MgVGhlIFF1YWxpdHkgb2YgU2VydmljZSB1c2VkIHRvIGRlbGl2ZXIgdGhlIG1lc3NhZ2UuCiAgICAgICAqIAkJPGRsPgogICAgICAgKiAJCQk8ZHQ+MCBCZXN0IGVmZm9ydCAoZGVmYXVsdCkuCiAgICAgICAqICAgICAJCQk8ZHQ+MSBBdCBsZWFzdCBvbmNlLgogICAgICAgKiAgICAgCQkJPGR0PjIgRXhhY3RseSBvbmNlLgogICAgICAgKiAJCTwvZGw+CiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmV0YWluZWQgSWYgdHJ1ZSwgdGhlIG1lc3NhZ2UgaXMgdG8gYmUgcmV0YWluZWQgYnkgdGhlIHNlcnZlciBhbmQgZGVsaXZlcmVkCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgdG8gYm90aCBjdXJyZW50IGFuZCBmdXR1cmUgc3Vic2NyaXB0aW9ucy4KICAgICAgICogICAgICAgICAgICAgICAgICAgICBJZiBmYWxzZSB0aGUgc2VydmVyIG9ubHkgZGVsaXZlcnMgdGhlIG1lc3NhZ2UgdG8gY3VycmVudCBzdWJzY3JpYmVycywgdGhpcyBpcyB0aGUgZGVmYXVsdCBmb3IgbmV3IE1lc3NhZ2VzLgogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIEEgcmVjZWl2ZWQgbWVzc2FnZSBoYXMgdGhlIHJldGFpbmVkIGJvb2xlYW4gc2V0IHRvIHRydWUgaWYgdGhlIG1lc3NhZ2Ugd2FzIHB1Ymxpc2hlZAogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdpdGggdGhlIHJldGFpbmVkIGJvb2xlYW4gc2V0IHRvIHRydWUKICAgICAgICogICAgICAgICAgICAgICAgICAgICBhbmQgdGhlIHN1YnNjcnB0aW9uIHdhcyBtYWRlIGFmdGVyIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHB1Ymxpc2hlZC4KICAgICAgICogQHRocm93cyB7SW52YWxpZFN0YXRlfSBpZiB0aGUgY2xpZW50IGlzIG5vdCBjb25uZWN0ZWQuCiAgICAgICAqLwoKCiAgICAgIHRoaXMuc2VuZCA9IGZ1bmN0aW9uICh0b3BpYywgcGF5bG9hZCwgcW9zLCByZXRhaW5lZCkgewogICAgICAgIHZhciBtZXNzYWdlOwoKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGFyZ3VtZW50LiIgKyAibGVuZ3RoIik7CiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgICAgIGlmICghKHRvcGljIGluc3RhbmNlb2YgTWVzc2FnZSkgJiYgdHlwZW9mIHRvcGljICE9PSAic3RyaW5nIikgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGFyZ3VtZW50OiIgKyBfdHlwZW9mKHRvcGljKSk7CiAgICAgICAgICBtZXNzYWdlID0gdG9waWM7CiAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UuZGVzdGluYXRpb25OYW1lID09PSAidW5kZWZpbmVkIikgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbbWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUsICJNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSJdKSk7CiAgICAgICAgICBjbGllbnQuc2VuZChtZXNzYWdlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy9wYXJhbWV0ZXIgY2hlY2tpbmcgaW4gTWVzc2FnZSBvYmplY3QKICAgICAgICAgIG1lc3NhZ2UgPSBuZXcgTWVzc2FnZShwYXlsb2FkKTsKICAgICAgICAgIG1lc3NhZ2UuZGVzdGluYXRpb25OYW1lID0gdG9waWM7CiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAzKSBtZXNzYWdlLnFvcyA9IHFvczsKICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDQpIG1lc3NhZ2UucmV0YWluZWQgPSByZXRhaW5lZDsKICAgICAgICAgIGNsaWVudC5zZW5kKG1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIFB1Ymxpc2ggYSBtZXNzYWdlIHRvIHRoZSBjb25zdW1lcnMgb2YgdGhlIGRlc3RpbmF0aW9uIGluIHRoZSBNZXNzYWdlLgogICAgICAgKiBTeW5vbnltIGZvciBQYWhvLk1xdHQuQ2xpZW50I3NlbmQKICAgICAgICoKICAgICAgICogQG5hbWUgUGFoby5NUVRULkNsaWVudCNwdWJsaXNoCiAgICAgICAqIEBmdW5jdGlvbgogICAgICAgKiBAcGFyYW0ge3N0cmluZ3xQYWhvLk1RVFQuTWVzc2FnZX0gdG9waWMgLSA8Yj5tYW5kYXRvcnk8L2I+IFRoZSBuYW1lIG9mIHRoZSB0b3BpYyB0byB3aGljaCB0aGUgbWVzc2FnZSBpcyB0byBiZSBwdWJsaXNoZWQuCiAgICAgICAqIAkJCQkJICAgLSBJZiBpdCBpcyB0aGUgb25seSBwYXJhbWV0ZXIsIHVzZWQgYXMgUGFoby5NUVRULk1lc3NhZ2Ugb2JqZWN0LgogICAgICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheUJ1ZmZlcn0gcGF5bG9hZCAtIFRoZSBtZXNzYWdlIGRhdGEgdG8gYmUgcHVibGlzaGVkLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gcW9zIFRoZSBRdWFsaXR5IG9mIFNlcnZpY2UgdXNlZCB0byBkZWxpdmVyIHRoZSBtZXNzYWdlLgogICAgICAgKiAJCTxkbD4KICAgICAgICogCQkJPGR0PjAgQmVzdCBlZmZvcnQgKGRlZmF1bHQpLgogICAgICAgKiAgICAgCQkJPGR0PjEgQXQgbGVhc3Qgb25jZS4KICAgICAgICogICAgIAkJCTxkdD4yIEV4YWN0bHkgb25jZS4KICAgICAgICogCQk8L2RsPgogICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJldGFpbmVkIElmIHRydWUsIHRoZSBtZXNzYWdlIGlzIHRvIGJlIHJldGFpbmVkIGJ5IHRoZSBzZXJ2ZXIgYW5kIGRlbGl2ZXJlZAogICAgICAgKiAgICAgICAgICAgICAgICAgICAgIHRvIGJvdGggY3VycmVudCBhbmQgZnV0dXJlIHN1YnNjcmlwdGlvbnMuCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgSWYgZmFsc2UgdGhlIHNlcnZlciBvbmx5IGRlbGl2ZXJzIHRoZSBtZXNzYWdlIHRvIGN1cnJlbnQgc3Vic2NyaWJlcnMsIHRoaXMgaXMgdGhlIGRlZmF1bHQgZm9yIG5ldyBNZXNzYWdlcy4KICAgICAgICogICAgICAgICAgICAgICAgICAgICBBIHJlY2VpdmVkIG1lc3NhZ2UgaGFzIHRoZSByZXRhaW5lZCBib29sZWFuIHNldCB0byB0cnVlIGlmIHRoZSBtZXNzYWdlIHdhcyBwdWJsaXNoZWQKICAgICAgICogICAgICAgICAgICAgICAgICAgICB3aXRoIHRoZSByZXRhaW5lZCBib29sZWFuIHNldCB0byB0cnVlCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgYW5kIHRoZSBzdWJzY3JwdGlvbiB3YXMgbWFkZSBhZnRlciB0aGUgbWVzc2FnZSBoYXMgYmVlbiBwdWJsaXNoZWQuCiAgICAgICAqIEB0aHJvd3Mge0ludmFsaWRTdGF0ZX0gaWYgdGhlIGNsaWVudCBpcyBub3QgY29ubmVjdGVkLgogICAgICAgKi8KCgogICAgICB0aGlzLnB1Ymxpc2ggPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQsIHFvcywgcmV0YWluZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygiUHVibGlzaW5nIG1lc3NhZ2UgdG86ICIsIHRvcGljKTsKICAgICAgICB2YXIgbWVzc2FnZTsKCiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudC4iICsgImxlbmd0aCIpOwogICAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICBpZiAoISh0b3BpYyBpbnN0YW5jZW9mIE1lc3NhZ2UpICYmIHR5cGVvZiB0b3BpYyAhPT0gInN0cmluZyIpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudDoiICsgX3R5cGVvZih0b3BpYykpOwogICAgICAgICAgbWVzc2FnZSA9IHRvcGljOwogICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW21lc3NhZ2UuZGVzdGluYXRpb25OYW1lLCAiTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUiXSkpOwogICAgICAgICAgY2xpZW50LnNlbmQobWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vcGFyYW1ldGVyIGNoZWNraW5nIGluIE1lc3NhZ2Ugb2JqZWN0CiAgICAgICAgICBtZXNzYWdlID0gbmV3IE1lc3NhZ2UocGF5bG9hZCk7CiAgICAgICAgICBtZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9IHRvcGljOwogICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gMykgbWVzc2FnZS5xb3MgPSBxb3M7CiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSA0KSBtZXNzYWdlLnJldGFpbmVkID0gcmV0YWluZWQ7CiAgICAgICAgICBjbGllbnQuc2VuZChtZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBOb3JtYWwgZGlzY29ubmVjdCBvZiB0aGlzIE1lc3NhZ2luZyBjbGllbnQgZnJvbSBpdHMgc2VydmVyLgogICAgICAgKgogICAgICAgKiBAbmFtZSBQYWhvLk1RVFQuQ2xpZW50I2Rpc2Nvbm5lY3QKICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAqIEB0aHJvd3Mge0ludmFsaWRTdGF0ZX0gaWYgdGhlIGNsaWVudCBpcyBhbHJlYWR5IGRpc2Nvbm5lY3RlZC4KICAgICAgICovCgoKICAgICAgdGhpcy5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNsaWVudC5kaXNjb25uZWN0KCk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBHZXQgdGhlIGNvbnRlbnRzIG9mIHRoZSB0cmFjZSBsb2cuCiAgICAgICAqCiAgICAgICAqIEBuYW1lIFBhaG8uTVFUVC5DbGllbnQjZ2V0VHJhY2VMb2cKICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAqIEByZXR1cm4ge09iamVjdFtdfSB0cmFjZWJ1ZmZlciBjb250YWluaW5nIHRoZSB0aW1lIG9yZGVyZWQgdHJhY2UgcmVjb3Jkcy4KICAgICAgICovCgoKICAgICAgdGhpcy5nZXRUcmFjZUxvZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gY2xpZW50LmdldFRyYWNlTG9nKCk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBTdGFydCB0cmFjaW5nLgogICAgICAgKgogICAgICAgKiBAbmFtZSBQYWhvLk1RVFQuQ2xpZW50I3N0YXJ0VHJhY2UKICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAqLwoKCiAgICAgIHRoaXMuc3RhcnRUcmFjZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjbGllbnQuc3RhcnRUcmFjZSgpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogU3RvcCB0cmFjaW5nLgogICAgICAgKgogICAgICAgKiBAbmFtZSBQYWhvLk1RVFQuQ2xpZW50I3N0b3BUcmFjZQogICAgICAgKiBAZnVuY3Rpb24KICAgICAgICovCgoKICAgICAgdGhpcy5zdG9wVHJhY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xpZW50LnN0b3BUcmFjZSgpOwogICAgICB9OwoKICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gY2xpZW50LmNvbm5lY3RlZDsKICAgICAgfTsKICAgIH07CgogICAgQ2xpZW50LnByb3RvdHlwZSA9IHsKICAgICAgZ2V0IGhvc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEhvc3QoKTsKICAgICAgfSwKCiAgICAgIHNldCBob3N0KG5ld0hvc3QpIHsKICAgICAgICB0aGlzLl9zZXRIb3N0KG5ld0hvc3QpOwogICAgICB9LAoKICAgICAgZ2V0IHBvcnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBvcnQoKTsKICAgICAgfSwKCiAgICAgIHNldCBwb3J0KG5ld1BvcnQpIHsKICAgICAgICB0aGlzLl9zZXRQb3J0KG5ld1BvcnQpOwogICAgICB9LAoKICAgICAgZ2V0IHBhdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBhdGgoKTsKICAgICAgfSwKCiAgICAgIHNldCBwYXRoKG5ld1BhdGgpIHsKICAgICAgICB0aGlzLl9zZXRQYXRoKG5ld1BhdGgpOwogICAgICB9LAoKICAgICAgZ2V0IGNsaWVudElkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRDbGllbnRJZCgpOwogICAgICB9LAoKICAgICAgc2V0IGNsaWVudElkKG5ld0NsaWVudElkKSB7CiAgICAgICAgdGhpcy5fc2V0Q2xpZW50SWQobmV3Q2xpZW50SWQpOwogICAgICB9LAoKICAgICAgZ2V0IG9uQ29ubmVjdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRPbkNvbm5lY3RlZCgpOwogICAgICB9LAoKICAgICAgc2V0IG9uQ29ubmVjdGVkKG5ld09uQ29ubmVjdGVkKSB7CiAgICAgICAgdGhpcy5fc2V0T25Db25uZWN0ZWQobmV3T25Db25uZWN0ZWQpOwogICAgICB9LAoKICAgICAgZ2V0IGRpc2Nvbm5lY3RlZFB1Ymxpc2hpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldERpc2Nvbm5lY3RlZFB1Ymxpc2hpbmcoKTsKICAgICAgfSwKCiAgICAgIHNldCBkaXNjb25uZWN0ZWRQdWJsaXNoaW5nKG5ld0Rpc2Nvbm5lY3RlZFB1Ymxpc2hpbmcpIHsKICAgICAgICB0aGlzLl9zZXREaXNjb25uZWN0ZWRQdWJsaXNoaW5nKG5ld0Rpc2Nvbm5lY3RlZFB1Ymxpc2hpbmcpOwogICAgICB9LAoKICAgICAgZ2V0IGRpc2Nvbm5lY3RlZEJ1ZmZlclNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldERpc2Nvbm5lY3RlZEJ1ZmZlclNpemUoKTsKICAgICAgfSwKCiAgICAgIHNldCBkaXNjb25uZWN0ZWRCdWZmZXJTaXplKG5ld0Rpc2Nvbm5lY3RlZEJ1ZmZlclNpemUpIHsKICAgICAgICB0aGlzLl9zZXREaXNjb25uZWN0ZWRCdWZmZXJTaXplKG5ld0Rpc2Nvbm5lY3RlZEJ1ZmZlclNpemUpOwogICAgICB9LAoKICAgICAgZ2V0IG9uQ29ubmVjdGlvbkxvc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldE9uQ29ubmVjdGlvbkxvc3QoKTsKICAgICAgfSwKCiAgICAgIHNldCBvbkNvbm5lY3Rpb25Mb3N0KG5ld09uQ29ubmVjdGlvbkxvc3QpIHsKICAgICAgICB0aGlzLl9zZXRPbkNvbm5lY3Rpb25Mb3N0KG5ld09uQ29ubmVjdGlvbkxvc3QpOwogICAgICB9LAoKICAgICAgZ2V0IG9uTWVzc2FnZURlbGl2ZXJlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0T25NZXNzYWdlRGVsaXZlcmVkKCk7CiAgICAgIH0sCgogICAgICBzZXQgb25NZXNzYWdlRGVsaXZlcmVkKG5ld09uTWVzc2FnZURlbGl2ZXJlZCkgewogICAgICAgIHRoaXMuX3NldE9uTWVzc2FnZURlbGl2ZXJlZChuZXdPbk1lc3NhZ2VEZWxpdmVyZWQpOwogICAgICB9LAoKICAgICAgZ2V0IG9uTWVzc2FnZUFycml2ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldE9uTWVzc2FnZUFycml2ZWQoKTsKICAgICAgfSwKCiAgICAgIHNldCBvbk1lc3NhZ2VBcnJpdmVkKG5ld09uTWVzc2FnZUFycml2ZWQpIHsKICAgICAgICB0aGlzLl9zZXRPbk1lc3NhZ2VBcnJpdmVkKG5ld09uTWVzc2FnZUFycml2ZWQpOwogICAgICB9LAoKICAgICAgZ2V0IHRyYWNlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRUcmFjZSgpOwogICAgICB9LAoKICAgICAgc2V0IHRyYWNlKG5ld1RyYWNlRnVuY3Rpb24pIHsKICAgICAgICB0aGlzLl9zZXRUcmFjZShuZXdUcmFjZUZ1bmN0aW9uKTsKICAgICAgfQoKICAgIH07CiAgICAvKioKICAgICAqIEFuIGFwcGxpY2F0aW9uIG1lc3NhZ2UsIHNlbnQgb3IgcmVjZWl2ZWQuCiAgICAgKiA8cD4KICAgICAqIEFsbCBhdHRyaWJ1dGVzIG1heSBiZSBudWxsLCB3aGljaCBpbXBsaWVzIHRoZSBkZWZhdWx0IHZhbHVlcy4KICAgICAqCiAgICAgKiBAbmFtZSBQYWhvLk1RVFQuTWVzc2FnZQogICAgICogQGNvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheUJ1ZmZlcn0gcGF5bG9hZCBUaGUgbWVzc2FnZSBkYXRhIHRvIGJlIHNlbnQuCiAgICAgKiA8cD4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwYXlsb2FkU3RyaW5nIDxpPnJlYWQgb25seTwvaT4gVGhlIHBheWxvYWQgYXMgYSBzdHJpbmcgaWYgdGhlIHBheWxvYWQgY29uc2lzdHMgb2YgdmFsaWQgVVRGLTggY2hhcmFjdGVycy4KICAgICAqIEBwcm9wZXJ0eSB7QXJyYXlCdWZmZXJ9IHBheWxvYWRCeXRlcyA8aT5yZWFkIG9ubHk8L2k+IFRoZSBwYXlsb2FkIGFzIGFuIEFycmF5QnVmZmVyLgogICAgICogPHA+CiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gZGVzdGluYXRpb25OYW1lIDxiPm1hbmRhdG9yeTwvYj4gVGhlIG5hbWUgb2YgdGhlIGRlc3RpbmF0aW9uIHRvIHdoaWNoIHRoZSBtZXNzYWdlIGlzIHRvIGJlIHNlbnQKICAgICAqICAgICAgICAgICAgICAgICAgICAoZm9yIG1lc3NhZ2VzIGFib3V0IHRvIGJlIHNlbnQpIG9yIHRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiBmcm9tIHdoaWNoIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHJlY2VpdmVkLgogICAgICogICAgICAgICAgICAgICAgICAgIChmb3IgbWVzc2FnZXMgcmVjZWl2ZWQgYnkgdGhlIG9uTWVzc2FnZSBmdW5jdGlvbikuCiAgICAgKiA8cD4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBxb3MgVGhlIFF1YWxpdHkgb2YgU2VydmljZSB1c2VkIHRvIGRlbGl2ZXIgdGhlIG1lc3NhZ2UuCiAgICAgKiA8ZGw+CiAgICAgKiAgICAgPGR0PjAgQmVzdCBlZmZvcnQgKGRlZmF1bHQpLgogICAgICogICAgIDxkdD4xIEF0IGxlYXN0IG9uY2UuCiAgICAgKiAgICAgPGR0PjIgRXhhY3RseSBvbmNlLgogICAgICogPC9kbD4KICAgICAqIDxwPgogICAgICogQHByb3BlcnR5IHtCb29sZWFufSByZXRhaW5lZCBJZiB0cnVlLCB0aGUgbWVzc2FnZSBpcyB0byBiZSByZXRhaW5lZCBieSB0aGUgc2VydmVyIGFuZCBkZWxpdmVyZWQKICAgICAqICAgICAgICAgICAgICAgICAgICAgdG8gYm90aCBjdXJyZW50IGFuZCBmdXR1cmUgc3Vic2NyaXB0aW9ucy4KICAgICAqICAgICAgICAgICAgICAgICAgICAgSWYgZmFsc2UgdGhlIHNlcnZlciBvbmx5IGRlbGl2ZXJzIHRoZSBtZXNzYWdlIHRvIGN1cnJlbnQgc3Vic2NyaWJlcnMsIHRoaXMgaXMgdGhlIGRlZmF1bHQgZm9yIG5ldyBNZXNzYWdlcy4KICAgICAqICAgICAgICAgICAgICAgICAgICAgQSByZWNlaXZlZCBtZXNzYWdlIGhhcyB0aGUgcmV0YWluZWQgYm9vbGVhbiBzZXQgdG8gdHJ1ZSBpZiB0aGUgbWVzc2FnZSB3YXMgcHVibGlzaGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdpdGggdGhlIHJldGFpbmVkIGJvb2xlYW4gc2V0IHRvIHRydWUKICAgICAqICAgICAgICAgICAgICAgICAgICAgYW5kIHRoZSBzdWJzY3JwdGlvbiB3YXMgbWFkZSBhZnRlciB0aGUgbWVzc2FnZSBoYXMgYmVlbiBwdWJsaXNoZWQuCiAgICAgKiA8cD4KICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gZHVwbGljYXRlIDxpPnJlYWQgb25seTwvaT4gSWYgdHJ1ZSwgdGhpcyBtZXNzYWdlIG1pZ2h0IGJlIGEgZHVwbGljYXRlIG9mIG9uZSB3aGljaCBoYXMgYWxyZWFkeSBiZWVuIHJlY2VpdmVkLgogICAgICogICAgICAgICAgICAgICAgICAgICBUaGlzIGlzIG9ubHkgc2V0IG9uIG1lc3NhZ2VzIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlci4KICAgICAqCiAgICAgKi8KCiAgICB2YXIgTWVzc2FnZSA9IGZ1bmN0aW9uIE1lc3NhZ2UobmV3UGF5bG9hZCkgewogICAgICB2YXIgcGF5bG9hZDsKCiAgICAgIGlmICh0eXBlb2YgbmV3UGF5bG9hZCA9PT0gInN0cmluZyIgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBJbnQ4QXJyYXkgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIEludDE2QXJyYXkgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5IHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBJbnQzMkFycmF5IHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBVaW50MzJBcnJheSB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpIHsKICAgICAgICBwYXlsb2FkID0gbmV3UGF5bG9hZDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW25ld1BheWxvYWQsICJuZXdQYXlsb2FkIl0pOwogICAgICB9CgogICAgICB0aGlzLl9nZXRQYXlsb2FkU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0eXBlb2YgcGF5bG9hZCA9PT0gInN0cmluZyIpIHJldHVybiBwYXlsb2FkO2Vsc2UgcmV0dXJuIHBhcnNlVVRGOChwYXlsb2FkLCAwLCBwYXlsb2FkLmxlbmd0aCk7CiAgICAgIH07CgogICAgICB0aGlzLl9nZXRQYXlsb2FkQnl0ZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBwYXlsb2FkID09PSAic3RyaW5nIikgewogICAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihVVEY4TGVuZ3RoKHBheWxvYWQpKTsKICAgICAgICAgIHZhciBieXRlU3RyZWFtID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgICAgIHN0cmluZ1RvVVRGOChwYXlsb2FkLCBieXRlU3RyZWFtLCAwKTsKICAgICAgICAgIHJldHVybiBieXRlU3RyZWFtOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcGF5bG9hZDsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgZGVzdGluYXRpb25OYW1lOwoKICAgICAgdGhpcy5fZ2V0RGVzdGluYXRpb25OYW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBkZXN0aW5hdGlvbk5hbWU7CiAgICAgIH07CgogICAgICB0aGlzLl9zZXREZXN0aW5hdGlvbk5hbWUgPSBmdW5jdGlvbiAobmV3RGVzdGluYXRpb25OYW1lKSB7CiAgICAgICAgaWYgKHR5cGVvZiBuZXdEZXN0aW5hdGlvbk5hbWUgPT09ICJzdHJpbmciKSBkZXN0aW5hdGlvbk5hbWUgPSBuZXdEZXN0aW5hdGlvbk5hbWU7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtuZXdEZXN0aW5hdGlvbk5hbWUsICJuZXdEZXN0aW5hdGlvbk5hbWUiXSkpOwogICAgICB9OwoKICAgICAgdmFyIHFvcyA9IDA7CgogICAgICB0aGlzLl9nZXRRb3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHFvczsKICAgICAgfTsKCiAgICAgIHRoaXMuX3NldFFvcyA9IGZ1bmN0aW9uIChuZXdRb3MpIHsKICAgICAgICBpZiAobmV3UW9zID09PSAwIHx8IG5ld1FvcyA9PT0gMSB8fCBuZXdRb3MgPT09IDIpIHFvcyA9IG5ld1FvcztlbHNlIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudDoiICsgbmV3UW9zKTsKICAgICAgfTsKCiAgICAgIHZhciByZXRhaW5lZCA9IGZhbHNlOwoKICAgICAgdGhpcy5fZ2V0UmV0YWluZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHJldGFpbmVkOwogICAgICB9OwoKICAgICAgdGhpcy5fc2V0UmV0YWluZWQgPSBmdW5jdGlvbiAobmV3UmV0YWluZWQpIHsKICAgICAgICBpZiAodHlwZW9mIG5ld1JldGFpbmVkID09PSAiYm9vbGVhbiIpIHJldGFpbmVkID0gbmV3UmV0YWluZWQ7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtuZXdSZXRhaW5lZCwgIm5ld1JldGFpbmVkIl0pKTsKICAgICAgfTsKCiAgICAgIHZhciBkdXBsaWNhdGUgPSBmYWxzZTsKCiAgICAgIHRoaXMuX2dldER1cGxpY2F0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZHVwbGljYXRlOwogICAgICB9OwoKICAgICAgdGhpcy5fc2V0RHVwbGljYXRlID0gZnVuY3Rpb24gKG5ld0R1cGxpY2F0ZSkgewogICAgICAgIGR1cGxpY2F0ZSA9IG5ld0R1cGxpY2F0ZTsKICAgICAgfTsKICAgIH07CgogICAgTWVzc2FnZS5wcm90b3R5cGUgPSB7CiAgICAgIGdldCBwYXlsb2FkU3RyaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRQYXlsb2FkU3RyaW5nKCk7CiAgICAgIH0sCgogICAgICBnZXQgcGF5bG9hZEJ5dGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRQYXlsb2FkQnl0ZXMoKTsKICAgICAgfSwKCiAgICAgIGdldCBkZXN0aW5hdGlvbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldERlc3RpbmF0aW9uTmFtZSgpOwogICAgICB9LAoKICAgICAgc2V0IGRlc3RpbmF0aW9uTmFtZShuZXdEZXN0aW5hdGlvbk5hbWUpIHsKICAgICAgICB0aGlzLl9zZXREZXN0aW5hdGlvbk5hbWUobmV3RGVzdGluYXRpb25OYW1lKTsKICAgICAgfSwKCiAgICAgIGdldCB0b3BpYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RGVzdGluYXRpb25OYW1lKCk7CiAgICAgIH0sCgogICAgICBzZXQgdG9waWMobmV3VG9waWMpIHsKICAgICAgICB0aGlzLl9zZXREZXN0aW5hdGlvbk5hbWUobmV3VG9waWMpOwogICAgICB9LAoKICAgICAgZ2V0IHFvcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UW9zKCk7CiAgICAgIH0sCgogICAgICBzZXQgcW9zKG5ld1FvcykgewogICAgICAgIHRoaXMuX3NldFFvcyhuZXdRb3MpOwogICAgICB9LAoKICAgICAgZ2V0IHJldGFpbmVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9nZXRSZXRhaW5lZCgpOwogICAgICB9LAoKICAgICAgc2V0IHJldGFpbmVkKG5ld1JldGFpbmVkKSB7CiAgICAgICAgdGhpcy5fc2V0UmV0YWluZWQobmV3UmV0YWluZWQpOwogICAgICB9LAoKICAgICAgZ2V0IGR1cGxpY2F0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RHVwbGljYXRlKCk7CiAgICAgIH0sCgogICAgICBzZXQgZHVwbGljYXRlKG5ld0R1cGxpY2F0ZSkgewogICAgICAgIHRoaXMuX3NldER1cGxpY2F0ZShuZXdEdXBsaWNhdGUpOwogICAgICB9CgogICAgfTsgLy8gTW9kdWxlIGNvbnRlbnRzLgoKICAgIHJldHVybiB7CiAgICAgIENsaWVudDogQ2xpZW50LAogICAgICBNZXNzYWdlOiBNZXNzYWdlCiAgICB9OwogIH0od2luZG93KTsKCiAgcmV0dXJuIFBhaG9NUVRUOwp9KTs="},{"version":3,"sources":["/home/philippine/Documents/TD/Code/Dashboard_test/dashboard/src/paho-mqtt.js"],"names":["ExportLibrary","root","factory","exports","module","define","amd","Paho","MQTT","LibraryFactory","PahoMQTT","global","version","buildLevel","MESSAGE_TYPE","CONNECT","CONNACK","PUBLISH","PUBACK","PUBREC","PUBREL","PUBCOMP","SUBSCRIBE","SUBACK","UNSUBSCRIBE","UNSUBACK","PINGREQ","PINGRESP","DISCONNECT","validate","obj","keys","key","hasOwnProperty","Error","format","ERROR","INVALID_TYPE","errorStr","validKey","scope","f","apply","arguments","OK","code","text","CONNECT_TIMEOUT","SUBSCRIBE_TIMEOUT","UNSUBSCRIBE_TIMEOUT","PING_TIMEOUT","INTERNAL_ERROR","CONNACK_RETURNCODE","SOCKET_ERROR","SOCKET_CLOSE","MALFORMED_UTF","UNSUPPORTED","INVALID_STATE","INVALID_ARGUMENT","UNSUPPORTED_OPERATION","INVALID_STORED_DATA","INVALID_MQTT_MESSAGE_TYPE","MALFORMED_UNICODE","BUFFER_FULL","CONNACK_RC","error","substitutions","field","start","i","length","indexOf","part1","substring","part2","MqttProtoIdentifierv3","MqttProtoIdentifierv4","WireMessage","type","options","name","prototype","encode","first","remLength","topicStrLength","destinationNameLength","willMessagePayloadBytes","messageIdentifier","undefined","mqttVersion","UTF8Length","clientId","willMessage","destinationName","payloadBytes","Uint8Array","byteLength","userName","password","topics","requestedQos","payloadMessage","duplicate","qos","retained","ArrayBuffer","buffer","mbi","encodeMBI","pos","byteStream","set","writeString","connectFlags","cleanSession","writeUint16","keepAliveInterval","decodeMessage","input","startingPos","messageInfo","digit","multiplier","endPos","wireMessage","connectAcknowledgeFlags","sessionPresent","returnCode","len","readUint16","topicName","parseUTF8","message","Message","subarray","offset","utf8Length","stringToUTF8","number","output","Array","numBytes","charCode","charCodeAt","lowCharCode","isNaN","utf16","byte1","byte2","toString","byte3","byte4","String","fromCharCode","Pinger","client","window","_client","_window","_keepAliveInterval","isReset","pingReq","doTimeout","pinger","doPing","_trace","_disconnected","socket","send","timeout","setTimeout","reset","clearTimeout","cancel","Timeout","timeoutSeconds","action","args","ClientImpl","uri","host","port","path","WebSocket","localStorage","_wsuri","_localKey","_msg_queue","_buffered_msg_queue","_sentMessages","_receivedMessages","_notify_msg_sent","_message_identifier","_sequence","restore","connected","maxMessageIdentifier","connectOptions","hostIndex","onConnected","onConnectionLost","onMessageDelivered","onMessageArrived","traceFunction","_connectTimeout","sendPinger","receivePinger","_reconnectInterval","_reconnecting","_reconnectTimeout","disconnectedPublishing","disconnectedBufferSize","receiveBuffer","_traceBuffer","_MAX_TRACE_ENTRIES","connect","connectOptionsMasked","_traceMask","uris","_doConnect","subscribe","filter","subscribeOptions","onSuccess","grantedQos","invocationContext","onFailure","errorCode","errorMessage","timeOut","_requires_ack","_schedule_message","unsubscribe","unsubscribeOptions","callback","messageCount","Object","sequence","push","disconnect","getTraceLog","Date","startTrace","stopTrace","wsurl","useSSL","uriParts","split","join","binaryType","onopen","_on_socket_open","onmessage","_on_socket_message","onerror","_on_socket_error","onclose","_on_socket_close","_process_queue","store","prefix","storedMessage","pubRecReceived","hex","messageBytes","payloadHex","setItem","JSON","stringify","value","getItem","parse","x","parseInt","fifo","reverse","pop","_socket_send","event","data","messages","_deframeMessages","_handleMessage","byteArray","newData","result","errorStack","stack","sentMessage","removeItem","receivedMessage","sequencedMessages","msgId","msg","sort","a","b","pubRelMessage","reconnected","_connected","_receivePublish","_receiveMessage","pubCompMessage","wireMessageMasked","pubAckMessage","pubRecMessage","wireMmessage","reconnect","_reconnect","errorText","readyState","close","mqttVersionExplicit","splice","record","slice","call","severity","max","shift","traceObject","masked","traceObjectMasked","attr","Client","match","ipv6AddSBracket","clientIdLength","_getHost","_setHost","_getPort","_setPort","_getPath","_setPath","_getURI","_setURI","_getClientId","_setClientId","_getOnConnected","_setOnConnected","newOnConnected","_getDisconnectedPublishing","_setDisconnectedPublishing","newDisconnectedPublishing","_getDisconnectedBufferSize","_setDisconnectedBufferSize","newDisconnectedBufferSize","_getOnConnectionLost","_setOnConnectionLost","newOnConnectionLost","_getOnMessageDelivered","_setOnMessageDelivered","newOnMessageDelivered","_getOnMessageArrived","_setOnMessageArrived","newOnMessageArrived","_getTrace","_setTrace","trace","hosts","ports","stringPayload","usingURIs","test","ipv6","topic","payload","publish","console","log","isConnected","newHost","newPort","newPath","newClientId","newTraceFunction","newPayload","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","_getPayloadString","_getPayloadBytes","_getDestinationName","_setDestinationName","newDestinationName","_getQos","_setQos","newQos","_getRetained","_setRetained","newRetained","_getDuplicate","_setDuplicate","newDuplicate","payloadString","newTopic"],"mappings":"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","sourcesContent":["/*******************************************************************************\n * Copyright (c) 2013 IBM Corp.\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * and Eclipse Distribution License v1.0 which accompany this distribution.\n *\n * The Eclipse Public License is available at\n *    http://www.eclipse.org/legal/epl-v10.html\n * and the Eclipse Distribution License is available at\n *   http://www.eclipse.org/org/documents/edl-v10.php.\n *\n * Contributors:\n *    Andrew Banks - initial API and implementation and initial documentation\n *******************************************************************************/\n\n\n// Only expose a single object name in the global namespace.\n// Everything must go through this module. Global Paho.MQTT module\n// only has a single public function, client, which returns\n// a Paho.MQTT client object given connection details.\n\n/**\n * Send and receive messages using web browsers.\n * <p>\n * This programming interface lets a JavaScript client application use the MQTT V3.1 or\n * V3.1.1 protocol to connect to an MQTT-supporting messaging server.\n *\n * The function supported includes:\n * <ol>\n * <li>Connecting to and disconnecting from a server. The server is identified by its host name and port number.\n * <li>Specifying options that relate to the communications link with the server,\n * for example the frequency of keep-alive heartbeats, and whether SSL/TLS is required.\n * <li>Subscribing to and receiving messages from MQTT Topics.\n * <li>Publishing messages to MQTT Topics.\n * </ol>\n * <p>\n * The API consists of two main objects:\n * <dl>\n * <dt><b>{@link Paho.MQTT.Client}</b></dt>\n * <dd>This contains methods that provide the functionality of the API,\n * including provision of callbacks that notify the application when a message\n * arrives from or is delivered to the messaging server,\n * or when the status of its connection to the messaging server changes.</dd>\n * <dt><b>{@link Paho.MQTT.Message}</b></dt>\n * <dd>This encapsulates the payload of the message along with various attributes\n * associated with its delivery, in particular the destination to which it has\n * been (or is about to be) sent.</dd>\n * </dl>\n * <p>\n * The programming interface validates parameters passed to it, and will throw\n * an Error containing an error message intended for developer use, if it detects\n * an error with any parameter.\n * <p>\n * Example:\n *\n * <code><pre>\nclient = new Paho.MQTT.Client(location.hostname, Number(location.port), \"clientId\");\nclient.onConnectionLost = onConnectionLost;\nclient.onMessageArrived = onMessageArrived;\nclient.connect({onSuccess:onConnect});\n\nfunction onConnect() {\n  // Once a connection has been made, make a subscription and send a message.\n  console.log(\"onConnect\");\n  client.subscribe(\"/World\");\n  message = new Paho.MQTT.Message(\"Hello\");\n  message.destinationName = \"/World\";\n  client.send(message);\n};\nfunction onConnectionLost(responseObject) {\n  if (responseObject.errorCode !== 0)\n\tconsole.log(\"onConnectionLost:\"+responseObject.errorMessage);\n};\nfunction onMessageArrived(message) {\n  console.log(\"onMessageArrived:\"+message.payloadString);\n  client.disconnect();\n};\n * </pre></code>\n * @namespace Paho.MQTT\n */\n\n/* jshint shadow:true */\n(function ExportLibrary(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object'){\n\t\tmodule.exports = factory();\n\t} else if (typeof define === 'function' && define.amd){\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object'){\n\t\texports = factory();\n\t} else {\n\t\tif (typeof root.Paho === 'undefined'){\n\t\t\troot.Paho = {};\n\t\t}\n\t\troot.Paho.MQTT = factory();\n\t}\n})(this, function LibraryFactory(){\n\n\nvar PahoMQTT = (function (global) {\n\n\t// Private variables below, these are only visible inside the function closure\n\t// which is used to define the module.\n\n\tvar version = \"@VERSION@\";\n\tvar buildLevel = \"@BUILDLEVEL@\";\n\n\t/**\n\t * Unique message type identifiers, with associated\n\t * associated integer values.\n\t * @private\n\t */\n\tvar MESSAGE_TYPE = {\n\t\tCONNECT: 1,\n\t\tCONNACK: 2,\n\t\tPUBLISH: 3,\n\t\tPUBACK: 4,\n\t\tPUBREC: 5,\n\t\tPUBREL: 6,\n\t\tPUBCOMP: 7,\n\t\tSUBSCRIBE: 8,\n\t\tSUBACK: 9,\n\t\tUNSUBSCRIBE: 10,\n\t\tUNSUBACK: 11,\n\t\tPINGREQ: 12,\n\t\tPINGRESP: 13,\n\t\tDISCONNECT: 14\n\t};\n\n\t// Collection of utility methods used to simplify module code\n\t// and promote the DRY pattern.\n\n\t/**\n\t * Validate an object's parameter names to ensure they\n\t * match a list of expected variables name for this option\n\t * type. Used to ensure option object passed into the API don't\n\t * contain erroneous parameters.\n\t * @param {Object} obj - User options object\n\t * @param {Object} keys - valid keys and types that may exist in obj.\n\t * @throws {Error} Invalid option parameter found.\n\t * @private\n\t */\n\tvar validate = function(obj, keys) {\n\t\tfor (var key in obj) {\n\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\tif (keys.hasOwnProperty(key)) {\n\t\t\t\t\tif (typeof obj[key] !== keys[key])\n\t\t\t\t\t   throw new Error(format(ERROR.INVALID_TYPE, [typeof obj[key], key]));\n\t\t\t\t} else {\n\t\t\t\t\tvar errorStr = \"Unknown property, \" + key + \". Valid properties are:\";\n\t\t\t\t\tfor (var validKey in keys)\n\t\t\t\t\t\tif (keys.hasOwnProperty(validKey))\n\t\t\t\t\t\t\terrorStr = errorStr+\" \"+validKey;\n\t\t\t\t\tthrow new Error(errorStr);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Return a new function which runs the user function bound\n\t * to a fixed scope.\n\t * @param {function} User function\n\t * @param {object} Function scope\n\t * @return {function} User function bound to another scope\n\t * @private\n\t */\n\tvar scope = function (f, scope) {\n\t\treturn function () {\n\t\t\treturn f.apply(scope, arguments);\n\t\t};\n\t};\n\n\t/**\n\t * Unique message type identifiers, with associated\n\t * associated integer values.\n\t * @private\n\t */\n\tvar ERROR = {\n\t\tOK: {code:0, text:\"AMQJSC0000I OK.\"},\n\t\tCONNECT_TIMEOUT: {code:1, text:\"AMQJSC0001E Connect timed out.\"},\n\t\tSUBSCRIBE_TIMEOUT: {code:2, text:\"AMQJS0002E Subscribe timed out.\"},\n\t\tUNSUBSCRIBE_TIMEOUT: {code:3, text:\"AMQJS0003E Unsubscribe timed out.\"},\n\t\tPING_TIMEOUT: {code:4, text:\"AMQJS0004E Ping timed out.\"},\n\t\tINTERNAL_ERROR: {code:5, text:\"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}\"},\n\t\tCONNACK_RETURNCODE: {code:6, text:\"AMQJS0006E Bad Connack return code:{0} {1}.\"},\n\t\tSOCKET_ERROR: {code:7, text:\"AMQJS0007E Socket error:{0}.\"},\n\t\tSOCKET_CLOSE: {code:8, text:\"AMQJS0008I Socket closed.\"},\n\t\tMALFORMED_UTF: {code:9, text:\"AMQJS0009E Malformed UTF data:{0} {1} {2}.\"},\n\t\tUNSUPPORTED: {code:10, text:\"AMQJS0010E {0} is not supported by this browser.\"},\n\t\tINVALID_STATE: {code:11, text:\"AMQJS0011E Invalid state {0}.\"},\n\t\tINVALID_TYPE: {code:12, text:\"AMQJS0012E Invalid type {0} for {1}.\"},\n\t\tINVALID_ARGUMENT: {code:13, text:\"AMQJS0013E Invalid argument {0} for {1}.\"},\n\t\tUNSUPPORTED_OPERATION: {code:14, text:\"AMQJS0014E Unsupported operation.\"},\n\t\tINVALID_STORED_DATA: {code:15, text:\"AMQJS0015E Invalid data in local storage key={0} value={1}.\"},\n\t\tINVALID_MQTT_MESSAGE_TYPE: {code:16, text:\"AMQJS0016E Invalid MQTT message type {0}.\"},\n\t\tMALFORMED_UNICODE: {code:17, text:\"AMQJS0017E Malformed Unicode string:{0} {1}.\"},\n\t\tBUFFER_FULL: {code:18, text:\"AMQJS0018E Message buffer is full, maximum buffer size: {0}.\"},\n\t};\n\n\t/** CONNACK RC Meaning. */\n\tvar CONNACK_RC = {\n\t\t0:\"Connection Accepted\",\n\t\t1:\"Connection Refused: unacceptable protocol version\",\n\t\t2:\"Connection Refused: identifier rejected\",\n\t\t3:\"Connection Refused: server unavailable\",\n\t\t4:\"Connection Refused: bad user name or password\",\n\t\t5:\"Connection Refused: not authorized\"\n\t};\n\n\t/**\n\t * Format an error message text.\n\t * @private\n\t * @param {error} ERROR.KEY value above.\n\t * @param {substitutions} [array] substituted into the text.\n\t * @return the text with the substitutions made.\n\t */\n\tvar format = function(error, substitutions) {\n\t\tvar text = error.text;\n\t\tif (substitutions) {\n\t\t  var field,start;\n\t\t  for (var i=0; i<substitutions.length; i++) {\n\t\t\tfield = \"{\"+i+\"}\";\n\t\t\tstart = text.indexOf(field);\n\t\t\tif(start > 0) {\n\t\t\t\tvar part1 = text.substring(0,start);\n\t\t\t\tvar part2 = text.substring(start+field.length);\n\t\t\t\ttext = part1+substitutions[i]+part2;\n\t\t\t}\n\t\t  }\n\t\t}\n\t\treturn text;\n\t};\n\n\t//MQTT protocol and version          6    M    Q    I    s    d    p    3\n\tvar MqttProtoIdentifierv3 = [0x00,0x06,0x4d,0x51,0x49,0x73,0x64,0x70,0x03];\n\t//MQTT proto/version for 311         4    M    Q    T    T    4\n\tvar MqttProtoIdentifierv4 = [0x00,0x04,0x4d,0x51,0x54,0x54,0x04];\n\n\t/**\n\t * Construct an MQTT wire protocol message.\n\t * @param type MQTT packet type.\n\t * @param options optional wire message attributes.\n\t *\n\t * Optional properties\n\t *\n\t * messageIdentifier: message ID in the range [0..65535]\n\t * payloadMessage:\tApplication Message - PUBLISH only\n\t * connectStrings:\tarray of 0 or more Strings to be put into the CONNECT payload\n\t * topics:\t\t\tarray of strings (SUBSCRIBE, UNSUBSCRIBE)\n\t * requestQoS:\t\tarray of QoS values [0..2]\n\t *\n\t * \"Flag\" properties\n\t * cleanSession:\ttrue if present / false if absent (CONNECT)\n\t * willMessage:  \ttrue if present / false if absent (CONNECT)\n\t * isRetained:\t\ttrue if present / false if absent (CONNECT)\n\t * userName:\t\ttrue if present / false if absent (CONNECT)\n\t * password:\t\ttrue if present / false if absent (CONNECT)\n\t * keepAliveInterval:\tinteger [0..65535]  (CONNECT)\n\t *\n\t * @private\n\t * @ignore\n\t */\n\tvar WireMessage = function (type, options) {\n\t\tthis.type = type;\n\t\tfor (var name in options) {\n\t\t\tif (options.hasOwnProperty(name)) {\n\t\t\t\tthis[name] = options[name];\n\t\t\t}\n\t\t}\n\t};\n\n\tWireMessage.prototype.encode = function() {\n\t\t// Compute the first byte of the fixed header\n\t\tvar first = ((this.type & 0x0f) << 4);\n\n\t\t/*\n\t\t * Now calculate the length of the variable header + payload by adding up the lengths\n\t\t * of all the component parts\n\t\t */\n\n\t\tvar remLength = 0;\n\t\tvar topicStrLength = [];\n\t\tvar destinationNameLength = 0;\n\t\tvar willMessagePayloadBytes;\n\n\t\t// if the message contains a messageIdentifier then we need two bytes for that\n\t\tif (this.messageIdentifier !== undefined)\n\t\t\tremLength += 2;\n\n\t\tswitch(this.type) {\n\t\t\t// If this a Connect then we need to include 12 bytes for its header\n\t\t\tcase MESSAGE_TYPE.CONNECT:\n\t\t\t\tswitch(this.mqttVersion) {\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tremLength += MqttProtoIdentifierv3.length + 3;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\tremLength += MqttProtoIdentifierv4.length + 3;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tremLength += UTF8Length(this.clientId) + 2;\n\t\t\t\tif (this.willMessage !== undefined) {\n\t\t\t\t\tremLength += UTF8Length(this.willMessage.destinationName) + 2;\n\t\t\t\t\t// Will message is always a string, sent as UTF-8 characters with a preceding length.\n\t\t\t\t\twillMessagePayloadBytes = this.willMessage.payloadBytes;\n\t\t\t\t\tif (!(willMessagePayloadBytes instanceof Uint8Array))\n\t\t\t\t\t\twillMessagePayloadBytes = new Uint8Array(payloadBytes);\n\t\t\t\t\tremLength += willMessagePayloadBytes.byteLength +2;\n\t\t\t\t}\n\t\t\t\tif (this.userName !== undefined)\n\t\t\t\t\tremLength += UTF8Length(this.userName) + 2;\n\t\t\t\tif (this.password !== undefined)\n\t\t\t\t\tremLength += UTF8Length(this.password) + 2;\n\t\t\tbreak;\n\n\t\t\t// Subscribe, Unsubscribe can both contain topic strings\n\t\t\tcase MESSAGE_TYPE.SUBSCRIBE:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tfor ( var i = 0; i < this.topics.length; i++) {\n\t\t\t\t\ttopicStrLength[i] = UTF8Length(this.topics[i]);\n\t\t\t\t\tremLength += topicStrLength[i] + 2;\n\t\t\t\t}\n\t\t\t\tremLength += this.requestedQos.length; // 1 byte for each topic's Qos\n\t\t\t\t// QoS on Subscribe only\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.UNSUBSCRIBE:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tfor ( var i = 0; i < this.topics.length; i++) {\n\t\t\t\t\ttopicStrLength[i] = UTF8Length(this.topics[i]);\n\t\t\t\t\tremLength += topicStrLength[i] + 2;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBREL:\n\t\t\t\tfirst |= 0x02; // Qos = 1;\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tif (this.payloadMessage.duplicate) first |= 0x08;\n\t\t\t\tfirst  = first |= (this.payloadMessage.qos << 1);\n\t\t\t\tif (this.payloadMessage.retained) first |= 0x01;\n\t\t\t\tdestinationNameLength = UTF8Length(this.payloadMessage.destinationName);\n\t\t\t\tremLength += destinationNameLength + 2;\n\t\t\t\tvar payloadBytes = this.payloadMessage.payloadBytes;\n\t\t\t\tremLength += payloadBytes.byteLength;\n\t\t\t\tif (payloadBytes instanceof ArrayBuffer)\n\t\t\t\t\tpayloadBytes = new Uint8Array(payloadBytes);\n\t\t\t\telse if (!(payloadBytes instanceof Uint8Array))\n\t\t\t\t\tpayloadBytes = new Uint8Array(payloadBytes.buffer);\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.DISCONNECT:\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Now we can allocate a buffer for the message\n\n\t\tvar mbi = encodeMBI(remLength);  // Convert the length to MQTT MBI format\n\t\tvar pos = mbi.length + 1;        // Offset of start of variable header\n\t\tvar buffer = new ArrayBuffer(remLength + pos);\n\t\tvar byteStream = new Uint8Array(buffer);    // view it as a sequence of bytes\n\n\t\t//Write the fixed header into the buffer\n\t\tbyteStream[0] = first;\n\t\tbyteStream.set(mbi,1);\n\n\t\t// If this is a PUBLISH then the variable header starts with a topic\n\t\tif (this.type == MESSAGE_TYPE.PUBLISH)\n\t\t\tpos = writeString(this.payloadMessage.destinationName, destinationNameLength, byteStream, pos);\n\t\t// If this is a CONNECT then the variable header contains the protocol name/version, flags and keepalive time\n\n\t\telse if (this.type == MESSAGE_TYPE.CONNECT) {\n\t\t\tswitch (this.mqttVersion) {\n\t\t\t\tcase 3:\n\t\t\t\t\tbyteStream.set(MqttProtoIdentifierv3, pos);\n\t\t\t\t\tpos += MqttProtoIdentifierv3.length;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tbyteStream.set(MqttProtoIdentifierv4, pos);\n\t\t\t\t\tpos += MqttProtoIdentifierv4.length;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar connectFlags = 0;\n\t\t\tif (this.cleanSession)\n\t\t\t\tconnectFlags = 0x02;\n\t\t\tif (this.willMessage !== undefined ) {\n\t\t\t\tconnectFlags |= 0x04;\n\t\t\t\tconnectFlags |= (this.willMessage.qos<<3);\n\t\t\t\tif (this.willMessage.retained) {\n\t\t\t\t\tconnectFlags |= 0x20;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.userName !== undefined)\n\t\t\t\tconnectFlags |= 0x80;\n\t\t\tif (this.password !== undefined)\n\t\t\t\tconnectFlags |= 0x40;\n\t\t\tbyteStream[pos++] = connectFlags;\n\t\t\tpos = writeUint16 (this.keepAliveInterval, byteStream, pos);\n\t\t}\n\n\t\t// Output the messageIdentifier - if there is one\n\t\tif (this.messageIdentifier !== undefined)\n\t\t\tpos = writeUint16 (this.messageIdentifier, byteStream, pos);\n\n\t\tswitch(this.type) {\n\t\t\tcase MESSAGE_TYPE.CONNECT:\n\t\t\t\tpos = writeString(this.clientId, UTF8Length(this.clientId), byteStream, pos);\n\t\t\t\tif (this.willMessage !== undefined) {\n\t\t\t\t\tpos = writeString(this.willMessage.destinationName, UTF8Length(this.willMessage.destinationName), byteStream, pos);\n\t\t\t\t\tpos = writeUint16(willMessagePayloadBytes.byteLength, byteStream, pos);\n\t\t\t\t\tbyteStream.set(willMessagePayloadBytes, pos);\n\t\t\t\t\tpos += willMessagePayloadBytes.byteLength;\n\n\t\t\t\t}\n\t\t\tif (this.userName !== undefined)\n\t\t\t\tpos = writeString(this.userName, UTF8Length(this.userName), byteStream, pos);\n\t\t\tif (this.password !== undefined)\n\t\t\t\tpos = writeString(this.password, UTF8Length(this.password), byteStream, pos);\n\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\t// PUBLISH has a text or binary payload, if text do not add a 2 byte length field, just the UTF characters.\n\t\t\t\tbyteStream.set(payloadBytes, pos);\n\n\t\t\t\tbreak;\n\n//    \t    case MESSAGE_TYPE.PUBREC:\n//    \t    case MESSAGE_TYPE.PUBREL:\n//    \t    case MESSAGE_TYPE.PUBCOMP:\n//    \t    \tbreak;\n\n\t\t\tcase MESSAGE_TYPE.SUBSCRIBE:\n\t\t\t\t// SUBSCRIBE has a list of topic strings and request QoS\n\t\t\t\tfor (var i=0; i<this.topics.length; i++) {\n\t\t\t\t\tpos = writeString(this.topics[i], topicStrLength[i], byteStream, pos);\n\t\t\t\t\tbyteStream[pos++] = this.requestedQos[i];\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.UNSUBSCRIBE:\n\t\t\t\t// UNSUBSCRIBE has a list of topic strings\n\t\t\t\tfor (var i=0; i<this.topics.length; i++)\n\t\t\t\t\tpos = writeString(this.topics[i], topicStrLength[i], byteStream, pos);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// Do nothing.\n\t\t}\n\n\t\treturn buffer;\n\t};\n\n\tfunction decodeMessage(input,pos) {\n\t    var startingPos = pos;\n\t\tvar first = input[pos];\n\t\tvar type = first >> 4;\n\t\tvar messageInfo = first &= 0x0f;\n\t\tpos += 1;\n\n\n\t\t// Decode the remaining length (MBI format)\n\n\t\tvar digit;\n\t\tvar remLength = 0;\n\t\tvar multiplier = 1;\n\t\tdo {\n\t\t\tif (pos == input.length) {\n\t\t\t    return [null,startingPos];\n\t\t\t}\n\t\t\tdigit = input[pos++];\n\t\t\tremLength += ((digit & 0x7F) * multiplier);\n\t\t\tmultiplier *= 128;\n\t\t} while ((digit & 0x80) !== 0);\n\n\t\tvar endPos = pos+remLength;\n\t\tif (endPos > input.length) {\n\t\t    return [null,startingPos];\n\t\t}\n\n\t\tvar wireMessage = new WireMessage(type);\n\t\tswitch(type) {\n\t\t\tcase MESSAGE_TYPE.CONNACK:\n\t\t\t\tvar connectAcknowledgeFlags = input[pos++];\n\t\t\t\tif (connectAcknowledgeFlags & 0x01)\n\t\t\t\t\twireMessage.sessionPresent = true;\n\t\t\t\twireMessage.returnCode = input[pos++];\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tvar qos = (messageInfo >> 1) & 0x03;\n\n\t\t\t\tvar len = readUint16(input, pos);\n\t\t\t\tpos += 2;\n\t\t\t\tvar topicName = parseUTF8(input, pos, len);\n\t\t\t\tpos += len;\n\t\t\t\t// If QoS 1 or 2 there will be a messageIdentifier\n\t\t\t\tif (qos > 0) {\n\t\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\t\tpos += 2;\n\t\t\t\t}\n\n\t\t\t\tvar message = new Paho.MQTT.Message(input.subarray(pos, endPos));\n\t\t\t\tif ((messageInfo & 0x01) == 0x01)\n\t\t\t\t\tmessage.retained = true;\n\t\t\t\tif ((messageInfo & 0x08) == 0x08)\n\t\t\t\t\tmessage.duplicate =  true;\n\t\t\t\tmessage.qos = qos;\n\t\t\t\tmessage.destinationName = topicName;\n\t\t\t\twireMessage.payloadMessage = message;\n\t\t\t\tbreak;\n\n\t\t\tcase  MESSAGE_TYPE.PUBACK:\n\t\t\tcase  MESSAGE_TYPE.PUBREC:\n\t\t\tcase  MESSAGE_TYPE.PUBREL:\n\t\t\tcase  MESSAGE_TYPE.PUBCOMP:\n\t\t\tcase  MESSAGE_TYPE.UNSUBACK:\n\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\tbreak;\n\n\t\t\tcase  MESSAGE_TYPE.SUBACK:\n\t\t\t\twireMessage.messageIdentifier = readUint16(input, pos);\n\t\t\t\tpos += 2;\n\t\t\t\twireMessage.returnCode = input.subarray(pos, endPos);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn [wireMessage,endPos];\n\t}\n\n\tfunction writeUint16(input, buffer, offset) {\n\t\tbuffer[offset++] = input >> 8;      //MSB\n\t\tbuffer[offset++] = input % 256;     //LSB\n\t\treturn offset;\n\t}\n\n\tfunction writeString(input, utf8Length, buffer, offset) {\n\t\toffset = writeUint16(utf8Length, buffer, offset);\n\t\tstringToUTF8(input, buffer, offset);\n\t\treturn offset + utf8Length;\n\t}\n\n\tfunction readUint16(buffer, offset) {\n\t\treturn 256*buffer[offset] + buffer[offset+1];\n\t}\n\n\t/**\n\t * Encodes an MQTT Multi-Byte Integer\n\t * @private\n\t */\n\tfunction encodeMBI(number) {\n\t\tvar output = new Array(1);\n\t\tvar numBytes = 0;\n\n\t\tdo {\n\t\t\tvar digit = number % 128;\n\t\t\tnumber = number >> 7;\n\t\t\tif (number > 0) {\n\t\t\t\tdigit |= 0x80;\n\t\t\t}\n\t\t\toutput[numBytes++] = digit;\n\t\t} while ( (number > 0) && (numBytes<4) );\n\n\t\treturn output;\n\t}\n\n\t/**\n\t * Takes a String and calculates its length in bytes when encoded in UTF8.\n\t * @private\n\t */\n\tfunction UTF8Length(input) {\n\t\tvar output = 0;\n\t\tfor (var i = 0; i<input.length; i++)\n\t\t{\n\t\t\tvar charCode = input.charCodeAt(i);\n\t\t\t\tif (charCode > 0x7FF)\n\t\t\t\t   {\n\t\t\t\t\t  // Surrogate pair means its a 4 byte character\n\t\t\t\t\t  if (0xD800 <= charCode && charCode <= 0xDBFF)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t  i++;\n\t\t\t\t\t\t  output++;\n\t\t\t\t\t\t}\n\t\t\t\t   output +=3;\n\t\t\t\t   }\n\t\t\telse if (charCode > 0x7F)\n\t\t\t\toutput +=2;\n\t\t\telse\n\t\t\t\toutput++;\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Takes a String and writes it into an array as UTF8 encoded bytes.\n\t * @private\n\t */\n\tfunction stringToUTF8(input, output, start) {\n\t\tvar pos = start;\n\t\tfor (var i = 0; i<input.length; i++) {\n\t\t\tvar charCode = input.charCodeAt(i);\n\n\t\t\t// Check for a surrogate pair.\n\t\t\tif (0xD800 <= charCode && charCode <= 0xDBFF) {\n\t\t\t\tvar lowCharCode = input.charCodeAt(++i);\n\t\t\t\tif (isNaN(lowCharCode)) {\n\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UNICODE, [charCode, lowCharCode]));\n\t\t\t\t}\n\t\t\t\tcharCode = ((charCode - 0xD800)<<10) + (lowCharCode - 0xDC00) + 0x10000;\n\n\t\t\t}\n\n\t\t\tif (charCode <= 0x7F) {\n\t\t\t\toutput[pos++] = charCode;\n\t\t\t} else if (charCode <= 0x7FF) {\n\t\t\t\toutput[pos++] = charCode>>6  & 0x1F | 0xC0;\n\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t} else if (charCode <= 0xFFFF) {\n\t\t\t\toutput[pos++] = charCode>>12 & 0x0F | 0xE0;\n\t\t\t\toutput[pos++] = charCode>>6  & 0x3F | 0x80;\n\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t} else {\n\t\t\t\toutput[pos++] = charCode>>18 & 0x07 | 0xF0;\n\t\t\t\toutput[pos++] = charCode>>12 & 0x3F | 0x80;\n\t\t\t\toutput[pos++] = charCode>>6  & 0x3F | 0x80;\n\t\t\t\toutput[pos++] = charCode     & 0x3F | 0x80;\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\tfunction parseUTF8(input, offset, length) {\n\t\tvar output = \"\";\n\t\tvar utf16;\n\t\tvar pos = offset;\n\n\t\twhile (pos < offset+length)\n\t\t{\n\t\t\tvar byte1 = input[pos++];\n\t\t\tif (byte1 < 128)\n\t\t\t\tutf16 = byte1;\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar byte2 = input[pos++]-128;\n\t\t\t\tif (byte2 < 0)\n\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16),\"\"]));\n\t\t\t\tif (byte1 < 0xE0)             // 2 byte character\n\t\t\t\t\tutf16 = 64*(byte1-0xC0) + byte2;\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar byte3 = input[pos++]-128;\n\t\t\t\t\tif (byte3 < 0)\n\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16)]));\n\t\t\t\t\tif (byte1 < 0xF0)        // 3 byte character\n\t\t\t\t\t\tutf16 = 4096*(byte1-0xE0) + 64*byte2 + byte3;\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t   var byte4 = input[pos++]-128;\n\t\t\t\t\t\t\t\t   if (byte4 < 0)\n\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));\n\t\t\t\t\t\t\t\t   if (byte1 < 0xF8)        // 4 byte character\n\t\t\t\t\t\t\t\t\t\t   utf16 = 262144*(byte1-0xF0) + 4096*byte2 + 64*byte3 + byte4;\n\t\t\t\t\t   else                     // longer encodings are not supported\n\t\t\t\t\t\tthrow new Error(format(ERROR.MALFORMED_UTF, [byte1.toString(16), byte2.toString(16), byte3.toString(16), byte4.toString(16)]));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\tif (utf16 > 0xFFFF)   // 4 byte character - express as a surrogate pair\n\t\t\t\t  {\n\t\t\t\t\t utf16 -= 0x10000;\n\t\t\t\t\t output += String.fromCharCode(0xD800 + (utf16 >> 10)); // lead character\n\t\t\t\t\t utf16 = 0xDC00 + (utf16 & 0x3FF);  // trail character\n\t\t\t\t  }\n\t\t\toutput += String.fromCharCode(utf16);\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Repeat keepalive requests, monitor responses.\n\t * @ignore\n\t */\n\tvar Pinger = function(client, window, keepAliveInterval) {\n\t\tthis._client = client;\n\t\tthis._window = window;\n\t\tthis._keepAliveInterval = keepAliveInterval*1000;\n\t\tthis.isReset = false;\n\n\t\tvar pingReq = new WireMessage(MESSAGE_TYPE.PINGREQ).encode();\n\n\t\tvar doTimeout = function (pinger) {\n\t\t\treturn function () {\n\t\t\t\treturn doPing.apply(pinger);\n\t\t\t};\n\t\t};\n\n\t\t/** @ignore */\n\t\tvar doPing = function() {\n\t\t\tif (!this.isReset) {\n\t\t\t\tthis._client._trace(\"Pinger.doPing\", \"Timed out\");\n\t\t\t\tthis._client._disconnected( ERROR.PING_TIMEOUT.code , format(ERROR.PING_TIMEOUT));\n\t\t\t} else {\n\t\t\t\tthis.isReset = false;\n\t\t\t\tthis._client._trace(\"Pinger.doPing\", \"send PINGREQ\");\n\t\t\t\tthis._client.socket.send(pingReq);\n\t\t\t\tthis.timeout = this._window.setTimeout(doTimeout(this), this._keepAliveInterval);\n\t\t\t}\n\t\t};\n\n\t\tthis.reset = function() {\n\t\t\tthis.isReset = true;\n\t\t\tthis._window.clearTimeout(this.timeout);\n\t\t\tif (this._keepAliveInterval > 0)\n\t\t\t\tthis.timeout = setTimeout(doTimeout(this), this._keepAliveInterval);\n\t\t};\n\n\t\tthis.cancel = function() {\n\t\t\tthis._window.clearTimeout(this.timeout);\n\t\t};\n\t };\n\n\t/**\n\t * Monitor request completion.\n\t * @ignore\n\t */\n\tvar Timeout = function(client, window, timeoutSeconds, action, args) {\n\t\tthis._window = window;\n\t\tif (!timeoutSeconds)\n\t\t\ttimeoutSeconds = 30;\n\n\t\tvar doTimeout = function (action, client, args) {\n\t\t\treturn function () {\n\t\t\t\treturn action.apply(client, args);\n\t\t\t};\n\t\t};\n\t\tthis.timeout = setTimeout(doTimeout(action, client, args), timeoutSeconds * 1000);\n\n\t\tthis.cancel = function() {\n\t\t\tthis._window.clearTimeout(this.timeout);\n\t\t};\n\t};\n\n\t/*\n\t * Internal implementation of the Websockets MQTT V3.1 client.\n\t *\n\t * @name Paho.MQTT.ClientImpl @constructor\n\t * @param {String} host the DNS nameof the webSocket host.\n\t * @param {Number} port the port number for that host.\n\t * @param {String} clientId the MQ client identifier.\n\t */\n\tvar ClientImpl = function (uri, host, port, path, clientId) {\n\t\t// Check dependencies are satisfied in this browser.\n\t\tif (!(\"WebSocket\" in global && global.WebSocket !== null)) {\n\t\t\tthrow new Error(format(ERROR.UNSUPPORTED, [\"WebSocket\"]));\n\t\t}\n\t\tif (!(\"localStorage\" in global && global.localStorage !== null)) {\n\t\t\tthrow new Error(format(ERROR.UNSUPPORTED, [\"localStorage\"]));\n\t\t}\n\t\tif (!(\"ArrayBuffer\" in global && global.ArrayBuffer !== null)) {\n\t\t\tthrow new Error(format(ERROR.UNSUPPORTED, [\"ArrayBuffer\"]));\n\t\t}\n\t\tthis._trace(\"Paho.MQTT.Client\", uri, host, port, path, clientId);\n\n\t\tthis.host = host;\n\t\tthis.port = port;\n\t\tthis.path = path;\n\t\tthis.uri = uri;\n\t\tthis.clientId = clientId;\n\t\tthis._wsuri = null;\n\n\t\t// Local storagekeys are qualified with the following string.\n\t\t// The conditional inclusion of path in the key is for backward\n\t\t// compatibility to when the path was not configurable and assumed to\n\t\t// be /mqtt\n\t\tthis._localKey=host+\":\"+port+(path!=\"/mqtt\"?\":\"+path:\"\")+\":\"+clientId+\":\";\n\n\t\t// Create private instance-only message queue\n\t\t// Internal queue of messages to be sent, in sending order.\n\t\tthis._msg_queue = [];\n\t\tthis._buffered_msg_queue = [];\n\n\t\t// Messages we have sent and are expecting a response for, indexed by their respective message ids.\n\t\tthis._sentMessages = {};\n\n\t\t// Messages we have received and acknowleged and are expecting a confirm message for\n\t\t// indexed by their respective message ids.\n\t\tthis._receivedMessages = {};\n\n\t\t// Internal list of callbacks to be executed when messages\n\t\t// have been successfully sent over web socket, e.g. disconnect\n\t\t// when it doesn't have to wait for ACK, just message is dispatched.\n\t\tthis._notify_msg_sent = {};\n\n\t\t// Unique identifier for SEND messages, incrementing\n\t\t// counter as messages are sent.\n\t\tthis._message_identifier = 1;\n\n\t\t// Used to determine the transmission sequence of stored sent messages.\n\t\tthis._sequence = 0;\n\n\n\t\t// Load the local state, if any, from the saved version, only restore state relevant to this client.\n\t\tfor (var key in localStorage)\n\t\t\tif (   key.indexOf(\"Sent:\"+this._localKey) === 0 || key.indexOf(\"Received:\"+this._localKey) === 0)\n\t\t\tthis.restore(key);\n\t};\n\n\t// Messaging Client public instance members.\n\tClientImpl.prototype.host = null;\n\tClientImpl.prototype.port = null;\n\tClientImpl.prototype.path = null;\n\tClientImpl.prototype.uri = null;\n\tClientImpl.prototype.clientId = null;\n\n\t// Messaging Client private instance members.\n\tClientImpl.prototype.socket = null;\n\t/* true once we have received an acknowledgement to a CONNECT packet. */\n\tClientImpl.prototype.connected = false;\n\t/* The largest message identifier allowed, may not be larger than 2**16 but\n\t * if set smaller reduces the maximum number of outbound messages allowed.\n\t */\n\tClientImpl.prototype.maxMessageIdentifier = 65536;\n\tClientImpl.prototype.connectOptions = null;\n\tClientImpl.prototype.hostIndex = null;\n\tClientImpl.prototype.onConnected = null;\n\tClientImpl.prototype.onConnectionLost = null;\n\tClientImpl.prototype.onMessageDelivered = null;\n\tClientImpl.prototype.onMessageArrived = null;\n\tClientImpl.prototype.traceFunction = null;\n\tClientImpl.prototype._msg_queue = null;\n\tClientImpl.prototype._buffered_msg_queue = null;\n\tClientImpl.prototype._connectTimeout = null;\n\t/* The sendPinger monitors how long we allow before we send data to prove to the server that we are alive. */\n\tClientImpl.prototype.sendPinger = null;\n\t/* The receivePinger monitors how long we allow before we require evidence that the server is alive. */\n\tClientImpl.prototype.receivePinger = null;\n\tClientImpl.prototype._reconnectInterval = 1; // Reconnect Delay, starts at 1 second\n\tClientImpl.prototype._reconnecting = false;\n\tClientImpl.prototype._reconnectTimeout = null;\n\tClientImpl.prototype.disconnectedPublishing = false;\n\tClientImpl.prototype.disconnectedBufferSize = 5000;\n\n\tClientImpl.prototype.receiveBuffer = null;\n\n\tClientImpl.prototype._traceBuffer = null;\n\tClientImpl.prototype._MAX_TRACE_ENTRIES = 100;\n\n\tClientImpl.prototype.connect = function (connectOptions) {\n\t\tvar connectOptionsMasked = this._traceMask(connectOptions, \"password\");\n\t\tthis._trace(\"Client.connect\", connectOptionsMasked, this.socket, this.connected);\n\n\t\tif (this.connected)\n\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"already connected\"]));\n\t\tif (this.socket)\n\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"already connected\"]));\n\n\t\tif (this._reconnecting) {\n\t\t\t// connect() function is called while reconnect is in progress.\n\t\t\t// Terminate the auto reconnect process to use new connect options.\n\t\t\tthis._reconnectTimeout.cancel();\n\t\t\tthis._reconnectTimeout = null;\n\t\t\tthis._reconnecting = false;\n\t\t}\n\n\t\tthis.connectOptions = connectOptions;\n\t\tthis._reconnectInterval = 1;\n\t\tthis._reconnecting = false;\n\t\tif (connectOptions.uris) {\n\t\t\tthis.hostIndex = 0;\n\t\t\tthis._doConnect(connectOptions.uris[0]);\n\t\t} else {\n\t\t\tthis._doConnect(this.uri);\n\t\t}\n\n\t};\n\n\tClientImpl.prototype.subscribe = function (filter, subscribeOptions) {\n\t\tthis._trace(\"Client.subscribe\", filter, subscribeOptions);\n\n\t\tif (!this.connected)\n\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\n\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.SUBSCRIBE);\n\t\twireMessage.topics=[filter];\n\t\tif (subscribeOptions.qos !== undefined)\n\t\t\twireMessage.requestedQos = [subscribeOptions.qos];\n\t\telse\n\t\t\twireMessage.requestedQos = [0];\n\n\t\tif (subscribeOptions.onSuccess) {\n\t\t\twireMessage.onSuccess = function(grantedQos) {subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext,grantedQos:grantedQos});};\n\t\t}\n\n\t\tif (subscribeOptions.onFailure) {\n\t\t\twireMessage.onFailure = function(errorCode) {subscribeOptions.onFailure({invocationContext:subscribeOptions.invocationContext,errorCode:errorCode, errorMessage:format(errorCode)});};\n\t\t}\n\n\t\tif (subscribeOptions.timeout) {\n\t\t\twireMessage.timeOut = new Timeout(this, window, subscribeOptions.timeout, subscribeOptions.onFailure,\n\t\t\t\t\t\t[{invocationContext:subscribeOptions.invocationContext,\n\t\t\t\t\t\terrorCode:ERROR.SUBSCRIBE_TIMEOUT.code,\n\t\t\t\t\t\terrorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}]);\n\t\t}\n\n\t\t// All subscriptions return a SUBACK.\n\t\tthis._requires_ack(wireMessage);\n\t\tthis._schedule_message(wireMessage);\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype.unsubscribe = function(filter, unsubscribeOptions) {\n\t\tthis._trace(\"Client.unsubscribe\", filter, unsubscribeOptions);\n\n\t\tif (!this.connected)\n\t\t   throw new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\n\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);\n\t\twireMessage.topics = [filter];\n\n\t\tif (unsubscribeOptions.onSuccess) {\n\t\t\twireMessage.callback = function() {unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext});};\n\t\t}\n\t\tif (unsubscribeOptions.timeout) {\n\t\t\twireMessage.timeOut = new Timeout(this, window, unsubscribeOptions.timeout, unsubscribeOptions.onFailure,\n\t\t\t\t\t  [{invocationContext:unsubscribeOptions.invocationContext,\n\t\t\t\t\t\terrorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,\n\t\t\t\t\t\terrorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}]);\n\t\t}\n\n\t\t// All unsubscribes return a SUBACK.\n\t\tthis._requires_ack(wireMessage);\n\t\tthis._schedule_message(wireMessage);\n\t};\n\n\tClientImpl.prototype.send = function (message) {\n\t\tthis._trace(\"Client.send\", message);\n\n\t\twireMessage = new WireMessage(MESSAGE_TYPE.PUBLISH);\n\t\twireMessage.payloadMessage = message;\n\n\t\tif (this.connected) {\n\t\t\t// Mark qos 1 & 2 message as \"ACK required\"\n\t\t\t// For qos 0 message, invoke onMessageDelivered callback if there is one.\n\t\t\t// Then schedule the message.\n\t\t\tif (message.qos > 0) {\n\t\t\tthis._requires_ack(wireMessage);\n\t\t\t} else if (this.onMessageDelivered) {\n\t\t\tthis._notify_msg_sent[wireMessage] = this.onMessageDelivered(wireMessage.payloadMessage);\n\t\t\t}\n\t\tthis._schedule_message(wireMessage);\n\t\t} else {\n\t\t\t// Currently disconnected, will not schedule this message\n\t\t\t// Check if reconnecting is in progress and disconnected publish is enabled.\n\t\t\tif (this._reconnecting && this.disconnectedPublishing) {\n\t\t\t\t// Check the limit which include the \"required ACK\" messages\n\t\t\t\tvar messageCount = Object.keys(this._sentMessages).length + this._buffered_msg_queue.length;\n\t\t\t\tif (messageCount > this.disconnectedBufferSize) {\n\t\t\t\t\tthrow new Error(format(ERROR.BUFFER_FULL, [this.disconnectedBufferSize]));\n\t\t\t\t} else {\n\t\t\t\t\tif (message.qos > 0) {\n\t\t\t\t\t\t// Mark this message as \"ACK required\"\n\t\t\t\t\t\tthis._requires_ack(wireMessage);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twireMessage.sequence = ++this._sequence;\n\t\t\t\t\t\tthis._buffered_msg_queue.push(wireMessage);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connected\"]));\n\t\t\t}\n\t\t}\n\t};\n\n\tClientImpl.prototype.disconnect = function () {\n\t\tthis._trace(\"Client.disconnect\");\n\n\t\tif (this._reconnecting) {\n\t\t\t// disconnect() function is called while reconnect is in progress.\n\t\t\t// Terminate the auto reconnect process.\n\t\t\tthis._reconnectTimeout.cancel();\n\t\t\tthis._reconnectTimeout = null;\n\t\t\tthis._reconnecting = false;\n\t\t}\n\n\t\tif (!this.socket)\n\t\t\tthrow new Error(format(ERROR.INVALID_STATE, [\"not connecting or connected\"]));\n\n\t\twireMessage = new WireMessage(MESSAGE_TYPE.DISCONNECT);\n\n\t\t// Run the disconnected call back as soon as the message has been sent,\n\t\t// in case of a failure later on in the disconnect processing.\n\t\t// as a consequence, the _disconected call back may be run several times.\n\t\tthis._notify_msg_sent[wireMessage] = scope(this._disconnected, this);\n\n\t\tthis._schedule_message(wireMessage);\n\t};\n\n\tClientImpl.prototype.getTraceLog = function () {\n\t\tif ( this._traceBuffer !== null ) {\n\t\t\tthis._trace(\"Client.getTraceLog\", new Date());\n\t\t\tthis._trace(\"Client.getTraceLog in flight messages\", this._sentMessages.length);\n\t\t\tfor (var key in this._sentMessages)\n\t\t\t\tthis._trace(\"_sentMessages \",key, this._sentMessages[key]);\n\t\t\tfor (var key in this._receivedMessages)\n\t\t\t\tthis._trace(\"_receivedMessages \",key, this._receivedMessages[key]);\n\n\t\t\treturn this._traceBuffer;\n\t\t}\n\t};\n\n\tClientImpl.prototype.startTrace = function () {\n\t\tif ( this._traceBuffer === null ) {\n\t\t\tthis._traceBuffer = [];\n\t\t}\n\t\tthis._trace(\"Client.startTrace\", new Date(), version);\n\t};\n\n\tClientImpl.prototype.stopTrace = function () {\n\t\tdelete this._traceBuffer;\n\t};\n\n\tClientImpl.prototype._doConnect = function (wsurl) {\n\t\t// When the socket is open, this client will send the CONNECT WireMessage using the saved parameters.\n\t\tif (this.connectOptions.useSSL) {\n\t\t    var uriParts = wsurl.split(\":\");\n\t\t    uriParts[0] = \"wss\";\n\t\t    wsurl = uriParts.join(\":\");\n\t\t}\n\t\tthis._wsuri = wsurl;\n\t\tthis.connected = false;\n\n\n\n\t\tif (this.connectOptions.mqttVersion < 4) {\n\t\t\tthis.socket = new WebSocket(wsurl, [\"mqttv3.1\"]);\n\t\t} else {\n\t\t\tthis.socket = new WebSocket(wsurl, [\"mqtt\"]);\n\t\t}\n\t\tthis.socket.binaryType = 'arraybuffer';\n\t\tthis.socket.onopen = scope(this._on_socket_open, this);\n\t\tthis.socket.onmessage = scope(this._on_socket_message, this);\n\t\tthis.socket.onerror = scope(this._on_socket_error, this);\n\t\tthis.socket.onclose = scope(this._on_socket_close, this);\n\n\t\tthis.sendPinger = new Pinger(this, window, this.connectOptions.keepAliveInterval);\n\t\tthis.receivePinger = new Pinger(this, window, this.connectOptions.keepAliveInterval);\n\t\tif (this._connectTimeout) {\n\t\t\tthis._connectTimeout.cancel();\n\t\t\tthis._connectTimeout = null;\n\t\t}\n\t\tthis._connectTimeout = new Timeout(this, window, this.connectOptions.timeout, this._disconnected,  [ERROR.CONNECT_TIMEOUT.code, format(ERROR.CONNECT_TIMEOUT)]);\n\t};\n\n\n\t// Schedule a new message to be sent over the WebSockets\n\t// connection. CONNECT messages cause WebSocket connection\n\t// to be started. All other messages are queued internally\n\t// until this has happened. When WS connection starts, process\n\t// all outstanding messages.\n\tClientImpl.prototype._schedule_message = function (message) {\n\t\tthis._msg_queue.push(message);\n\t\t// Process outstanding messages in the queue if we have an  open socket, and have received CONNACK.\n\t\tif (this.connected) {\n\t\t\tthis._process_queue();\n\t\t}\n\t};\n\n\tClientImpl.prototype.store = function(prefix, wireMessage) {\n\t\tvar storedMessage = {type:wireMessage.type, messageIdentifier:wireMessage.messageIdentifier, version:1};\n\n\t\tswitch(wireMessage.type) {\n\t\t  case MESSAGE_TYPE.PUBLISH:\n\t\t\t  if(wireMessage.pubRecReceived)\n\t\t\t\t  storedMessage.pubRecReceived = true;\n\n\t\t\t  // Convert the payload to a hex string.\n\t\t\t  storedMessage.payloadMessage = {};\n\t\t\t  var hex = \"\";\n\t\t\t  var messageBytes = wireMessage.payloadMessage.payloadBytes;\n\t\t\t  for (var i=0; i<messageBytes.length; i++) {\n\t\t\t\tif (messageBytes[i] <= 0xF)\n\t\t\t\t  hex = hex+\"0\"+messageBytes[i].toString(16);\n\t\t\t\telse\n\t\t\t\t  hex = hex+messageBytes[i].toString(16);\n\t\t\t  }\n\t\t\t  storedMessage.payloadMessage.payloadHex = hex;\n\n\t\t\t  storedMessage.payloadMessage.qos = wireMessage.payloadMessage.qos;\n\t\t\t  storedMessage.payloadMessage.destinationName = wireMessage.payloadMessage.destinationName;\n\t\t\t  if (wireMessage.payloadMessage.duplicate)\n\t\t\t\t  storedMessage.payloadMessage.duplicate = true;\n\t\t\t  if (wireMessage.payloadMessage.retained)\n\t\t\t\t  storedMessage.payloadMessage.retained = true;\n\n\t\t\t  // Add a sequence number to sent messages.\n\t\t\t  if ( prefix.indexOf(\"Sent:\") === 0 ) {\n\t\t\t\t  if ( wireMessage.sequence === undefined )\n\t\t\t\t\t  wireMessage.sequence = ++this._sequence;\n\t\t\t\t  storedMessage.sequence = wireMessage.sequence;\n\t\t\t  }\n\t\t\t  break;\n\n\t\t\tdefault:\n\t\t\t\tthrow Error(format(ERROR.INVALID_STORED_DATA, [key, storedMessage]));\n\t\t}\n\t\tlocalStorage.setItem(prefix+this._localKey+wireMessage.messageIdentifier, JSON.stringify(storedMessage));\n\t};\n\n\tClientImpl.prototype.restore = function(key) {\n\t\tvar value = localStorage.getItem(key);\n\t\tvar storedMessage = JSON.parse(value);\n\n\t\tvar wireMessage = new WireMessage(storedMessage.type, storedMessage);\n\n\t\tswitch(storedMessage.type) {\n\t\t  case MESSAGE_TYPE.PUBLISH:\n\t\t\t  // Replace the payload message with a Message object.\n\t\t\t  var hex = storedMessage.payloadMessage.payloadHex;\n\t\t\t  var buffer = new ArrayBuffer((hex.length)/2);\n\t\t\t  var byteStream = new Uint8Array(buffer);\n\t\t\t  var i = 0;\n\t\t\t  while (hex.length >= 2) {\n\t\t\t\t  var x = parseInt(hex.substring(0, 2), 16);\n\t\t\t\t  hex = hex.substring(2, hex.length);\n\t\t\t\t  byteStream[i++] = x;\n\t\t\t  }\n\t\t\t  var payloadMessage = new Paho.MQTT.Message(byteStream);\n\n\t\t\t  payloadMessage.qos = storedMessage.payloadMessage.qos;\n\t\t\t  payloadMessage.destinationName = storedMessage.payloadMessage.destinationName;\n\t\t\t  if (storedMessage.payloadMessage.duplicate)\n\t\t\t\t  payloadMessage.duplicate = true;\n\t\t\t  if (storedMessage.payloadMessage.retained)\n\t\t\t\t  payloadMessage.retained = true;\n\t\t\t  wireMessage.payloadMessage = payloadMessage;\n\n\t\t\t  break;\n\n\t\t\tdefault:\n\t\t\t  throw Error(format(ERROR.INVALID_STORED_DATA, [key, value]));\n\t\t}\n\n\t\tif (key.indexOf(\"Sent:\"+this._localKey) === 0) {\n\t\t\twireMessage.payloadMessage.duplicate = true;\n\t\t\tthis._sentMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t} else if (key.indexOf(\"Received:\"+this._localKey) === 0) {\n\t\t\tthis._receivedMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t}\n\t};\n\n\tClientImpl.prototype._process_queue = function () {\n\t\tvar message = null;\n\t\t// Process messages in order they were added\n\t\tvar fifo = this._msg_queue.reverse();\n\n\t\t// Send all queued messages down socket connection\n\t\twhile ((message = fifo.pop())) {\n\t\t\tthis._socket_send(message);\n\t\t\t// Notify listeners that message was successfully sent\n\t\t\tif (this._notify_msg_sent[message]) {\n\t\t\t\tthis._notify_msg_sent[message]();\n\t\t\t\tdelete this._notify_msg_sent[message];\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Expect an ACK response for this message. Add message to the set of in progress\n\t * messages and set an unused identifier in this message.\n\t * @ignore\n\t */\n\tClientImpl.prototype._requires_ack = function (wireMessage) {\n\t\tvar messageCount = Object.keys(this._sentMessages).length;\n\t\tif (messageCount > this.maxMessageIdentifier)\n\t\t\tthrow Error (\"Too many messages:\"+messageCount);\n\n\t\twhile(this._sentMessages[this._message_identifier] !== undefined) {\n\t\t\tthis._message_identifier++;\n\t\t}\n\t\twireMessage.messageIdentifier = this._message_identifier;\n\t\tthis._sentMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\tif (wireMessage.type === MESSAGE_TYPE.PUBLISH) {\n\t\t\tthis.store(\"Sent:\", wireMessage);\n\t\t}\n\t\tif (this._message_identifier === this.maxMessageIdentifier) {\n\t\t\tthis._message_identifier = 1;\n\t\t}\n\t};\n\n\t/**\n\t * Called when the underlying websocket has been opened.\n\t * @ignore\n\t */\n\tClientImpl.prototype._on_socket_open = function () {\n\t\t// Create the CONNECT message object.\n\t\tvar wireMessage = new WireMessage(MESSAGE_TYPE.CONNECT, this.connectOptions);\n\t\twireMessage.clientId = this.clientId;\n\t\tthis._socket_send(wireMessage);\n\t};\n\n\t/**\n\t * Called when the underlying websocket has received a complete packet.\n\t * @ignore\n\t */\n\tClientImpl.prototype._on_socket_message = function (event) {\n\t\tthis._trace(\"Client._on_socket_message\", event.data);\n\t\tvar messages = this._deframeMessages(event.data);\n\t\tfor (var i = 0; i < messages.length; i+=1) {\n\t\t    this._handleMessage(messages[i]);\n\t\t}\n\t};\n\n\tClientImpl.prototype._deframeMessages = function(data) {\n\t\tvar byteArray = new Uint8Array(data);\n\t\tvar messages = [];\n\t    if (this.receiveBuffer) {\n\t        var newData = new Uint8Array(this.receiveBuffer.length+byteArray.length);\n\t        newData.set(this.receiveBuffer);\n\t        newData.set(byteArray,this.receiveBuffer.length);\n\t        byteArray = newData;\n\t        delete this.receiveBuffer;\n\t    }\n\t\ttry {\n\t\t    var offset = 0;\n\t\t    while(offset < byteArray.length) {\n\t\t        var result = decodeMessage(byteArray,offset);\n\t\t        var wireMessage = result[0];\n\t\t        offset = result[1];\n\t\t        if (wireMessage !== null) {\n\t\t            messages.push(wireMessage);\n\t\t        } else {\n\t\t            break;\n\t\t        }\n\t\t    }\n\t\t    if (offset < byteArray.length) {\n\t\t    \tthis.receiveBuffer = byteArray.subarray(offset);\n\t\t    }\n\t\t} catch (error) {\n\t\t\tvar errorStack = ((error.hasOwnProperty('stack') == 'undefined') ? error.stack.toString() : \"No Error Stack Available\");\n\t\t\tthis._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));\n\t\t\treturn;\n\t\t}\n\t\treturn messages;\n\t};\n\n\tClientImpl.prototype._handleMessage = function(wireMessage) {\n\n\t\tthis._trace(\"Client._handleMessage\", wireMessage);\n\n\t\ttry {\n\t\t\tswitch(wireMessage.type) {\n\t\t\tcase MESSAGE_TYPE.CONNACK:\n\t\t\t\tthis._connectTimeout.cancel();\n\t\t\t\tif (this._reconnectTimeout)\n\t\t\t\t\tthis._reconnectTimeout.cancel();\n\n\t\t\t\t// If we have started using clean session then clear up the local state.\n\t\t\t\tif (this.connectOptions.cleanSession) {\n\t\t\t\t\tfor (var key in this._sentMessages) {\n\t\t\t\t\t\tvar sentMessage = this._sentMessages[key];\n\t\t\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+sentMessage.messageIdentifier);\n\t\t\t\t\t}\n\t\t\t\t\tthis._sentMessages = {};\n\n\t\t\t\t\tfor (var key in this._receivedMessages) {\n\t\t\t\t\t\tvar receivedMessage = this._receivedMessages[key];\n\t\t\t\t\t\tlocalStorage.removeItem(\"Received:\"+this._localKey+receivedMessage.messageIdentifier);\n\t\t\t\t\t}\n\t\t\t\t\tthis._receivedMessages = {};\n\t\t\t\t}\n\t\t\t\t// Client connected and ready for business.\n\t\t\t\tif (wireMessage.returnCode === 0) {\n\n\t\t\t\t\tthis.connected = true;\n\t\t\t\t\t// Jump to the end of the list of uris and stop looking for a good host.\n\n\t\t\t\t\tif (this.connectOptions.uris)\n            this.hostIndex = this.connectOptions.uris.length;\n\n\t\t\t\t} else {\n\t\t\t\t\tthis._disconnected(ERROR.CONNACK_RETURNCODE.code , format(ERROR.CONNACK_RETURNCODE, [wireMessage.returnCode, CONNACK_RC[wireMessage.returnCode]]));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Resend messages.\n\t\t\t\tvar sequencedMessages = [];\n\t\t\t\tfor (var msgId in this._sentMessages) {\n\t\t\t\t\tif (this._sentMessages.hasOwnProperty(msgId))\n\t\t\t\t\t\tsequencedMessages.push(this._sentMessages[msgId]);\n\t\t\t\t}\n\n\t\t\t\t// Also schedule qos 0 buffered messages if any\n\t\t\t\tif (this._buffered_msg_queue.length > 0) {\n\t\t\t\t\tvar msg = null;\n\t\t\t\t\tvar fifo = this._buffered_msg_queue.reverse();\n\t\t\t\t\twhile ((msg = fifo.pop())) {\n\t\t\t\t\t\tsequencedMessages.push(msg);\n\t\t\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\t\t\tthis._notify_msg_sent[msg] = this.onMessageDelivered(msg.payloadMessage);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Sort sentMessages into the original sent order.\n\t\t\t\tvar sequencedMessages = sequencedMessages.sort(function(a,b) {return a.sequence - b.sequence;} );\n\t\t\t\tfor (var i=0, len=sequencedMessages.length; i<len; i++) {\n\t\t\t\t\tvar sentMessage = sequencedMessages[i];\n\t\t\t\t\tif (sentMessage.type == MESSAGE_TYPE.PUBLISH && sentMessage.pubRecReceived) {\n\t\t\t\t\t\tvar pubRelMessage = new WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:sentMessage.messageIdentifier});\n\t\t\t\t\t\tthis._schedule_message(pubRelMessage);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._schedule_message(sentMessage);\n\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Execute the connectOptions.onSuccess callback if there is one.\n        // Will also now return if this connection was the result of an automatic\n        // reconnect and which URI was successfully connected to.\n\t\t\t\tif (this.connectOptions.onSuccess) {\n\t\t\t\t\tthis.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});\n\t\t\t\t}\n\n\t\t\t\tvar reconnected = false;\n\t\t\t\tif (this._reconnecting) {\n\t\t\t\t\treconnected = true;\n\t\t\t\t\tthis._reconnectInterval = 1;\n\t\t\t\t\tthis._reconnecting = false;\n\t\t\t\t}\n\n\t\t\t\t// Execute the onConnected callback if there is one.\n\t\t\t\tthis._connected(reconnected, this._wsuri);\n\n\t\t\t\t// Process all queued messages now that the connection is established.\n\t\t\t\tthis._process_queue();\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBLISH:\n\t\t\t\tthis._receivePublish(wireMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBACK:\n\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t // If this is a re flow of a PUBACK after we have restarted receivedMessage will not exist.\n\t\t\t\tif (sentMessage) {\n\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\t\tthis.onMessageDelivered(sentMessage.payloadMessage);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBREC:\n\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t// If this is a re flow of a PUBREC after we have restarted receivedMessage will not exist.\n\t\t\t\tif (sentMessage) {\n\t\t\t\t\tsentMessage.pubRecReceived = true;\n\t\t\t\t\tvar pubRelMessage = new WireMessage(MESSAGE_TYPE.PUBREL, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\t\tthis.store(\"Sent:\", sentMessage);\n\t\t\t\t\tthis._schedule_message(pubRelMessage);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBREL:\n\t\t\t\tvar receivedMessage = this._receivedMessages[wireMessage.messageIdentifier];\n\t\t\t\tlocalStorage.removeItem(\"Received:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\t// If this is a re flow of a PUBREL after we have restarted receivedMessage will not exist.\n\t\t\t\tif (receivedMessage) {\n\t\t\t\t\tthis._receiveMessage(receivedMessage);\n\t\t\t\t\tdelete this._receivedMessages[wireMessage.messageIdentifier];\n\t\t\t\t}\n\t\t\t\t// Always flow PubComp, we may have previously flowed PubComp but the server lost it and restarted.\n\t\t\t\tvar pubCompMessage = new WireMessage(MESSAGE_TYPE.PUBCOMP, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\tthis._schedule_message(pubCompMessage);\n\n\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PUBCOMP:\n\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\tlocalStorage.removeItem(\"Sent:\"+this._localKey+wireMessage.messageIdentifier);\n\t\t\t\tif (this.onMessageDelivered)\n\t\t\t\t\tthis.onMessageDelivered(sentMessage.payloadMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.SUBACK:\n\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\tif (sentMessage) {\n\t\t\t\t\tif(sentMessage.timeOut)\n\t\t\t\t\t\tsentMessage.timeOut.cancel();\n\t\t\t\t\t// This will need to be fixed when we add multiple topic support\n          \t\t\tif (wireMessage.returnCode[0] === 0x80) {\n\t\t\t\t\t\tif (sentMessage.onFailure) {\n\t\t\t\t\t\t\tsentMessage.onFailure(wireMessage.returnCode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (sentMessage.onSuccess) {\n\t\t\t\t\t\tsentMessage.onSuccess(wireMessage.returnCode);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.UNSUBACK:\n\t\t\t\tvar sentMessage = this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\tif (sentMessage) {\n\t\t\t\t\tif (sentMessage.timeOut)\n\t\t\t\t\t\tsentMessage.timeOut.cancel();\n\t\t\t\t\tif (sentMessage.callback) {\n\t\t\t\t\t\tsentMessage.callback();\n\t\t\t\t\t}\n\t\t\t\t\tdelete this._sentMessages[wireMessage.messageIdentifier];\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.PINGRESP:\n\t\t\t\t/* The sendPinger or receivePinger may have sent a ping, the receivePinger has already been reset. */\n\t\t\t\tthis.sendPinger.reset();\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_TYPE.DISCONNECT:\n\t\t\t\t// Clients do not expect to receive disconnect packets.\n\t\t\t\tthis._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code , format(ERROR.INVALID_MQTT_MESSAGE_TYPE, [wireMessage.type]));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tvar errorStack = ((error.hasOwnProperty('stack') == 'undefined') ? error.stack.toString() : \"No Error Stack Available\");\n\t\t\tthis._disconnected(ERROR.INTERNAL_ERROR.code , format(ERROR.INTERNAL_ERROR, [error.message,errorStack]));\n\t\t\treturn;\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._on_socket_error = function (error) {\n\t\tif (!this._reconnecting) {\n\t\tthis._disconnected(ERROR.SOCKET_ERROR.code , format(ERROR.SOCKET_ERROR, [error.data]));\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._on_socket_close = function () {\n\t\tif (!this._reconnecting) {\n\t\tthis._disconnected(ERROR.SOCKET_CLOSE.code , format(ERROR.SOCKET_CLOSE));\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._socket_send = function (wireMessage) {\n\n\t\tif (wireMessage.type == 1) {\n\t\t\tvar wireMessageMasked = this._traceMask(wireMessage, \"password\");\n\t\t\tthis._trace(\"Client._socket_send\", wireMessageMasked);\n\t\t}\n\t\telse this._trace(\"Client._socket_send\", wireMessage);\n\n\t\tthis.socket.send(wireMessage.encode());\n\t\t/* We have proved to the server we are alive. */\n\t\tthis.sendPinger.reset();\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._receivePublish = function (wireMessage) {\n\t\tswitch(wireMessage.payloadMessage.qos) {\n\t\t\tcase \"undefined\":\n\t\t\tcase 0:\n\t\t\t\tthis._receiveMessage(wireMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\tvar pubAckMessage = new WireMessage(MESSAGE_TYPE.PUBACK, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\tthis._schedule_message(pubAckMessage);\n\t\t\t\tthis._receiveMessage(wireMessage);\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\tthis._receivedMessages[wireMessage.messageIdentifier] = wireMessage;\n\t\t\t\tthis.store(\"Received:\", wireMessage);\n\t\t\t\tvar pubRecMessage = new WireMessage(MESSAGE_TYPE.PUBREC, {messageIdentifier:wireMessage.messageIdentifier});\n\t\t\t\tthis._schedule_message(pubRecMessage);\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow Error(\"Invaild qos=\"+wireMmessage.payloadMessage.qos);\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._receiveMessage = function (wireMessage) {\n\t\tif (this.onMessageArrived) {\n\t\t\tthis.onMessageArrived(wireMessage.payloadMessage);\n\t\t}\n\t};\n\n\t/**\n\t * Client has connected.\n\t * @param {reconnect} [boolean] indicate if this was a result of reconnect operation.\n\t * @param {uri} [string] fully qualified WebSocket URI of the server.\n\t */\n\tClientImpl.prototype._connected = function (reconnect, uri) {\n\t\t// Execute the onConnected callback if there is one.\n\t\tif (this.onConnected)\n\t\t\tthis.onConnected(reconnect, uri);\n\t};\n\n\t/**\n\t * Attempts to reconnect the client to the server.\n   * For each reconnect attempt, will double the reconnect interval\n   * up to 128 seconds.\n\t */\n\tClientImpl.prototype._reconnect = function () {\n\t\tthis._trace(\"Client._reconnect\");\n\t\tif (!this.connected) {\n\t\t\tthis._reconnecting = true;\n\t\t\tthis.sendPinger.cancel();\n\t\t\tthis.receivePinger.cancel();\n\t\t\tif (this._reconnectInterval < 128)\n\t\t\t\tthis._reconnectInterval = this._reconnectInterval * 2;\n\t\t\tif (this.connectOptions.uris) {\n\t\t\t\tthis.hostIndex = 0;\n\t\t\t\tthis._doConnect(this.connectOptions.uris[0]);\n\t\t\t} else {\n\t\t\t\tthis._doConnect(this.uri);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Client has disconnected either at its own request or because the server\n\t * or network disconnected it. Remove all non-durable state.\n\t * @param {errorCode} [number] the error number.\n\t * @param {errorText} [string] the error text.\n\t * @ignore\n\t */\n\tClientImpl.prototype._disconnected = function (errorCode, errorText) {\n\t\tthis._trace(\"Client._disconnected\", errorCode, errorText);\n\n\t\tif (errorCode !== undefined && this._reconnecting) {\n      //Continue automatic reconnect process\n  \t\tthis._reconnectTimeout = new Timeout(this, window, this._reconnectInterval, this._reconnect);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.sendPinger.cancel();\n\t\tthis.receivePinger.cancel();\n\t\tif (this._connectTimeout) {\n\t\t\tthis._connectTimeout.cancel();\n\t\t\tthis._connectTimeout = null;\n\t\t}\n\n\t\t// Clear message buffers.\n\t\tthis._msg_queue = [];\n\t\tthis._buffered_msg_queue = [];\n\t\tthis._notify_msg_sent = {};\n\n\t\tif (this.socket) {\n\t\t\t// Cancel all socket callbacks so that they cannot be driven again by this socket.\n\t\t\tthis.socket.onopen = null;\n\t\t\tthis.socket.onmessage = null;\n\t\t\tthis.socket.onerror = null;\n\t\t\tthis.socket.onclose = null;\n\t\t\tif (this.socket.readyState === 1)\n\t\t\t\tthis.socket.close();\n\t\t\tdelete this.socket;\n\t\t}\n\n\t\tif (this.connectOptions.uris && this.hostIndex < this.connectOptions.uris.length-1) {\n\t\t\t// Try the next host.\n\t\t\tthis.hostIndex++;\n\t\t\tthis._doConnect(this.connectOptions.uris[this.hostIndex]);\n\t\t} else {\n\n\t\t\tif (errorCode === undefined) {\n\t\t\t\terrorCode = ERROR.OK.code;\n\t\t\t\terrorText = format(ERROR.OK);\n\t\t\t}\n\n\t\t\t// Run any application callbacks last as they may attempt to reconnect and hence create a new socket.\n\t\t\tif (this.connected) {\n\t\t\t\tthis.connected = false;\n\t\t\t\t// Execute the connectionLostCallback if there is one, and we were connected.\n\t\t\t\tif (this.onConnectionLost) {\n\t\t\t\t\tthis.onConnectionLost({errorCode:errorCode, errorMessage:errorText, reconnect:this.connectOptions.reconnect, uri:this._wsuri});\n\t\t\t\t}\n\t\t\t\tif (errorCode !== ERROR.OK.code && this.connectOptions.reconnect) {\n\t\t\t\t\t// Start automatic reconnect process for the very first time since last successful connect.\n\t\t\t\t\tthis._reconnectInterval = 1;\n\t\t\t\t\tthis._reconnect();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Otherwise we never had a connection, so indicate that the connect has failed.\n\t\t\t\tif (this.connectOptions.mqttVersion === 4 && this.connectOptions.mqttVersionExplicit === false) {\n\t\t\t\t\tthis._trace(\"Failed to connect V4, dropping back to V3\");\n\t\t\t\t\tthis.connectOptions.mqttVersion = 3;\n\t\t\t\t\tif (this.connectOptions.uris) {\n\t\t\t\t\t\tthis.hostIndex = 0;\n\t\t\t\t\t\tthis._doConnect(this.connectOptions.uris[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._doConnect(this.uri);\n\t\t\t\t\t}\n\t\t\t\t} else if(this.connectOptions.onFailure) {\n\t\t\t\t\tthis.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext, errorCode:errorCode, errorMessage:errorText});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._trace = function () {\n\t\t// Pass trace message back to client's callback function\n\t\tif (this.traceFunction) {\n\t\t\tfor (var i in arguments)\n\t\t\t{\n\t\t\t\tif (typeof arguments[i] !== \"undefined\")\n\t\t\t\t\targuments.splice(i, 1, JSON.stringify(arguments[i]));\n\t\t\t}\n\t\t\tvar record = Array.prototype.slice.call(arguments).join(\"\");\n\t\t\tthis.traceFunction ({severity: \"Debug\", message: record\t});\n\t\t}\n\n\t\t//buffer style trace\n\t\tif ( this._traceBuffer !== null ) {\n\t\t\tfor (var i = 0, max = arguments.length; i < max; i++) {\n\t\t\t\tif ( this._traceBuffer.length == this._MAX_TRACE_ENTRIES ) {\n\t\t\t\t\tthis._traceBuffer.shift();\n\t\t\t\t}\n\t\t\t\tif (i === 0) this._traceBuffer.push(arguments[i]);\n\t\t\t\telse if (typeof arguments[i] === \"undefined\" ) this._traceBuffer.push(arguments[i]);\n\t\t\t\telse this._traceBuffer.push(\"  \"+JSON.stringify(arguments[i]));\n\t\t   }\n\t\t}\n\t};\n\n\t/** @ignore */\n\tClientImpl.prototype._traceMask = function (traceObject, masked) {\n\t\tvar traceObjectMasked = {};\n\t\tfor (var attr in traceObject) {\n\t\t\tif (traceObject.hasOwnProperty(attr)) {\n\t\t\t\tif (attr == masked)\n\t\t\t\t\ttraceObjectMasked[attr] = \"******\";\n\t\t\t\telse\n\t\t\t\t\ttraceObjectMasked[attr] = traceObject[attr];\n\t\t\t}\n\t\t}\n\t\treturn traceObjectMasked;\n\t};\n\n\t// ------------------------------------------------------------------------\n\t// Public Programming interface.\n\t// ------------------------------------------------------------------------\n\n\t/**\n\t * The JavaScript application communicates to the server using a {@link Paho.MQTT.Client} object.\n\t * <p>\n\t * Most applications will create just one Client object and then call its connect() method,\n\t * however applications can create more than one Client object if they wish.\n\t * In this case the combination of host, port and clientId attributes must be different for each Client object.\n\t * <p>\n\t * The send, subscribe and unsubscribe methods are implemented as asynchronous JavaScript methods\n\t * (even though the underlying protocol exchange might be synchronous in nature).\n\t * This means they signal their completion by calling back to the application,\n\t * via Success or Failure callback functions provided by the application on the method in question.\n\t * Such callbacks are called at most once per method invocation and do not persist beyond the lifetime\n\t * of the script that made the invocation.\n\t * <p>\n\t * In contrast there are some callback functions, most notably <i>onMessageArrived</i>,\n\t * that are defined on the {@link Paho.MQTT.Client} object.\n\t * These may get called multiple times, and aren't directly related to specific method invocations made by the client.\n\t *\n\t * @name Paho.MQTT.Client\n\t *\n\t * @constructor\n\t *\n\t * @param {string} host - the address of the messaging server, as a fully qualified WebSocket URI, as a DNS name or dotted decimal IP address.\n\t * @param {number} port - the port number to connect to - only required if host is not a URI\n\t * @param {string} path - the path on the host to connect to - only used if host is not a URI. Default: '/mqtt'.\n\t * @param {string} clientId - the Messaging client identifier, between 1 and 23 characters in length.\n\t *\n\t * @property {string} host - <i>read only</i> the server's DNS hostname or dotted decimal IP address.\n\t * @property {number} port - <i>read only</i> the server's port.\n\t * @property {string} path - <i>read only</i> the server's path.\n\t * @property {string} clientId - <i>read only</i> used when connecting to the server.\n\t * @property {function} onConnectionLost - called when a connection has been lost.\n\t *                            after a connect() method has succeeded.\n\t *                            Establish the call back used when a connection has been lost. The connection may be\n\t *                            lost because the client initiates a disconnect or because the server or network\n\t *                            cause the client to be disconnected. The disconnect call back may be called without\n\t *                            the connectionComplete call back being invoked if, for example the client fails to\n\t *                            connect.\n\t *                            A single response object parameter is passed to the onConnectionLost callback containing the following fields:\n\t *                            <ol>\n\t *                            <li>errorCode\n\t *                            <li>errorMessage\n\t *                            </ol>\n\t * @property {function} onMessageDelivered - called when a message has been delivered.\n\t *                            All processing that this Client will ever do has been completed. So, for example,\n\t *                            in the case of a Qos=2 message sent by this client, the PubComp flow has been received from the server\n\t *                            and the message has been removed from persistent storage before this callback is invoked.\n\t *                            Parameters passed to the onMessageDelivered callback are:\n\t *                            <ol>\n\t *                            <li>{@link Paho.MQTT.Message} that was delivered.\n\t *                            </ol>\n\t * @property {function} onMessageArrived - called when a message has arrived in this Paho.MQTT.client.\n\t *                            Parameters passed to the onMessageArrived callback are:\n\t *                            <ol>\n\t *                            <li>{@link Paho.MQTT.Message} that has arrived.\n\t *                            </ol>\n\t * @property {function} onConnected - called when a connection is successfully made to the server.\n\t *                                  after a connect() method.\n\t *                                  Parameters passed to the onConnected callback are:\n\t *                                  <ol>\n\t *                                  <li>reconnect (boolean) - If true, the connection was the result of a reconnect.</li>\n\t *                                  <li>URI (string) - The URI used to connect to the server.</li>\n\t *                                  </ol>\n\t * @property {boolean} disconnectedPublishing - if set, will enable disconnected publishing in\n\t *                                            in the event that the connection to the server is lost.\n\t * @property {number} disconnectedBufferSize - Used to set the maximum number of messages that the disconnected\n\t *                                             buffer will hold before rejecting new messages. Default size: 5000 messages\n\t * @property {function} trace - called whenever trace is called. TODO\n\t */\n\tvar Client = function (host, port, path, clientId) {\n\n\t    var uri;\n\n\t\tif (typeof host !== \"string\")\n\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof host, \"host\"]));\n\n\t    if (arguments.length == 2) {\n\t        // host: must be full ws:// uri\n\t        // port: clientId\n\t        clientId = port;\n\t        uri = host;\n\t        var match = uri.match(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/);\n\t        if (match) {\n\t            host = match[4]||match[2];\n\t            port = parseInt(match[7]);\n\t            path = match[8];\n\t        } else {\n\t            throw new Error(format(ERROR.INVALID_ARGUMENT,[host,\"host\"]));\n\t        }\n\t    } else {\n\t        if (arguments.length == 3) {\n\t\t\t\tclientId = path;\n\t\t\t\tpath = \"/mqtt\";\n\t\t\t}\n\t\t\tif (typeof port !== \"number\" || port < 0)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof port, \"port\"]));\n\t\t\tif (typeof path !== \"string\")\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof path, \"path\"]));\n\n\t\t\tvar ipv6AddSBracket = (host.indexOf(\":\") !== -1 && host.slice(0,1) !== \"[\" && host.slice(-1) !== \"]\");\n\t\t\turi = \"ws://\"+(ipv6AddSBracket?\"[\"+host+\"]\":host)+\":\"+port+path;\n\t\t}\n\n\t\tvar clientIdLength = 0;\n\t\tfor (var i = 0; i<clientId.length; i++) {\n\t\t\tvar charCode = clientId.charCodeAt(i);\n\t\t\tif (0xD800 <= charCode && charCode <= 0xDBFF)  {\n\t\t\t\t i++; // Surrogate pair.\n\t\t\t}\n\t\t\tclientIdLength++;\n\t\t}\n\t\tif (typeof clientId !== \"string\" || clientIdLength > 65535)\n\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [clientId, \"clientId\"]));\n\n\t\tvar client = new ClientImpl(uri, host, port, path, clientId);\n\t\tthis._getHost =  function() { return host; };\n\t\tthis._setHost = function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); };\n\n\t\tthis._getPort = function() { return port; };\n\t\tthis._setPort = function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); };\n\n\t\tthis._getPath = function() { return path; };\n\t\tthis._setPath = function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); };\n\n\t\tthis._getURI = function() { return uri; };\n\t\tthis._setURI = function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); };\n\n\t\tthis._getClientId = function() { return client.clientId; };\n\t\tthis._setClientId = function() { throw new Error(format(ERROR.UNSUPPORTED_OPERATION)); };\n\n\t\tthis._getOnConnected = function() { return client.onConnected; };\n\t\tthis._setOnConnected = function(newOnConnected) {\n\t\t\tif (typeof newOnConnected === \"function\")\n\t\t\t\tclient.onConnected = newOnConnected;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnConnected, \"onConnected\"]));\n\t\t};\n\n\t\tthis._getDisconnectedPublishing = function() { return client.disconnectedPublishing; };\n\t\tthis._setDisconnectedPublishing = function(newDisconnectedPublishing) {\n\t\t\tclient.disconnectedPublishing = newDisconnectedPublishing;\n\t\t};\n\n\t\tthis._getDisconnectedBufferSize = function() { return client.disconnectedBufferSize; };\n\t\tthis._setDisconnectedBufferSize = function(newDisconnectedBufferSize) {\n\t\t\tclient.disconnectedBufferSize = newDisconnectedBufferSize;\n\t\t};\n\n\t\tthis._getOnConnectionLost = function() { return client.onConnectionLost; };\n\t\tthis._setOnConnectionLost = function(newOnConnectionLost) {\n\t\t\tif (typeof newOnConnectionLost === \"function\")\n\t\t\t\tclient.onConnectionLost = newOnConnectionLost;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnConnectionLost, \"onConnectionLost\"]));\n\t\t};\n\n\t\tthis._getOnMessageDelivered = function() { return client.onMessageDelivered; };\n\t\tthis._setOnMessageDelivered = function(newOnMessageDelivered) {\n\t\t\tif (typeof newOnMessageDelivered === \"function\")\n\t\t\t\tclient.onMessageDelivered = newOnMessageDelivered;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnMessageDelivered, \"onMessageDelivered\"]));\n\t\t};\n\n\t\tthis._getOnMessageArrived = function() { return client.onMessageArrived; };\n\t\tthis._setOnMessageArrived = function(newOnMessageArrived) {\n\t\t\tif (typeof newOnMessageArrived === \"function\")\n\t\t\t\tclient.onMessageArrived = newOnMessageArrived;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof newOnMessageArrived, \"onMessageArrived\"]));\n\t\t};\n\n\t\tthis._getTrace = function() { return client.traceFunction; };\n\t\tthis._setTrace = function(trace) {\n\t\t\tif(typeof trace === \"function\"){\n\t\t\t\tclient.traceFunction = trace;\n\t\t\t}else{\n\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof trace, \"onTrace\"]));\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Connect this Messaging client to its server.\n\t\t *\n\t\t * @name Paho.MQTT.Client#connect\n\t\t * @function\n\t\t * @param {object} connectOptions - Attributes used with the connection.\n\t\t * @param {number} connectOptions.timeout - If the connect has not succeeded within this\n\t\t *                    number of seconds, it is deemed to have failed.\n\t\t *                    The default is 30 seconds.\n\t\t * @param {string} connectOptions.userName - Authentication username for this connection.\n\t\t * @param {string} connectOptions.password - Authentication password for this connection.\n\t\t * @param {Paho.MQTT.Message} connectOptions.willMessage - sent by the server when the client\n\t\t *                    disconnects abnormally.\n\t\t * @param {number} connectOptions.keepAliveInterval - the server disconnects this client if\n\t\t *                    there is no activity for this number of seconds.\n\t\t *                    The default value of 60 seconds is assumed if not set.\n\t\t * @param {boolean} connectOptions.cleanSession - if true(default) the client and server\n\t\t *                    persistent state is deleted on successful connect.\n\t\t * @param {boolean} connectOptions.useSSL - if present and true, use an SSL Websocket connection.\n\t\t * @param {object} connectOptions.invocationContext - passed to the onSuccess callback or onFailure callback.\n\t\t * @param {function} connectOptions.onSuccess - called when the connect acknowledgement\n\t\t *                    has been received from the server.\n\t\t * A single response object parameter is passed to the onSuccess callback containing the following fields:\n\t\t * <ol>\n\t\t * <li>invocationContext as passed in to the onSuccess method in the connectOptions.\n\t\t * </ol>\n     * @param {function} connectOptions.onFailure - called when the connect request has failed or timed out.\n\t\t * A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t * <ol>\n\t\t * <li>invocationContext as passed in to the onFailure method in the connectOptions.\n\t\t * <li>errorCode a number indicating the nature of the error.\n\t\t * <li>errorMessage text describing the error.\n\t\t * </ol>\n     * @param {array} connectOptions.hosts - If present this contains either a set of hostnames or fully qualified\n\t\t * WebSocket URIs (ws://iot.eclipse.org:80/ws), that are tried in order in place\n\t\t * of the host and port paramater on the construtor. The hosts are tried one at at time in order until\n\t\t * one of then succeeds.\n     * @param {array} connectOptions.ports - If present the set of ports matching the hosts. If hosts contains URIs, this property\n\t\t * is not used.\n     * @param {boolean} connectOptions.reconnect - Sets whether the client will automatically attempt to reconnect\n     * to the server if the connection is lost.\n     *<ul>\n     *<li>If set to false, the client will not attempt to automatically reconnect to the server in the event that the\n     * connection is lost.</li>\n     *<li>If set to true, in the event that the connection is lost, the client will attempt to reconnect to the server.\n     * It will initially wait 1 second before it attempts to reconnect, for every failed reconnect attempt, the delay\n     * will double until it is at 2 minutes at which point the delay will stay at 2 minutes.</li>\n     *</ul>\n     * @param {number} connectOptions.mqttVersion - The version of MQTT to use to connect to the MQTT Broker.\n     *<ul>\n     *<li>3 - MQTT V3.1</li>\n     *<li>4 - MQTT V3.1.1</li>\n     *</ul>\n     * @param {boolean} connectOptions.mqttVersionExplicit - If set to true, will force the connection to use the\n     * selected MQTT Version or will fail to connect.\n     * @param {array} connectOptions.uris - If present, should contain a list of fully qualified WebSocket uris\n     * (e.g. ws://iot.eclipse.org:80/ws), that are tried in order in place of the host and port parameter of the construtor.\n     * The uris are tried one at a time in order until one of them succeeds. Do not use this in conjunction with hosts as\n     * the hosts array will be converted to uris and will overwrite this property.\n\t\t * @throws {InvalidState} If the client is not in disconnected state. The client must have received connectionLost\n\t\t * or disconnected before calling connect for a second or subsequent time.\n\t\t */\n\t\tthis.connect = function (connectOptions) {\n\t\t\tconnectOptions = connectOptions || {} ;\n\t\t\tvalidate(connectOptions,  {timeout:\"number\",\n\t\t\t\t\t\t\t\t\t   userName:\"string\",\n\t\t\t\t\t\t\t\t\t   password:\"string\",\n\t\t\t\t\t\t\t\t\t   willMessage:\"object\",\n\t\t\t\t\t\t\t\t\t   keepAliveInterval:\"number\",\n\t\t\t\t\t\t\t\t\t   cleanSession:\"boolean\",\n\t\t\t\t\t\t\t\t\t   useSSL:\"boolean\",\n\t\t\t\t\t\t\t\t\t   invocationContext:\"object\",\n\t\t\t\t\t\t\t\t\t   onSuccess:\"function\",\n\t\t\t\t\t\t\t\t\t   onFailure:\"function\",\n\t\t\t\t\t\t\t\t\t   hosts:\"object\",\n\t\t\t\t\t\t\t\t\t   ports:\"object\",\n\t\t\t\t\t\t\t\t\t   reconnect:\"boolean\",\n\t\t\t\t\t\t\t\t\t   mqttVersion:\"number\",\n\t\t\t\t\t\t\t\t\t   mqttVersionExplicit:\"boolean\",\n\t\t\t\t\t\t\t\t\t   uris: \"object\"});\n\n\t\t\t// If no keep alive interval is set, assume 60 seconds.\n\t\t\tif (connectOptions.keepAliveInterval === undefined)\n\t\t\t\tconnectOptions.keepAliveInterval = 60;\n\n\t\t\tif (connectOptions.mqttVersion > 4 || connectOptions.mqttVersion < 3) {\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.mqttVersion, \"connectOptions.mqttVersion\"]));\n\t\t\t}\n\n\t\t\tif (connectOptions.mqttVersion === undefined) {\n\t\t\t\tconnectOptions.mqttVersionExplicit = false;\n\t\t\t\tconnectOptions.mqttVersion = 4;\n\t\t\t} else {\n\t\t\t\tconnectOptions.mqttVersionExplicit = true;\n\t\t\t}\n\n\t\t\t//Check that if password is set, so is username\n\t\t\tif (connectOptions.password !== undefined && connectOptions.userName === undefined)\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.password, \"connectOptions.password\"]));\n\n\t\t\tif (connectOptions.willMessage) {\n\t\t\t\tif (!(connectOptions.willMessage instanceof Message))\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [connectOptions.willMessage, \"connectOptions.willMessage\"]));\n\t\t\t\t// The will message must have a payload that can be represented as a string.\n\t\t\t\t// Cause the willMessage to throw an exception if this is not the case.\n\t\t\t\tconnectOptions.willMessage.stringPayload = null;\n\n\t\t\t\tif (typeof connectOptions.willMessage.destinationName === \"undefined\")\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.willMessage.destinationName, \"connectOptions.willMessage.destinationName\"]));\n\t\t\t}\n\t\t\tif (typeof connectOptions.cleanSession === \"undefined\")\n\t\t\t\tconnectOptions.cleanSession = true;\n\t\t\tif (connectOptions.hosts) {\n\n\t\t\t\tif (!(connectOptions.hosts instanceof Array) )\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, \"connectOptions.hosts\"]));\n\t\t\t\tif (connectOptions.hosts.length <1 )\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts, \"connectOptions.hosts\"]));\n\n\t\t\t\tvar usingURIs = false;\n\t\t\t\tfor (var i = 0; i<connectOptions.hosts.length; i++) {\n\t\t\t\t\tif (typeof connectOptions.hosts[i] !== \"string\")\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\tif (/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/.test(connectOptions.hosts[i])) {\n\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\tusingURIs = true;\n\t\t\t\t\t\t} else if (!usingURIs) {\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (usingURIs) {\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.hosts[i], \"connectOptions.hosts[\"+i+\"]\"]));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!usingURIs) {\n\t\t\t\t\tif (!connectOptions.ports)\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\t\t\t\t\tif (!(connectOptions.ports instanceof Array) )\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\t\t\t\t\tif (connectOptions.hosts.length !== connectOptions.ports.length)\n\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [connectOptions.ports, \"connectOptions.ports\"]));\n\n\t\t\t\t\tconnectOptions.uris = [];\n\n\t\t\t\t\tfor (var i = 0; i<connectOptions.hosts.length; i++) {\n\t\t\t\t\t\tif (typeof connectOptions.ports[i] !== \"number\" || connectOptions.ports[i] < 0)\n\t\t\t\t\t\t\tthrow new Error(format(ERROR.INVALID_TYPE, [typeof connectOptions.ports[i], \"connectOptions.ports[\"+i+\"]\"]));\n\t\t\t\t\t\tvar host = connectOptions.hosts[i];\n\t\t\t\t\t\tvar port = connectOptions.ports[i];\n\n\t\t\t\t\t\tvar ipv6 = (host.indexOf(\":\") !== -1);\n\t\t\t\t\t\turi = \"ws://\"+(ipv6?\"[\"+host+\"]\":host)+\":\"+port+path;\n\t\t\t\t\t\tconnectOptions.uris.push(uri);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconnectOptions.uris = connectOptions.hosts;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclient.connect(connectOptions);\n\t\t};\n\n\t\t/**\n\t\t * Subscribe for messages, request receipt of a copy of messages sent to the destinations described by the filter.\n\t\t *\n\t\t * @name Paho.MQTT.Client#subscribe\n\t\t * @function\n\t\t * @param {string} filter describing the destinations to receive messages from.\n\t\t * <br>\n\t\t * @param {object} subscribeOptions - used to control the subscription\n\t\t *\n\t\t * @param {number} subscribeOptions.qos - the maiximum qos of any publications sent\n\t\t *                                  as a result of making this subscription.\n\t\t * @param {object} subscribeOptions.invocationContext - passed to the onSuccess callback\n\t\t *                                  or onFailure callback.\n\t\t * @param {function} subscribeOptions.onSuccess - called when the subscribe acknowledgement\n\t\t *                                  has been received from the server.\n\t\t *                                  A single response object parameter is passed to the onSuccess callback containing the following fields:\n\t\t *                                  <ol>\n\t\t *                                  <li>invocationContext if set in the subscribeOptions.\n\t\t *                                  </ol>\n\t\t * @param {function} subscribeOptions.onFailure - called when the subscribe request has failed or timed out.\n\t\t *                                  A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t *                                  <ol>\n\t\t *                                  <li>invocationContext - if set in the subscribeOptions.\n\t\t *                                  <li>errorCode - a number indicating the nature of the error.\n\t\t *                                  <li>errorMessage - text describing the error.\n\t\t *                                  </ol>\n\t\t * @param {number} subscribeOptions.timeout - which, if present, determines the number of\n\t\t *                                  seconds after which the onFailure calback is called.\n\t\t *                                  The presence of a timeout does not prevent the onSuccess\n\t\t *                                  callback from being called when the subscribe completes.\n\t\t * @throws {InvalidState} if the client is not in connected state.\n\t\t */\n\t\tthis.subscribe = function (filter, subscribeOptions) {\n\t\t\tif (typeof filter !== \"string\")\n\t\t\t\tthrow new Error(\"Invalid argument:\"+filter);\n\t\t\tsubscribeOptions = subscribeOptions || {} ;\n\t\t\tvalidate(subscribeOptions,  {qos:\"number\",\n\t\t\t\t\t\t\t\t\t\t invocationContext:\"object\",\n\t\t\t\t\t\t\t\t\t\t onSuccess:\"function\",\n\t\t\t\t\t\t\t\t\t\t onFailure:\"function\",\n\t\t\t\t\t\t\t\t\t\t timeout:\"number\"\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\tif (subscribeOptions.timeout && !subscribeOptions.onFailure)\n\t\t\t\tthrow new Error(\"subscribeOptions.timeout specified with no onFailure callback.\");\n\t\t\tif (typeof subscribeOptions.qos !== \"undefined\" && !(subscribeOptions.qos === 0 || subscribeOptions.qos === 1 || subscribeOptions.qos === 2 ))\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [subscribeOptions.qos, \"subscribeOptions.qos\"]));\n\t\t\tclient.subscribe(filter, subscribeOptions);\n\t\t};\n\n\t\t/**\n\t\t * Unsubscribe for messages, stop receiving messages sent to destinations described by the filter.\n\t\t *\n\t\t * @name Paho.MQTT.Client#unsubscribe\n\t\t * @function\n\t\t * @param {string} filter - describing the destinations to receive messages from.\n\t\t * @param {object} unsubscribeOptions - used to control the subscription\n\t\t * @param {object} unsubscribeOptions.invocationContext - passed to the onSuccess callback\n\t\t                                      or onFailure callback.\n\t\t * @param {function} unsubscribeOptions.onSuccess - called when the unsubscribe acknowledgement has been received from the server.\n\t\t *                                    A single response object parameter is passed to the\n\t\t *                                    onSuccess callback containing the following fields:\n\t\t *                                    <ol>\n\t\t *                                    <li>invocationContext - if set in the unsubscribeOptions.\n\t\t *                                    </ol>\n\t\t * @param {function} unsubscribeOptions.onFailure called when the unsubscribe request has failed or timed out.\n\t\t *                                    A single response object parameter is passed to the onFailure callback containing the following fields:\n\t\t *                                    <ol>\n\t\t *                                    <li>invocationContext - if set in the unsubscribeOptions.\n\t\t *                                    <li>errorCode - a number indicating the nature of the error.\n\t\t *                                    <li>errorMessage - text describing the error.\n\t\t *                                    </ol>\n\t\t * @param {number} unsubscribeOptions.timeout - which, if present, determines the number of seconds\n\t\t *                                    after which the onFailure callback is called. The presence of\n\t\t *                                    a timeout does not prevent the onSuccess callback from being\n\t\t *                                    called when the unsubscribe completes\n\t\t * @throws {InvalidState} if the client is not in connected state.\n\t\t */\n\t\tthis.unsubscribe = function (filter, unsubscribeOptions) {\n\t\t\tif (typeof filter !== \"string\")\n\t\t\t\tthrow new Error(\"Invalid argument:\"+filter);\n\t\t\tunsubscribeOptions = unsubscribeOptions || {} ;\n\t\t\tvalidate(unsubscribeOptions,  {invocationContext:\"object\",\n\t\t\t\t\t\t\t\t\t\t   onSuccess:\"function\",\n\t\t\t\t\t\t\t\t\t\t   onFailure:\"function\",\n\t\t\t\t\t\t\t\t\t\t   timeout:\"number\"\n\t\t\t\t\t\t\t\t\t\t  });\n\t\t\tif (unsubscribeOptions.timeout && !unsubscribeOptions.onFailure)\n\t\t\t\tthrow new Error(\"unsubscribeOptions.timeout specified with no onFailure callback.\");\n\t\t\tclient.unsubscribe(filter, unsubscribeOptions);\n\t\t};\n\n\t\t/**\n\t\t * Send a message to the consumers of the destination in the Message.\n\t\t *\n\t\t * @name Paho.MQTT.Client#send\n\t\t * @function\n\t\t * @param {string|Paho.MQTT.Message} topic - <b>mandatory</b> The name of the destination to which the message is to be sent.\n\t\t * \t\t\t\t\t   - If it is the only parameter, used as Paho.MQTT.Message object.\n\t\t * @param {String|ArrayBuffer} payload - The message data to be sent.\n\t\t * @param {number} qos The Quality of Service used to deliver the message.\n\t\t * \t\t<dl>\n\t\t * \t\t\t<dt>0 Best effort (default).\n\t\t *     \t\t\t<dt>1 At least once.\n\t\t *     \t\t\t<dt>2 Exactly once.\n\t\t * \t\t</dl>\n\t\t * @param {Boolean} retained If true, the message is to be retained by the server and delivered\n\t\t *                     to both current and future subscriptions.\n\t\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t\t *                     A received message has the retained boolean set to true if the message was published\n\t\t *                     with the retained boolean set to true\n\t\t *                     and the subscrption was made after the message has been published.\n\t\t * @throws {InvalidState} if the client is not connected.\n\t\t */\n\t\tthis.send = function (topic,payload,qos,retained) {\n\t\t\tvar message ;\n\n\t\t\tif(arguments.length === 0){\n\t\t\t\tthrow new Error(\"Invalid argument.\"+\"length\");\n\n\t\t\t}else if(arguments.length == 1) {\n\n\t\t\t\tif (!(topic instanceof Message) && (typeof topic !== \"string\"))\n\t\t\t\t\tthrow new Error(\"Invalid argument:\"+ typeof topic);\n\n\t\t\t\tmessage = topic;\n\t\t\t\tif (typeof message.destinationName === \"undefined\")\n\t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,\"Message.destinationName\"]));\n\t\t\t\tclient.send(message);\n\n\t\t\t}else {\n\t\t\t\t//parameter checking in Message object\n\t\t\t\tmessage = new Message(payload);\n\t\t\t\tmessage.destinationName = topic;\n\t\t\t\tif(arguments.length >= 3)\n\t\t\t\t\tmessage.qos = qos;\n\t\t\t\tif(arguments.length >= 4)\n\t\t\t\t\tmessage.retained = retained;\n\t\t\t\tclient.send(message);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Publish a message to the consumers of the destination in the Message.\n\t\t * Synonym for Paho.Mqtt.Client#send\n\t\t *\n\t\t * @name Paho.MQTT.Client#publish\n\t\t * @function\n\t\t * @param {string|Paho.MQTT.Message} topic - <b>mandatory</b> The name of the topic to which the message is to be published.\n\t\t * \t\t\t\t\t   - If it is the only parameter, used as Paho.MQTT.Message object.\n\t\t * @param {String|ArrayBuffer} payload - The message data to be published.\n\t\t * @param {number} qos The Quality of Service used to deliver the message.\n\t\t * \t\t<dl>\n\t\t * \t\t\t<dt>0 Best effort (default).\n\t\t *     \t\t\t<dt>1 At least once.\n\t\t *     \t\t\t<dt>2 Exactly once.\n\t\t * \t\t</dl>\n\t\t * @param {Boolean} retained If true, the message is to be retained by the server and delivered\n\t\t *                     to both current and future subscriptions.\n\t\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t\t *                     A received message has the retained boolean set to true if the message was published\n\t\t *                     with the retained boolean set to true\n\t\t *                     and the subscrption was made after the message has been published.\n\t\t * @throws {InvalidState} if the client is not connected.\n\t\t */\n\t\t this.publish = function(topic,payload,qos,retained) {\n\t\t\t console.log(\"Publising message to: \", topic);\n\t\t\t var message ;\n\n \t\t\tif(arguments.length === 0){\n \t\t\t\tthrow new Error(\"Invalid argument.\"+\"length\");\n\n \t\t\t}else if(arguments.length == 1) {\n\n \t\t\t\tif (!(topic instanceof Message) && (typeof topic !== \"string\"))\n \t\t\t\t\tthrow new Error(\"Invalid argument:\"+ typeof topic);\n\n \t\t\t\tmessage = topic;\n \t\t\t\tif (typeof message.destinationName === \"undefined\")\n \t\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,\"Message.destinationName\"]));\n \t\t\t\tclient.send(message);\n\n \t\t\t}else {\n \t\t\t\t//parameter checking in Message object\n \t\t\t\tmessage = new Message(payload);\n \t\t\t\tmessage.destinationName = topic;\n \t\t\t\tif(arguments.length >= 3)\n \t\t\t\t\tmessage.qos = qos;\n \t\t\t\tif(arguments.length >= 4)\n \t\t\t\t\tmessage.retained = retained;\n \t\t\t\tclient.send(message);\n \t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Normal disconnect of this Messaging client from its server.\n\t\t *\n\t\t * @name Paho.MQTT.Client#disconnect\n\t\t * @function\n\t\t * @throws {InvalidState} if the client is already disconnected.\n\t\t */\n\t\tthis.disconnect = function () {\n\t\t\tclient.disconnect();\n\t\t};\n\n\t\t/**\n\t\t * Get the contents of the trace log.\n\t\t *\n\t\t * @name Paho.MQTT.Client#getTraceLog\n\t\t * @function\n\t\t * @return {Object[]} tracebuffer containing the time ordered trace records.\n\t\t */\n\t\tthis.getTraceLog = function () {\n\t\t\treturn client.getTraceLog();\n\t\t};\n\n\t\t/**\n\t\t * Start tracing.\n\t\t *\n\t\t * @name Paho.MQTT.Client#startTrace\n\t\t * @function\n\t\t */\n\t\tthis.startTrace = function () {\n\t\t\tclient.startTrace();\n\t\t};\n\n\t\t/**\n\t\t * Stop tracing.\n\t\t *\n\t\t * @name Paho.MQTT.Client#stopTrace\n\t\t * @function\n\t\t */\n\t\tthis.stopTrace = function () {\n\t\t\tclient.stopTrace();\n\t\t};\n\n\t\tthis.isConnected = function() {\n\t\t\treturn client.connected;\n\t\t};\n\t};\n\n\tClient.prototype = {\n\t\tget host() { return this._getHost(); },\n\t\tset host(newHost) { this._setHost(newHost); },\n\n\t\tget port() { return this._getPort(); },\n\t\tset port(newPort) { this._setPort(newPort); },\n\n\t\tget path() { return this._getPath(); },\n\t\tset path(newPath) { this._setPath(newPath); },\n\n\t\tget clientId() { return this._getClientId(); },\n\t\tset clientId(newClientId) { this._setClientId(newClientId); },\n\n\t\tget onConnected() { return this._getOnConnected(); },\n\t\tset onConnected(newOnConnected) { this._setOnConnected(newOnConnected); },\n\n\t\tget disconnectedPublishing() { return this._getDisconnectedPublishing(); },\n\t\tset disconnectedPublishing(newDisconnectedPublishing) { this._setDisconnectedPublishing(newDisconnectedPublishing); },\n\n\t\tget disconnectedBufferSize() { return this._getDisconnectedBufferSize(); },\n\t\tset disconnectedBufferSize(newDisconnectedBufferSize) { this._setDisconnectedBufferSize(newDisconnectedBufferSize); },\n\n\t\tget onConnectionLost() { return this._getOnConnectionLost(); },\n\t\tset onConnectionLost(newOnConnectionLost) { this._setOnConnectionLost(newOnConnectionLost); },\n\n\t\tget onMessageDelivered() { return this._getOnMessageDelivered(); },\n\t\tset onMessageDelivered(newOnMessageDelivered) { this._setOnMessageDelivered(newOnMessageDelivered); },\n\n\t\tget onMessageArrived() { return this._getOnMessageArrived(); },\n\t\tset onMessageArrived(newOnMessageArrived) { this._setOnMessageArrived(newOnMessageArrived); },\n\n\t\tget trace() { return this._getTrace(); },\n\t\tset trace(newTraceFunction) { this._setTrace(newTraceFunction); }\n\n\t};\n\n\t/**\n\t * An application message, sent or received.\n\t * <p>\n\t * All attributes may be null, which implies the default values.\n\t *\n\t * @name Paho.MQTT.Message\n\t * @constructor\n\t * @param {String|ArrayBuffer} payload The message data to be sent.\n\t * <p>\n\t * @property {string} payloadString <i>read only</i> The payload as a string if the payload consists of valid UTF-8 characters.\n\t * @property {ArrayBuffer} payloadBytes <i>read only</i> The payload as an ArrayBuffer.\n\t * <p>\n\t * @property {string} destinationName <b>mandatory</b> The name of the destination to which the message is to be sent\n\t *                    (for messages about to be sent) or the name of the destination from which the message has been received.\n\t *                    (for messages received by the onMessage function).\n\t * <p>\n\t * @property {number} qos The Quality of Service used to deliver the message.\n\t * <dl>\n\t *     <dt>0 Best effort (default).\n\t *     <dt>1 At least once.\n\t *     <dt>2 Exactly once.\n\t * </dl>\n\t * <p>\n\t * @property {Boolean} retained If true, the message is to be retained by the server and delivered\n\t *                     to both current and future subscriptions.\n\t *                     If false the server only delivers the message to current subscribers, this is the default for new Messages.\n\t *                     A received message has the retained boolean set to true if the message was published\n\t *                     with the retained boolean set to true\n\t *                     and the subscrption was made after the message has been published.\n\t * <p>\n\t * @property {Boolean} duplicate <i>read only</i> If true, this message might be a duplicate of one which has already been received.\n\t *                     This is only set on messages received from the server.\n\t *\n\t */\n\tvar Message = function (newPayload) {\n\t\tvar payload;\n\t\tif (   typeof newPayload === \"string\" ||\n\t\tnewPayload instanceof ArrayBuffer ||\n\t\tnewPayload instanceof Int8Array   ||\n\t\tnewPayload instanceof Uint8Array  ||\n\t\tnewPayload instanceof Int16Array  ||\n\t\tnewPayload instanceof Uint16Array ||\n\t\tnewPayload instanceof Int32Array  ||\n\t\tnewPayload instanceof Uint32Array ||\n\t\tnewPayload instanceof Float32Array ||\n\t\tnewPayload instanceof Float64Array\n\t\t   ) {\n\t\t\tpayload = newPayload;\n\t\t} else {\n\t\t\tthrow (format(ERROR.INVALID_ARGUMENT, [newPayload, \"newPayload\"]));\n\t\t}\n\n\t\tthis._getPayloadString = function () {\n\t\t\tif (typeof payload === \"string\")\n\t\t\t\treturn payload;\n\t\t\telse\n\t\t\t\treturn parseUTF8(payload, 0, payload.length);\n\t\t};\n\n\t\tthis._getPayloadBytes = function() {\n\t\t\tif (typeof payload === \"string\") {\n\t\t\t\tvar buffer = new ArrayBuffer(UTF8Length(payload));\n\t\t\t\tvar byteStream = new Uint8Array(buffer);\n\t\t\t\tstringToUTF8(payload, byteStream, 0);\n\n\t\t\t\treturn byteStream;\n\t\t\t} else {\n\t\t\t\treturn payload;\n\t\t\t}\n\t\t};\n\n\t\tvar destinationName;\n\t\tthis._getDestinationName = function() { return destinationName; };\n\t\tthis._setDestinationName = function(newDestinationName) {\n\t\t\tif (typeof newDestinationName === \"string\")\n\t\t\t\tdestinationName = newDestinationName;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [newDestinationName, \"newDestinationName\"]));\n\t\t};\n\n\t\tvar qos = 0;\n\t\tthis._getQos = function() { return qos; };\n\t\tthis._setQos = function(newQos) {\n\t\t\tif (newQos === 0 || newQos === 1 || newQos === 2 )\n\t\t\t\tqos = newQos;\n\t\t\telse\n\t\t\t\tthrow new Error(\"Invalid argument:\"+newQos);\n\t\t};\n\n\t\tvar retained = false;\n\t\tthis._getRetained = function() { return retained; };\n\t\tthis._setRetained = function(newRetained) {\n\t\t\tif (typeof newRetained === \"boolean\")\n\t\t\t\tretained = newRetained;\n\t\t\telse\n\t\t\t\tthrow new Error(format(ERROR.INVALID_ARGUMENT, [newRetained, \"newRetained\"]));\n\t\t};\n\n\t\tvar duplicate = false;\n\t\tthis._getDuplicate = function() { return duplicate; };\n\t\tthis._setDuplicate = function(newDuplicate) { duplicate = newDuplicate; };\n\t};\n\n\tMessage.prototype = {\n\t\tget payloadString() { return this._getPayloadString(); },\n\t\tget payloadBytes() { return this._getPayloadBytes(); },\n\n\t\tget destinationName() { return this._getDestinationName(); },\n\t\tset destinationName(newDestinationName) { this._setDestinationName(newDestinationName); },\n\n\t\tget topic() { return this._getDestinationName(); },\n\t\tset topic(newTopic) { this._setDestinationName(newTopic); },\n\n\t\tget qos() { return this._getQos(); },\n\t\tset qos(newQos) { this._setQos(newQos); },\n\n\t\tget retained() { return this._getRetained(); },\n\t\tset retained(newRetained) { this._setRetained(newRetained); },\n\n\t\tget duplicate() { return this._getDuplicate(); },\n\t\tset duplicate(newDuplicate) { this._setDuplicate(newDuplicate); }\n\t};\n\n\t// Module contents.\n\treturn {\n\t\tClient: Client,\n\t\tMessage: Message\n\t};\n})(window);\nreturn PahoMQTT;\n});\n"]}]}